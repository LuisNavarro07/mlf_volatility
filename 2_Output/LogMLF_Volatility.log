
. timer on 5

. /// Data Cleaning and Preparation
> ********************************************************************************
. /// 0) Clean Bloomberg Prices of Potential Donors
> do "${cod}/code_dataprep/0_BloombergPrices.do" 

. ********************************************************************************
. ********************************************************************************
. *** Project: Volatility in the Municipal Bond Market and the MLF 
. *** Authors: Felipe Lozano & Luis Navarro 
. *** Code by: Luis Navarro 
. *** Script: Clean Bloomberg Prices 
. *** This Update: September 2022 
. ********************************************************************************
. ********************************************************************************
. clear all 

. /// Bloomberg Prices 
> forvalues i=1(1)17{
  2. qui import excel "${raw}/BloombergPrices.xlsx", firstrow sheet("Sheet`i'") clear case(lowe
> r)
  3. tempfile price`i'
  4. qui save `price`i'', replace 
  5. }

. 
. use `price2', clear

. qui merge 1:1 date using `price1', keep(match master) nogen

. forvalues i=3(1)17{
  2. qui merge 1:1 date using `price`i'', keep(match master) nogen
  3. }

. 
. drop c1comdty wacomdty o1comdty s1comdty

. qui destring _all, replace 

. gen yr = year(date)

. drop if yr == 2018 
(237 observations deleted)

. 
. // Drop all variables that we don't have at least 95% of total observationbs
. global all ctpen10ygovt ctcad10ygovt ctskk10ygovt ctkrw10ygovt ctdop10ygovt ctjmd10ygovt ctit
> l10ygovt ctngn10ygovt ctfim10ygovt ctpte10ygovt ctmxn10ygovt ctcop10ygovt ctchf10ygovt ctclp1
> 0ygovt ctcny10ygovt ctrub10ygovt spxindex ftsemibindex nkyindex induindex mexbolindex ctthb10
> ygovt egpt10yindex ctsgd10ygovt ctdkk10ygovt ctsek10ygovt ctaud10ygovt ctats10ygovt cthkd10yg
> ovt clacomdty coacomdty sbacomdty coalinequity xb1comdty ng1comdty gc1comdty si1comdty hg1com
> dty xptusdcurrncy cc1comdty lc1comdty ho1comdty qs1comdty jx1comdty rr1comdty sm1comdty bo1co
> mdty rs1comdty kc1comdty jo1comdty lb1comdty or1comdty dl1comdty fc1comdty lh1comdty ctfrf9yg
> ovt ctesp9ygovt ctsar10ygovt ctdem9ygovt ctinr9ygovt ctbef9ygovt ctgrd20ygovt ctiep3ygovt ctn
> ok3ygovt ctuah3ygovt ctrub3ygovt ctats3ygovt ctczk3ygovt ctdkk3ygovt ctdkk5ygovt ctskk5ygovt 
> ctbef3ygovt ctdemii5y ctinr2ygovt ctsar2ygovt ctcny3ygovt cthkd5ygovt ctbrl5ygovt ctbrlii30tg
> ovt ctbrl3ygovt ctnzd5ygovt ctpln2ygovt ctngn2ygovt ctjpyii5ygovt cteurhr9ygvot cteurlt2ygvot
>  ctzar10ygovt ctgbpii5ygovt ctgbp10ygovt ctmry5ygovt ctgtq20ygovt ctlvl2ygovt cteurro6ygovt c
> tyhb2ygovt ctphp2ygovt daxindex cacindex aexindex ibexindex omxindex smiindex bsxindex igpain
> dex buxindex rtsiindex saxindex egx30index kse100index nse200index hisindex kospiindex sensex
> index shsz300index as51index atxindex aseindex bel20index omxc25index hexindex icexiindex cro
> xindex ctxeurindex rotxlindex utxeurindex tpxindex

. 
. local varlist ${all}

. foreach var of local varlist {
  2.         quietly mdesc `var' 
  3.         if r(percent) > 5 {
  4.                 drop `var'
  5.         }
  6. }

. 
. global vars ctjmd10ygovt ctmxn10ygovt ctchf10ygovt ctclp10ygovt spxindex ftsemibindex induind
> ex mexbolindex ctsek10ygovt clacomdty coacomdty coalinequity xb1comdty ng1comdty gc1comdty si
> 1comdty hg1comdty xptusdcurrncy cc1comdty lc1comdty ho1comdty qs1comdty rr1comdty sm1comdty b
> o1comdty rs1comdty kc1comdty jo1comdty lb1comdty or1comdty dl1comdty fc1comdty lh1comdty ctfr
> f9ygovt ctgrd20ygovt ctiep3ygovt ctnok3ygovt ctczk3ygovt ctdkk3ygovt ctdkk5ygovt ctbef3ygovt 
> ctdemii5y ctbrl5ygovt ctbrlii30tgovt ctbrl3ygovt ctnzd5ygovt ctpln2ygovt cteurlt2ygvot ctzar1
> 0ygovt ctgbpii5ygovt ctgbp10ygovt ctlvl2ygovt cteurro6ygovt daxindex cacindex aexindex ibexin
> dex omxindex smiindex bsxindex igpaindex buxindex rtsiindex saxindex kse100index nse200index 
> hisindex kospiindex sensexindex as51index atxindex aseindex bel20index omxc25index hexindex i
> cexiindex croxindex ctxeurindex rotxlindex utxeurindex

. 
. 
. /// Assumption -- Carryforward for missing spaces 
> sort date

. tsset date

Time variable: date, 1/2/2019 to 12/31/2021, but with gaps
        Delta: 1 day

. local varlist $vars

. foreach var of local varlist {
  2.     qui carryforward `var', replace 
  3. }

. 
. mdesc 

    Variable    |     Missing          Total     Percent Missing
----------------+-----------------------------------------------
           date |           0            776           0.00
   ctjmd10ygovt |           0            776           0.00
   ctmxn10ygovt |           0            776           0.00
   ctchf10ygovt |           1            776           0.13
   ctclp10ygovt |           0            776           0.00
       spxindex |           0            776           0.00
   ftsemibindex |           0            776           0.00
      induindex |           0            776           0.00
    mexbolindex |           0            776           0.00
   ctsek10ygovt |           0            776           0.00
      clacomdty |           0            776           0.00
      coacomdty |           0            776           0.00
   coalinequity |           0            776           0.00
      xb1comdty |           0            776           0.00
      ng1comdty |           0            776           0.00
      gc1comdty |           0            776           0.00
      si1comdty |           0            776           0.00
      hg1comdty |           0            776           0.00
   xptusdcurr~y |           0            776           0.00
      cc1comdty |           0            776           0.00
      lc1comdty |           0            776           0.00
      ho1comdty |           0            776           0.00
      qs1comdty |           0            776           0.00
      rr1comdty |           0            776           0.00
      sm1comdty |           0            776           0.00
      bo1comdty |           0            776           0.00
      rs1comdty |           0            776           0.00
      kc1comdty |           0            776           0.00
      jo1comdty |           0            776           0.00
      lb1comdty |           0            776           0.00
      or1comdty |           0            776           0.00
      dl1comdty |           0            776           0.00
      fc1comdty |           0            776           0.00
      lh1comdty |           0            776           0.00
    ctfrf9ygovt |           0            776           0.00
   ctgrd20ygovt |           0            776           0.00
    ctiep3ygovt |           0            776           0.00
    ctnok3ygovt |           0            776           0.00
    ctczk3ygovt |           0            776           0.00
    ctdkk3ygovt |           0            776           0.00
    ctdkk5ygovt |           0            776           0.00
    ctbef3ygovt |           0            776           0.00
      ctdemii5y |           0            776           0.00
    ctbrl5ygovt |           0            776           0.00
   ctbrlii30t~t |           0            776           0.00
    ctbrl3ygovt |           0            776           0.00
    ctnzd5ygovt |           1            776           0.13
    ctpln2ygovt |           0            776           0.00
   cteurlt2yg~t |           0            776           0.00
   ctzar10ygovt |           0            776           0.00
   ctgbpii5yg~t |           0            776           0.00
   ctgbp10ygovt |           0            776           0.00
    ctlvl2ygovt |           0            776           0.00
   cteurro6yg~t |           0            776           0.00
       daxindex |           0            776           0.00
       cacindex |           0            776           0.00
       aexindex |           0            776           0.00
      ibexindex |           0            776           0.00
       omxindex |           0            776           0.00
       smiindex |           1            776           0.13
       bsxindex |           0            776           0.00
      igpaindex |           0            776           0.00
       buxindex |           0            776           0.00
      rtsiindex |           1            776           0.13
       saxindex |           0            776           0.00
    kse100index |           0            776           0.00
    nse200index |           0            776           0.00
       hisindex |           0            776           0.00
     kospiindex |           0            776           0.00
    sensexindex |           0            776           0.00
      as51index |           0            776           0.00
       atxindex |           0            776           0.00
       aseindex |           0            776           0.00
     bel20index |           0            776           0.00
    omxc25index |           0            776           0.00
       hexindex |           0            776           0.00
     icexiindex |           0            776           0.00
      croxindex |           0            776           0.00
    ctxeurindex |           0            776           0.00
     rotxlindex |           1            776           0.13
    utxeurindex |           0            776           0.00
             yr |           0            776           0.00
----------------+-----------------------------------------------

. 
. *********************************************************************************
. /// Build the Outcome 
> 
. 
. /// Describe the Variables 
> describe $vars

Variable      Storage   Display    Value
    name         type    format    label      Variable label
-----------------------------------------------------------------------------------------------
ctjmd10ygovt    double  %10.0g              * CTJMD10Y Govt
ctmxn10ygovt    double  %10.0g              * CTMXN10Y Govt
ctchf10ygovt    double  %10.0g              * CTCHF10Y Govt
ctclp10ygovt    double  %10.0g              * CTCLP10Y Govt
spxindex        double  %10.0g              * SPX Index
ftsemibindex    double  %10.0g              * FTSEMIB Index
induindex       double  %10.0g              * INDU Index
mexbolindex     double  %10.0g              * MEXBOL Index
ctsek10ygovt    double  %10.0g              * CTSEK10Y Govt
clacomdty       double  %10.0g              * CLA Comdty
coacomdty       double  %10.0g              * COA Comdty
coalinequity    double  %10.0g              * COAL IN Equity
xb1comdty       double  %10.0g              * XB1 Comdty
ng1comdty       double  %10.0g              * NG1 Comdty
gc1comdty       double  %10.0g              * GC1 Comdty
si1comdty       double  %10.0g              * SI1 Comdty
hg1comdty       double  %10.0g              * HG1 Comdty
xptusdcurrncy   double  %10.0g              * XPTUSD Currncy
cc1comdty       int     %10.0g              * CC1 Comdty
lc1comdty       double  %10.0g              * LC1 Comdty
ho1comdty       double  %10.0g              * HO1 Comdty
qs1comdty       double  %10.0g              * QS1 Comdty
rr1comdty       double  %10.0g              * RR1 Comdty
sm1comdty       double  %10.0g              * SM1 Comdty
bo1comdty       double  %10.0g              * BO1 Comdty
rs1comdty       double  %10.0g              * RS1 Comdty
kc1comdty       double  %10.0g              * KC1 Comdty
jo1comdty       double  %10.0g              * JO1 Comdty
lb1comdty       double  %10.0g              * LB1 Comdty
or1comdty       double  %10.0g              * OR1 Comdty
dl1comdty       double  %10.0g              * DL1 Comdty
fc1comdty       double  %10.0g              * FC1 Comdty
lh1comdty       double  %10.0g              * LH1 Comdty
ctfrf9ygovt     double  %10.0g              * CTFRF9Y Govt
ctgrd20ygovt    double  %10.0g              * CTGRD20Y GOVT
ctiep3ygovt     double  %10.0g              * CTIEP3Y GOVT
ctnok3ygovt     double  %10.0g              * CTNOK3Y GOVT
ctczk3ygovt     double  %10.0g              * CTCZK3Y GOVT
ctdkk3ygovt     double  %10.0g              * CTDKK3Y GOVT
ctdkk5ygovt     double  %10.0g              * CTDKK5Y GOVT
ctbef3ygovt     double  %10.0g              * CTBEF3Y GOVT
ctdemii5y       double  %10.0g              * CTDEMII5Y
ctbrl5ygovt     double  %10.0g              * CTBRL5Y GOVT
ctbrlii30tgovt  double  %10.0g              * CTBRLII30T GOVT
ctbrl3ygovt     double  %10.0g              * CTBRL3Y GOVT
ctnzd5ygovt     double  %10.0g              * CTNZD5Y GOVT
ctpln2ygovt     double  %10.0g              * CTPLN2Y GOVT
cteurlt2ygvot   double  %10.0g              * CTEURLT2Y GVOT
ctzar10ygovt    double  %10.0g              * CTZAR10Y GOVT
ctgbpii5ygovt   double  %10.0g              * CTGBPII5Y GOVT
ctgbp10ygovt    double  %10.0g              * CTGBP10Y GOVT
ctlvl2ygovt     double  %10.0g              * CTLVL2Y GOVT
cteurro6ygovt   double  %10.0g              * CTEURRO6Y GOVT
daxindex        double  %10.0g              * DAX Index
cacindex        double  %10.0g              * CAC Index
aexindex        double  %10.0g              * AEX Index
ibexindex       double  %10.0g              * IBEX Index
omxindex        double  %10.0g              * OMX Index
smiindex        double  %10.0g              * SMI Index
bsxindex        double  %10.0g              * BSX Index
igpaindex       double  %10.0g              * IGPA Index
buxindex        double  %10.0g              * BUX Index
rtsiindex       double  %10.0g              * RTSI Index
saxindex        double  %10.0g              * SAX Index
kse100index     double  %10.0g              * KSE100 Index
nse200index     double  %10.0g              * NSE200 Index
hisindex        double  %10.0g              * HIS Index
kospiindex      double  %10.0g              * KOSPI Index
sensexindex     double  %10.0g              * SENSEX Index
as51index       double  %10.0g              * AS51 Index
atxindex        double  %10.0g              * ATX Index
aseindex        double  %10.0g              * ASE Index
bel20index      double  %10.0g              * BEL20 Index
omxc25index     double  %10.0g              * OMXC25 Index
hexindex        double  %10.0g              * HEX Index
icexiindex      double  %10.0g              * ICEXI Index
croxindex       double  %10.0g              * CROX Index
ctxeurindex     double  %10.0g              * CTXEUR Index
rotxlindex      double  %10.0g              * ROTXL Index
utxeurindex     double  %10.0g              * UTXEUR Index

. tempfile varnames

. descsave $vars, saving(`varnames', replace)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000i not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000i saved as .dta format

. 
. preserve 

. use `varnames', clear

. keep order name varlab 

. gen sec_id = order + 1

. drop order 

. save `varnames', replace 
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000i saved as .dta format

. restore 

. 
. 
. local varlist $vars

. local i = 2

. foreach var of local varlist {
  2.         global name`i' =  "`var'"
  3.         rename `var' var`i'
  4.         local i = `i' + 1
  5. }

. 
. reshape long var, i(date) j(sec_id)
(j = 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34
>  35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65
>  66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations              776   ->   62,080      
Number of variables                  82   ->   4           
j variable (80 values)                    ->   sec_id
xij variables:
                    var2 var3 ... var81   ->   var
-----------------------------------------------------------------------------

. drop yr 

. merge m:1 sec_id using `varnames', keep(match master) nogen 
(variable sec_id was byte, now float to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                            62,080  
    -----------------------------------------

. rename var volatility 

. ********************************************************************************
. /// Add Yield as an outcome. This is to do the graphs 
> clonevar yield = volatility
(5 missing values generated)

. ********************************************************************************
. save "${tem}/bloombergprices_clean.dta", replace 
file 1_Data/Temp//bloombergprices_clean.dta saved

. 
. exit 

end of do-file

. /// 0) CARES Ranking for Robustness Check 
> do "${cod}/code_dataprep/0_CARES_Ranking.do"

. ********************************************************************************
. ********************************************************************************
. *** Project: Volatility in the Municipal Bond Market and the MLF 
. *** Authors: Felipe Lozano & Luis Navarro 
. *** Code by: Luis Navarro 
. *** Script: CARES Act Distribution Categorization 
. *** This Update: January 2023 
. ********************************************************************************
. ********************************************************************************
. /// Population Estimates
> import delimited "${raw}/nst-est2019-alldata.csv", clear varnames(1)
(encoding automatically selected: ISO-8859-1)
(151 vars, 57 obs)

. drop if state == 0 
(5 observations deleted)

. statastates, name(name)
(52 real changes made)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             1
        from master                         1  (_merge==1)
        from using                          0  (_merge==2)

    Matched                                51  (_merge==3)
    -----------------------------------------

. drop if state_fips == .
(1 observation deleted)

. keep state_fips popestimate2019

. tempfile population

. save `population', replace 
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000001 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000001 saved as .dta format

. 
. /// CRF Allocations 
> import excel "${raw}/crf_allocations.xlsx", sheet("Sheet1") firstrow clear 
(3 vars, 50 obs)

. statastates, name(state)
(50 real changes made)
(variable state_name was str14, now str20 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             1
        from master                         0  (_merge==1)
        from using                          1  (_merge==2)

    Matched                                50  (_merge==3)
    -----------------------------------------

. drop if state_fips == .
(0 observations deleted)

. merge 1:1 state_fips using `population', keep(match master) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                51  
    -----------------------------------------

. replace crf_allocation = 495138063.60 if state == "DISTRICT OF COLUMBIA"
(1 real change made)

. gen crf_allocation_percapita = crf_allocation/popestimate2019

. keep state_fips state crf_allocation* popestimate2019 

. gen crf_rule = "Fixed Allocation" if crf_allocation <= 1250000000
(29 missing values generated)

. replace crf_rule = "Variable Allocation" if crf_allocation > 1250000000
variable crf_rule was str16 now str19
(29 real changes made)

. tempfile crf_allocation

. save `crf_allocation', replace 
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000002 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000002 saved as .dta format

. 
. /// Total Allocations 
> import excel "${raw}/FFIS_COVID_19_State_by_State_Allocations.20.xlsx", sheet("clean_allocati
> ons") firstrow clear 
(85 vars, 70 obs)

. statastates, name(State)
(67 real changes made)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            19
        from master                        19  (_merge==1)
        from using                          0  (_merge==2)

    Matched                                51  (_merge==3)
    -----------------------------------------

. drop if state_fips == . 
(19 observations deleted)

. 
. /// Create Allocation Variables 
> rename (State CoronavirusReliefFund TOTAL) (state crf total)

. keep state total state_abbrev

. merge 1:1 state using `crf_allocation', keep(match master) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                51  
    -----------------------------------------

. destring total, replace
total: all characters numeric; replaced as double

. replace total = total*1000
(51 real changes made)

. /// create some variables 
> gen total_percapita = total/popestimate2019

. gen crf_percapita = crf_allocation/popestimate2019

. gen crf_billions = crf_allocation/1000000000

. gen pop_millions = popestimate2019/1000000

. 
. //// Rule: Total Funding Provided Per Capita 
> cumul total_percapita, gen(total_percapita_ecfd)

. sort total_percapita_ecfd

. 
. gen fedsupport_categories = ""
(51 missing values generated)

. replace fedsupport_categories = "p0-p50" if   total_percapita_ecfd <= 0.50
variable fedsupport_categories was str1 now str6
(25 real changes made)

. replace fedsupport_categories = "p51-p100" if  total_percapita_ecfd > 0.50 
variable fedsupport_categories was str6 now str8
(26 real changes made)

. 
. /// Extra: CRF Rule 
> /*
> cap drop fedsupport_categories
> cumul crf_percapita, gen(crf_percapita_ecfd)
> sort crf_percapita_ecfd
> 
> gen fedsupport_categories = ""
> replace fedsupport_categories = "p0-p50" if   crf_percapita_ecfd <= 0.50
> replace fedsupport_categories = "p51-p100" if  crf_percapita_ecfd > 0.50 
> */
. 
. 
. /// Grant Funding Across States Scatters 
> global title title(,pos(11) size(3) color(black))

. global back plotregion(color()) graphregion(color() margin(4 4 4 4)) plotregion(lcolor(black)
> ) 

. global graph_options xtitle(, size(medsmall)) ytitle(size(small)) ylabel(#10, nogrid labsize(
> small) angle(0)) xlabel(#16, labsize(small) angle(0) nogrid) title(, size(medsmall) pos(11) c
> olor(black)) $back 

. 
. save "${tem}/states_funding_distribution.dta",replace 
file 1_Data/Temp//states_funding_distribution.dta saved

. 
. keep state_abbrev fedsupport_categories

. rename state_abbrev StateCode

. sort StateCode

. save "${tem}/cares_rankings.dta",replace 
file 1_Data/Temp//cares_rankings.dta saved

. 
. 
. 
. 
. 
. 
end of do-file

. /// 1) Clean Bloomberg State Bond Data and Merge it with MSRB data 
> do "${cod}/code_dataprep/1_Clean_State_Bonds_Bloomberg_MSRB.do"

. ********************************************************************************
. ********************************************************************************
. *** Project: Volatility in the Municipal Bond Market and the MLF 
. *** Authors: Felipe Lozano & Luis Navarro 
. *** Code by: Luis Navarro 
. *** Script: Clean Bloomberg State Data and Merge with MSRB Secondary Market
. *** This Update: February 2024
. ********************************************************************************
. ********************************************************************************
. /// Bloomberg Primary Market Bonds
> /// All Bonds (Active and Matured) issued by State Governments between 2019 and 2021
> 
. forvalues i=1(1)2{
  2. import excel "${raw}/state_bonds_bloomberg.xlsx", sheet("Sheet`i'") firstrow clear
  3. tempfile statebonds`i'
  4. save `statebonds`i'', replace 
  5. }
(20 vars, 4,864 obs)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000001 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000001 saved as .dta format
(20 vars, 4,409 obs)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000002 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000002 saved as .dta format

. 
. use `statebonds1', clear

. append using `statebonds2'
(variable BondPurpose was str64, now str65 to accommodate using data's values)

. ********************************************************************************
. /// Do the credit rating analysis here 
> // https://financestu.com/sp-vs-moodys-vs-fitch/
. // https://www.moneyland.ch/en/rating-agencies
. // https://www.moodys.com/sites/products/productattachments/ap075378_1_1408_ki.pdf
. 
. /// Standardize Credit Ratings 
> /// replaces NAs with empty cells 
> replace SPInitRtg = "" if SPInitRtg == "#N/A N/A"
(1,374 real changes made)

. replace MdyInitRtg = "" if MdyInitRtg == "#N/A N/A"
(1,236 real changes made)

. replace FitchInitRtg = "" if FitchInitRtg == "#N/A N/A"
(3,195 real changes made)

. 
. /*
> 
> *** Standard and Poors 
> generate StandardPoors = .
> replace StandardPoors = 1 if SPInitRtg == "AAA"
> replace StandardPoors = 2 if SPInitRtg == "AA+"
> replace StandardPoors = 3 if SPInitRtg == "AA"
> replace StandardPoors = 4 if SPInitRtg == "AA-"
> replace StandardPoors = 5 if SPInitRtg == "A+"
> replace StandardPoors = 6 if SPInitRtg == "A"
> replace StandardPoors = 7 if SPInitRtg == "A-"
> replace StandardPoors = 8 if SPInitRtg == "BBB+"
> replace StandardPoors = 9 if SPInitRtg == "BBB"
> replace StandardPoors = 10 if SPInitRtg == "BBB-"
> 
> **** Fitch
> generate Fitch = .
> replace Fitch = 1 if FitchInitRtg == "AAA"
> replace Fitch = 2 if FitchInitRtg == "AA+"
> replace Fitch = 3 if FitchInitRtg == "AA"
> replace Fitch = 4 if FitchInitRtg == "AA-"
> replace Fitch = 5 if FitchInitRtg == "A+"
> replace Fitch = 6 if FitchInitRtg == "A"
> replace Fitch = 7 if FitchInitRtg == "A-"
> replace Fitch = 8 if FitchInitRtg == "BBB+"
> replace Fitch = 9 if FitchInitRtg == "BBB"
> replace Fitch = 10 if FitchInitRtg == "BBB-"
> 
> 
> **** Moodys
> generate Moodys = .
> replace Moodys = 1 if MdyInitRtg == "Aaa"
> replace Moodys = 2 if MdyInitRtg == "Aa1"
> replace Moodys = 3 if MdyInitRtg == "Aa2"
> replace Moodys = 4 if MdyInitRtg == "Aa3"
> replace Moodys = 5 if MdyInitRtg == "A1"
> replace Moodys = 6 if MdyInitRtg == "A2"
> replace Moodys = 7 if MdyInitRtg == "A3"
> replace Moodys = 8 if MdyInitRtg == "Baa1"
> replace Moodys = 9 if MdyInitRtg == "Baa2"
> replace Moodys = 10 if MdyInitRtg == "Baa3"
> 
> */
. 
. /// Create Rating Variables 
> generate StandardPoors = .
(9,273 missing values generated)

. replace  StandardPoors = 1  if SPInitRtg == "AAA" | SPInitRtg == "SP-1+" | SPInitRtg == "AAA/
> A-1+"
(1,647 real changes made)

. replace  StandardPoors = 2  if SPInitRtg == "AA+" | SPInitRtg == "AA+/A-1" | SPInitRtg == "AA
> +/A-1+"
(2,435 real changes made)

. replace  StandardPoors = 3  if SPInitRtg == "AA" | SPInitRtg == "SP-1" | SPInitRtg == "AA/A-1
> " | SPInitRtg == "AA/A-1+"
(1,707 real changes made)

. replace  StandardPoors = 4  if SPInitRtg == "AA-"
(870 real changes made)

. replace  StandardPoors = 5  if SPInitRtg == "A+"
(384 real changes made)

. replace  StandardPoors = 6  if SPInitRtg == "A" | SPInitRtg == "SP-2" | SPInitRtg == "A/A-1" 
(320 real changes made)

. replace  StandardPoors = 7  if SPInitRtg == "A-"
(118 real changes made)

. replace  StandardPoors = 8  if SPInitRtg == "BBB+"
(81 real changes made)

. replace  StandardPoors = 9  if SPInitRtg == "BBB" | SPInitRtg == "SP-3"
(95 real changes made)

. replace  StandardPoors = 10 if SPInitRtg == "BBB-" | SPInitRtg == "BB+" | SPInitRtg == "BB" |
>  SPInitRtg == "BB-" | SPInitRtg == "B"
(225 real changes made)

. replace  StandardPoors = 11 if StandardPoors == . 
(1,391 real changes made)

. 
. // https://www.bonddesk.com/moodys.html#:~:text=There%20are%20four%20rating%20categories,spec
> ulative%20quality%20are%20designated%20SG.
. ** Moody's 
. generate Moodys = .
(9,273 missing values generated)

. replace  Moodys = 1  if MdyInitRtg == "Aaa" | MdyInitRtg == "MIG1" | MdyInitRtg == "VMIG1" | 
> MdyInitRtg == "Aaa/VMIG1"
(2,029 real changes made)

. replace  Moodys = 2  if MdyInitRtg == "Aa3"
(522 real changes made)

. replace  Moodys = 3  if MdyInitRtg == "Aa2" | MdyInitRtg == "MIG2" | MdyInitRtg == "Aa2/VMIG1
> " 
(1,678 real changes made)

. replace  Moodys = 4  if MdyInitRtg == "Aa1" | MdyInitRtg == "Aa1/VMIG1"
(2,646 real changes made)

. replace  Moodys = 5  if MdyInitRtg == "A3"
(88 real changes made)

. replace  Moodys = 6  if MdyInitRtg == "A2" | MdyInitRtg == "MIG3" | MdyInitRtg == "VMIG3"
(261 real changes made)

. replace  Moodys = 7  if MdyInitRtg == "A1" 
(461 real changes made)

. replace  Moodys = 8  if MdyInitRtg == "Baa3"
(195 real changes made)

. replace  Moodys = 9  if MdyInitRtg == "Baa2" | MdyInitRtg == "SG"
(20 real changes made)

. replace  Moodys = 10 if MdyInitRtg == "Baa1" | MdyInitRtg == "MIG4" | MdyInitRtg == "VMIG4"
(93 real changes made)

. replace  Moodys = 11 if Moodys == . 
(1,280 real changes made)

. 
. **** Fitch
. /// https://www.fitchratings.com/products/rating-definitions#about-rating-definitions
> generate Fitch = .
(9,273 missing values generated)

. replace  Fitch = 1  if FitchInitRtg == "AAA" | FitchInitRtg == "F1+" 
(1,383 real changes made)

. replace  Fitch = 2  if FitchInitRtg == "AA+" | FitchInitRtg == "AA+/F1+"
(2,566 real changes made)

. replace  Fitch = 3  if FitchInitRtg == "AA" | FitchInitRtg == "AA/F1+" | FitchInitRtg == "F1"
(1,155 real changes made)

. replace  Fitch = 4  if FitchInitRtg == "AA-" 
(327 real changes made)

. replace  Fitch = 5  if FitchInitRtg == "A+"
(267 real changes made)

. replace  Fitch = 6  if FitchInitRtg == "A" | FitchInitRtg == "F2" | FitchInitRtg == "A(EXP)"
(75 real changes made)

. replace  Fitch = 7  if FitchInitRtg == "A-"
(48 real changes made)

. replace  Fitch = 8  if FitchInitRtg == "BBB+"
(17 real changes made)

. replace  Fitch = 9  if FitchInitRtg == "BBB" | FitchInitRtg == "F3"
(118 real changes made)

. replace  Fitch = 10 if FitchInitRtg == "BBB-"
(114 real changes made)

. replace  Fitch = 11 if Fitch == . 
(3,203 real changes made)

. 
. 
. /// Create rating variable: max of the three ratings. since the rating are coded such 
> /// that a largest number is a lowest rating, taking the max means we are considering the low
> est 
> /// rating assigned by any of these agencies 
> gsort -StandardPoors -Moodys -Fitch

. generate rating = .
(9,273 missing values generated)

. /// when two are missing, assign the one we know 
> replace rating = StandardPoors if Moodys == 11 & Fitch == 11
(1,066 real changes made)

. replace rating = Moodys if StandardPoors == 11 & Fitch == 11
(749 real changes made)

. replace rating = Fitch if StandardPoors == 11 & Moodys == 11
(79 real changes made)

. //// when one is missing, take the average of the ones we have 
> replace rating = max(StandardPoors, Moodys) if Fitch == 11 & !(StandardPoors == 11 | Moodys =
> = 11)
(1,388 real changes made)

. replace rating = max(StandardPoors, Fitch) if Moodys == 11 & !(StandardPoors == 11 | Fitch ==
>  11)
(135 real changes made)

. replace rating = max(Moodys, Fitch) if StandardPoors == 11 & !(Moodys == 11 | Fitch == 11)
(267 real changes made)

. 
. replace rating = max(StandardPoors, Moodys, Fitch) if !(StandardPoors == 11 | Moodys == 11 | 
> Fitch == 11)
(5,589 real changes made)

. 
. 
. 
. /// Aggregated Rating Measure 
> gen rating_agg = 5 

. /// AAA = 1
> replace rating_agg = 1 if rating == 1
(1,446 real changes made)

. /// AA = 2, 3, 4
> replace rating_agg = 2 if rating == 2 | rating == 3 |rating == 4
(5,633 real changes made)

. /// A = 5, 6, 7
> replace rating_agg = 3 if rating == 5 | rating == 6 |rating == 7
(1,271 real changes made)

. /// BBB = 8, 9, 10 
> replace rating_agg = 4 if rating == 8 | rating == 9 |rating == 10
(627 real changes made)

. label define rating_agg  1 "AAA" 2 "AA" 3 "A" 4 "BBB" 5 "NR"

. label values rating_agg rating_agg

. /// Express in strings 
> gen rating_agg_str = ""
(9,273 missing values generated)

. replace rating_agg_str = "AAA" if rating_agg == 1
variable rating_agg_str was str1 now str3
(1,446 real changes made)

. replace rating_agg_str = "AA" if rating_agg == 2
(5,633 real changes made)

. replace rating_agg_str = "A" if rating_agg == 3
(1,271 real changes made)

. replace rating_agg_str = "BBB" if rating_agg == 4
(627 real changes made)

. replace rating_agg_str = "NR" if rating_agg == 5
(296 real changes made)

. ********************************************************************************
. /// Filtering Assumptions 
> /// Exclude Puerto Rico and Guam 
> drop if StateCode == "PR" | StateCode == "GU" 
(29 observations deleted)

. /// Exclude Not Rated Bonds 
> drop if rating_agg_str == "NR"
(268 observations deleted)

. ********************************************************************************
. /// Save the bonds here 
> tempfile statebondscomplete

. save `statebondscomplete' ,replace 
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000003 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000003 saved as .dta format

. ********************************************************************************
. ********************************************************************************
. /// Data for the Ratings Map 
> use `statebondscomplete',clear 

. keep rating_agg StateCode IssueDate

. gen year = year(IssueDate)

. keep if year == 2019
(5,853 observations deleted)

. gcollapse (mean) rating_agg, by(StateCode)

. replace rating_agg = round(rating_agg)
(16 real changes made)

. sort rating_agg StateCode

. duplicates drop StateCode, force 

Duplicates in terms of StateCode

(0 observations are duplicates)

. statastates, abbreviation(StateCode)
(0 real changes made)

    Result                      Number of obs
    -----------------------------------------
    Not matched                            13
        from master                         0  (_merge==1)
        from using                         13  (_merge==2)

    Matched                                38  (_merge==3)
    -----------------------------------------

. replace rating_agg = 5 if rating_agg == .
(13 real changes made)

. drop _merge

. save "${tem}/state_ratings_data.dta", replace 
file 1_Data/Temp//state_ratings_data.dta saved

. 
. *******************************************************************************
. //// Secondary Market Bonds 
> /// Import data from the full market and then match on the cusips. 
> use "${raw}/msrb_states1921.dta", clear 

. merge m:1 CUSIP using `statebondscomplete', keep(match) nogen 
(variable CUSIP was str10, now str17 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           474,004  
    -----------------------------------------

. destring PAR_TRADED, replace 
PAR_TRADED: all characters numeric; replaced as long

. /// Export data for the analysis 
> save "${tem}/statebondsfull_secondary.dta",replace 
file 1_Data/Temp//statebondsfull_secondary.dta saved

. ********************************************************************************
. /// Keep Only CUSIPs
> keep CUSIP 

. duplicates drop CUSIP, force 

Duplicates in terms of CUSIP

(465,147 observations deleted)

. export delimited "${tem}/cusips_msrb.txt", replace 
file 1_Data/Temp//cusips_msrb.txt saved

. 
. ********************************************************************************
. /// Data with Fixed Credit Rating Cohort 
> use "${tem}/statebondsfull_secondary.dta",clear 

. drop rating rating_agg rating_agg_str

. /// Assign Credit Rating 
> merge m:1 StateCode using "${tem}/state_ratings_data.dta", keep(match master) nogen 
(label rating_agg already defined)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           474,004  
    -----------------------------------------

. gen rating_agg_str = ""
(474,004 missing values generated)

. replace rating_agg_str = "AAA" if rating_agg == 1
variable rating_agg_str was str1 now str3
(50,236 real changes made)

. replace rating_agg_str = "AA" if rating_agg == 2
(351,473 real changes made)

. replace rating_agg_str = "A" if rating_agg == 3
(37,108 real changes made)

. replace rating_agg_str = "BBB" if rating_agg == 4
(21,457 real changes made)

. replace rating_agg_str = "NR" if rating_agg == 5
(13,730 real changes made)

. /// Assumption: Drop Not Rated States 
> drop if rating_agg_str == "NR"
(13,730 observations deleted)

. /// Display Groups
> table state_name rating_agg_str

----------------------------------------------------------------------
                       |                 rating_agg_str               
                       |       A        AA      AAA      BBB     Total
-----------------------+----------------------------------------------
state_name             |                                              
  ARIZONA              |                              11,829    11,829
  ARKANSAS             |               301                         301
  CALIFORNIA           |            96,813                      96,813
  COLORADO             |             8,353                       8,353
  CONNECTICUT          |  19,919                                19,919
  DELAWARE             |                      5,308              5,308
  DISTRICT OF COLUMBIA |            22,688                      22,688
  FLORIDA              |                     15,767             15,767
  GEORGIA              |                      5,798              5,798
  HAWAII               |             7,281                       7,281
  IDAHO                |                        549                549
  ILLINOIS             |                               9,628     9,628
  INDIANA              |            16,514                      16,514
  IOWA                 |             2,199                       2,199
  LOUISIANA            |             7,489                       7,489
  MAINE                |             2,192                       2,192
  MARYLAND             |                     14,912             14,912
  MASSACHUSETTS        |            42,621                      42,621
  MINNESOTA            |             6,627                       6,627
  MISSISSIPPI          |   4,923                                 4,923
  NEBRASKA             |               120                         120
  NEVADA               |             1,657                       1,657
  NEW MEXICO           |               461                         461
  NEW YORK             |            10,162                      10,162
  NORTH CAROLINA       |            10,576                      10,576
  OHIO                 |            25,583                      25,583
  OREGON               |            16,656                      16,656
  PENNSYLVANIA         |  12,266                                12,266
  RHODE ISLAND         |             2,955                       2,955
  SOUTH CAROLINA       |               839                         839
  TENNESSEE            |                        959                959
  TEXAS                |            22,178                      22,178
  UTAH                 |                      5,097              5,097
  VERMONT              |             1,380                       1,380
  VIRGINIA             |                      1,846              1,846
  WASHINGTON           |            26,149                      26,149
  WEST VIRGINIA        |             2,782                       2,782
  WISCONSIN            |            16,897                      16,897
  Total                |  37,108   351,473   50,236   21,457   460,274
----------------------------------------------------------------------

. 
. gcollapse (mean) YIELD, by(rating_agg TRADE_DATE) 

. xtset rating_agg TRADE_DATE

Panel variable: rating_agg (unbalanced)
 Time variable: TRADE_DATE, 03jan2019 to 30dec2021, but with gaps
         Delta: 1 day

. rename (YIELD TRADE_DATE) (yield date)

. reshape wide yield, i(date) j(rating_agg)
(j = 1 2 3 4)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations            2,892   ->   754         
Number of variables                   3   ->   5           
j variable (4 values)        rating_agg   ->   (dropped)
xij variables:
                                  yield   ->   yield1 yield2 ... yield4
-----------------------------------------------------------------------------

. 
. *global lab0 "nr" 
. global lab1 "3a" 

. global lab2 "2a" 

. global lab3 "a" 

. global lab4 "3b"

. 
. forvalues i=1(1)4{
  2.     label variable yield`i' "Yield - ${lab`i'}"
  3.         rename yield`i' yield${lab`i'}
  4. }

. save "${tem}/secondary_rating_fixedcr.dta",replace 
file 1_Data/Temp//secondary_rating_fixedcr.dta saved

. 
. 
. ********************************************************************************
. /// Robustness Check: Groups by Credit Rating, allowing states to change 
> use "${tem}/statebondsfull_secondary.dta",clear 

. /// Collapse Data to Have Credit Rating by Day Observations 
> /// Collapse the data by credit rating and day. So we are taking the average across states, f
> ixing the credit rating. 
> gcollapse (mean) YIELD, by(rating_agg TRADE_DATE) 

. xtset rating_agg TRADE_DATE

Panel variable: rating_agg (unbalanced)
 Time variable: TRADE_DATE, 03jan2019 to 30dec2021, but with gaps
         Delta: 1 day

. rename (YIELD TRADE_DATE) (yield date)

. reshape wide yield, i(date) j(rating_agg)
(j = 1 2 3 4)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations            2,930   ->   754         
Number of variables                   3   ->   5           
j variable (4 values)        rating_agg   ->   (dropped)
xij variables:
                                  yield   ->   yield1 yield2 ... yield4
-----------------------------------------------------------------------------

. 
. *global lab0 "nr" 
. global lab1 "3a" 

. global lab2 "2a" 

. global lab3 "a" 

. global lab4 "3b"

. 
. forvalues i=1(1)4{
  2.     label variable yield`i' "Yield - ${lab`i'}"
  3.         rename yield`i' yield${lab`i'}
  4. }

. save "${tem}/secondary_rating.dta", replace  
file 1_Data/Temp//secondary_rating.dta saved

. 
.  
. *********************************************************************************
. /// Data for Robustness Checks on Heterogeneity of Federal Support 
> use "${tem}/statebondsfull_secondary.dta",clear 

. drop rating rating_agg rating_agg_str

. /// Assign Credit Rating 
> merge m:1 StateCode using "${tem}/state_ratings_data.dta", keep(match master) nogen 
(label rating_agg already defined)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           474,004  
    -----------------------------------------

. gen rating_agg_str = ""
(474,004 missing values generated)

. replace rating_agg_str = "AAA" if rating_agg == 1
variable rating_agg_str was str1 now str3
(50,236 real changes made)

. replace rating_agg_str = "AA" if rating_agg == 2
(351,473 real changes made)

. replace rating_agg_str = "A" if rating_agg == 3
(37,108 real changes made)

. replace rating_agg_str = "BBB" if rating_agg == 4
(21,457 real changes made)

. replace rating_agg_str = "NR" if rating_agg == 5
(13,730 real changes made)

. /// Assumption: Drop Not Rated States 
> drop if rating_agg_str == "NR"
(13,730 observations deleted)

. merge m:1 StateCode using "${tem}/cares_rankings.dta", keep(match master) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                           460,274  
    -----------------------------------------

. drop if fedsupport_categories == ""
(0 observations deleted)

. /// Collapse the data by credit rating - percentiles and day. So we are taking the average ac
> ross states, fixing the credit rating - percentiles of CRF.
> gen group = rating_agg_str + "-" + fedsupport_categories

. 
. gcollapse (mean) YIELD, by(group TRADE_DATE) 

. encode group, gen(group1) 

. xtset group1 TRADE_DATE

Panel variable: group1 (unbalanced)
 Time variable: TRADE_DATE, 03jan2019 to 30dec2021, but with gaps
         Delta: 1 day

. rename (YIELD TRADE_DATE) (yield date)

. cap drop group

. reshape wide yield, i(date) j(group1)
(j = 1 2 3 4 5 6 7 8)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations            5,547   ->   754         
Number of variables                   3   ->   9           
j variable (8 values)            group1   ->   (dropped)
xij variables:
                                  yield   ->   yield1 yield2 ... yield8
-----------------------------------------------------------------------------

. 
. *global lab1 "A-Fixed Allocation"
. *global lab2 "A-Variable Allocation"
. *global lab3 "AA-Fixed Allocation"
. *global lab4 "AA-Variable Allocation"
. *global lab5 "AAA-Fixed Allocation"
. *global lab6 "AAA-Variable Allocation"
. *global lab7 "BBB-Fixed Allocation"
. *global lab8 "BBB-Variable Allocation"
. 
. *global lab1 "A-p0-p33" 
. *global lab2 "A-p34-p66"
. *global lab3 "A-p67-p100"       
. *global lab4 "AA-p0-p33"        
. *global lab5 "AA-p34-p66"       
. *global lab6 "AA-p67-p100"      
. *global lab7 "AAA-p0-p33"       
. *global lab8 "AAA-p34-p66"      
. *global lab9 "AAA-p67-p100"
. *global lab10 "BBB-p0-p33"      
. *global lab11 "BBB-p34-p66"        
. *global lab12 "BBB-p67-p100"
. 
. global lab1 "A-p0-p50"          

. global lab2 "A-p51-p100"                

. global lab3 "AA-p0-p50"         

. global lab4 "AA-p51-p100"               

. global lab5 "AAA-p0-p50"                

. global lab6 "AAA-p51-p100"      

. global lab7 "BBB-p0-p50"                

. global lab8 "BBB-p51-p100"      

. 
. 
. forvalues i=1(1)8{
  2.     label variable yield`i' "Yield - ${lab`i'}"
  3.         *label variable par`i' "Par Traded - ${lab`i'}"
. }

. save "${tem}/secondary_rating_crf.dta",replace 
file 1_Data/Temp//secondary_rating_crf.dta saved

. *********************************************************************************
. 
. exit 

end of do-file

. /// 2) Clean Standard & Poor's Municipal Bond Index Data 
> do "${cod}/code_dataprep/2_StateSPMuniData.do"

. ********************************************************************************
. ********************************************************************************
. *** Project: Volatility in the Municipal Bond Market and the MLF 
. *** Authors: Felipe Lozano & Luis Navarro 
. *** Code by: Luis Navarro 
. *** Script: Clean S&P Municipal Bond Indices 
. *** This Update: September 2022 
. ********************************************************************************
. ********************************************************************************
. /// Read the variables 
> forvalues i=1(1)10{
  2. qui import excel "${raw}/sp_muni_raw.xlsx", sheet("Sheet`i'") firstrow clear case(lower)
  3. tempfile muni`i'
  4. qui save `muni`i''
  5. }

. 
. use `muni1', clear

. drop if _n >= 1
(98 observations deleted)

. 
. forvalues i=1(1)10{
  2.     append using `muni`i''
  3. }

. 
. /// Manual Corrections 
> local r1 af mass_index 

. local r2 ak mass_index 

. local r3 bd mass_index 

. local r4 av nc_gen

. local r5 ba nc_gen

. local r6 bt nc_gen

. local r7 bq nc_index

. local r8 bf ri_index

. local r9 bk ri_index

. 
. global shape af ak bd av ba bt bq bf bk 

. local varlist $shape

. local i = 1

. foreach var of local varlist {
  2.     preserve 
  3.         qui drop if spmunicipalbondalabamagener == .
  4.         keep `var' dates
  5.         rename `r`i''
  6.         tempfile `var'
  7.         save `var', replace 
  8.         restore 
  9.         local i = `i' + 1
 10. }
file af.dta saved
file ak.dta saved
file bd.dta saved
file av.dta saved
file ba.dta saved
file bt.dta saved
file bq.dta saved
file bf.dta saved
file bk.dta saved

. 
. /// Append Corrected variables 
> preserve 

. use af, clear

. drop mass_index 

. foreach var of local varlist {
  2. merge 1:1 dates using `var', keep(match master) nogen
  3. }

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             2,447  
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             2,447  
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             2,447  
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             2,447  
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             2,447  
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             2,447  
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             2,447  
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             2,447  
    -----------------------------------------

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             2,447  
    -----------------------------------------

. tempfile corrections 

. save `corrections', replace 
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000u not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000u saved as .dta format

. restore

. /// Drop missings 
> drop if spmunicipalbondalabamagener == .
(7 observations deleted)

. /// Drop Incorrect Variables
> drop $shape 

. 
. merge 1:1 dates using `corrections', keep(match master) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                             2,447  
    -----------------------------------------

. rename spmunicipalbond* *

. 
. /// Until I know how to solve the merge, I will exclude them 
> drop nc_gen nc_index mass_index ri_index

. **********************************************************************************
. /// General Obligation 
> global goindex alabamagener coloradogene generaloblig californiage georgiagener connecticutg 
> floridagener illinoisgene delawaregene mainegeneral louisianagen marylandgene indianagener ma
> ssachusetts michigangene minnesotagen missourigene nebraskagene nevadagenera newjerseyge newm
> exicoge ohiogeneral oklahomagene oregongenera pennsylvania rhodeisland southcarolin tennessee
> gen texasgeneral utahgeneral virginiagene washingtonge wisconsingen 

. 
. 
. keep dates $goindex 

. 
. local varlist $goindex

. local i = 1 

. foreach var of local varlist {
  2.     local name`i' = "`var'"
  3.         rename `var' v`i'
  4.         local i = `i' + 1
  5. }

. 
. reshape long v, i(dates) j(id)
(j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations            2,447   ->   80,751      
Number of variables                  34   ->   3           
j variable (33 values)                    ->   id
xij variables:
                          v1 v2 ... v33   ->   v
-----------------------------------------------------------------------------

. gen name = ""
(80,751 missing values generated)

. 
. forvalues i=1(1)34{
  2. replace name = "`name`i''" if id == `i'
  3. }
variable name was str1 now str12
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
variable name was str12 now str13
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(2,447 real changes made)
(0 real changes made)

. 
. split name, parse("gen")
variables created as string: 
name1  name2

. replace name1 = "rhode island" if name == "rhodeisland"
(2,447 real changes made)

. replace name1 = "go index" if name == "generaloblig"
(2,447 real changes made)

. replace name1 = "california" if name == "californiage"
(2,447 real changes made)

. replace name1 = "connecticut" if name == "connecticutg"
(2,447 real changes made)

. replace name1 = "new jersey" if name == "newjerseyge"
(2,447 real changes made)

. replace name1 = "new mexico" if name == "newmexicoge"
(2,447 real changes made)

. replace name1 = "south carolina" if name == "southcarolin"
variable name1 was str13 now str14
(2,447 real changes made)

. replace name1 = "washington" if name == "washingtonge"
(2,447 real changes made)

. drop name name2 

. /// drop goindex
> drop if name1 == "go index"
(2,447 observations deleted)

. rename name1 state 

. statastates, name(state) nogen
(78,304 real changes made)
(variable state_name was str14, now str20 to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                            78,304  
    -----------------------------------------

. rename v volatility 

. rename state name 

. egen sec_id = group(name)

. drop state* id

. rename dates date 

. ********************************************************************************
. /// Add Yield as an outcome. This is to do the graphs 
> clonevar yield = volatility

. ********************************************************************************
. save "${tem}/spgoindex.dta", replace 
file 1_Data/Temp//spgoindex.dta saved

. exit 

end of do-file

. /// 3) Prepare the Dataset to Implement the Synthetic Control Method 
> do "${cod}/code_dataprep/3_SynthFinalPrep.do"

. ********************************************************************************
. ********************************************************************************
. *** Project: Volatility in the Municipal Bond Market and the MLF 
. *** Authors: Felipe Lozano & Luis Navarro 
. *** Code by: Luis Navarro 
. *** Script: Prepare Data for Synthetic Control 
. *** This Update: January 2024
. ********************************************************************************
. ********************************************************************************
. 
. /// Merge the Data
> use "${tem}/secondary_rating.dta", clear  

. keep date yield*

. *label variable yieldnr "Not Rated"
. label variable yield3a "AAA Bonds"

. label variable yield2a "AA Bonds"

. label variable yielda "A Bonds"

. label variable yield3b "BBB Bonds"

. 
. ********************************************************************************
. /// To use the synth package the data needs to be in a panel structure where each unit is a f
> inancial instrument. Oh boy, we need to reshape this stuff carefully. 
> /// First, lets rename the securities 
> 
. /// Rename variables to do the reshape 
> local varlist yield3a yield2a yielda yield3b

. local i = 1

. foreach var of local varlist {
  2.         global name`i' =  "`var'"
  3.         rename `var' var`i'
  4.         local i = `i' + 1
  5. }

. 
. /// Reshape Long 
> reshape long var, i(date) j(sec_id)
(j = 1 2 3 4)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations              754   ->   3,016       
Number of variables                   5   ->   3           
j variable (4 values)                     ->   sec_id
xij variables:
                     var1 var2 ... var4   ->   var
-----------------------------------------------------------------------------

. rename var volatility 

. tsset sec_id date

Panel variable: sec_id (strongly balanced)
 Time variable: date, 03jan2019 to 30dec2021, but with gaps
         Delta: 1 day

. /// Drop Not Rated Issuers  
> *drop if sec_id == 2
. sort sec_id date

. 
. /// Names and Varlabs
> gen name = ""
(3,016 missing values generated)

. replace name = "AAA" if sec_id == 1
variable name was str1 now str3
(754 real changes made)

. replace name = "AA" if sec_id == 2
(754 real changes made)

. replace name = "A" if sec_id == 3
(754 real changes made)

. replace name = "BBB" if sec_id == 4 
(754 real changes made)

. gen varlab = "State Bonds - " + name 

. gen data = "Outcome"

. ********************************************************************************
. /// Add Yield as an outcome. This is to do the graphs 
> clonevar yield = volatility
(89 missing values generated)

. ********************************************************************************
. /// Append the Donors 
> append using "${tem}/bloombergprices_clean.dta"
(variable sec_id was byte, now float to accommodate using data's values)
(variable name was str3, now str14 to accommodate using data's values)

. replace data = "Donor Prices" if data == ""
variable data was str7 now str12
(62,080 real changes made)

. append using  "${tem}/spgoindex.dta"
(variable name was str14, now str20 to accommodate using data's values)

. replace data = "SP Munis" if data == ""
(78,304 real changes made)

. 
. ********************************************************************************
. /// Compute the Standard Deviation of Weekly Prices 
> gen wofd= wofd(date + 1)

. /// Collapse at the weekly levels - This gets the weekly volatility measure  
> gcollapse (mean) date yield (sd) volatility, by(wofd name varlab data)

. //// Collapse by Month: Average of the 4 weeks at each month 
> gen mofd = mofd(date)

. gcollapse (mean) volatility yield date, by(mofd varlab name data) 

. format mofd %tmMon_CCYY

. gen year = year(date)

. gen treat = 0 

. replace treat = 1 if data == "Outcome"
(144 real changes made)

. tempfile data

. save `data', replace 
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000001 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000001 saved as .dta format

. ********************************************************************************
. /// Exclude Data From SP Muni Index on the Treatment Period 
> drop if data == "SP Munis" & year >= 2019 
(1,312 observations deleted)

. gsort -treat name mofd 

. ********************************************************************************
. /// Manual Replacement of the first unit of volatility for BBB January 2019 
> sum volatility if name == "BBB" & mofd == tm(2019m2)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
  volatility |          1    .3348089           .   .3348089   .3348089

. replace volatility = r(mean) if name == "BBB" & mofd == tm(2019m1) 
(1 real change made)

. mdesc volatility

    Variable    |     Missing          Total     Percent Missing
----------------+-----------------------------------------------
     volatility |           0          5,328           0.00
----------------+-----------------------------------------------

. ********************************************************************************
. /// Now I need to express everything in Experiment Time 
> /// This variable refers to the experiment cohort 
> gen year_exp = . 
(5,328 missing values generated)

. /// Variables to determine experiment-months. 36 periods. Treatment Happens in April of t+1, 
> so it is the 16th period 
> gen month = month(dofm(mofd))

. gen month_exp = month 

. /// Two Steps: First Save the Treated Cohort 
> replace year_exp = 1 if mofd >= tm(2019m1) & mofd <= tm(2021m12)
(3,024 real changes made)

. /// Store only the treated cohort (including donors from it)
> preserve 

. drop if data == "SP Munis"
(2,304 observations deleted)

. replace month_exp = month + 12 if year == 2020 
(1,008 real changes made)

. replace month_exp = month + 24 if year == 2021 
(1,008 real changes made)

. tempfile treated 

. save `treated' , replace 
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000003 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000003 saved as .dta format

. restore 

. 
. /// Second: Now I need to reshape the dataset so each cohort
> keep if data == "SP Munis"
(3,024 observations deleted)

. 
. /// List of Cohorts: 
> local cohort5 mofd >= tm(2013m1) & mofd <= tm(2015m12)

. local cohort4 mofd >= tm(2014m1) & mofd <= tm(2016m12)

. local cohort3 mofd >= tm(2015m1) & mofd <= tm(2017m12)

. local cohort2 mofd >= tm(2016m1) & mofd <= tm(2018m12)

. 
. 
. /// Keep observations at each cohort 
> forvalues i=2(1)5{
  2. preserve 
  3. keep if `cohort`i''
  4. sum year 
  5. local initial = r(min)
  6. replace month_exp = month + 12 if year == (`initial' + 1)
  7. replace month_exp = month + 24 if year == (`initial' + 2)
  8. replace year_exp = `i'
  9. tempfile cohort`i'
 10. save `cohort`i'', replace 
 11. restore 
 12. }
(1,152 observations deleted)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        year |      1,152        2017    .8168512       2016       2018
(384 real changes made)
(384 real changes made)
(1,152 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000005 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000005 saved as .dta format
(1,152 observations deleted)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        year |      1,152        2016    .8168512       2015       2017
(384 real changes made)
(384 real changes made)
(1,152 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000007 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000007 saved as .dta format
(1,152 observations deleted)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        year |      1,152        2015    .8168512       2014       2016
(384 real changes made)
(384 real changes made)
(1,152 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000009 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000009 saved as .dta format
(1,152 observations deleted)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        year |      1,152        2014    .8168512       2013       2015
(384 real changes made)
(384 real changes made)
(1,152 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000b not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000b saved as .dta format

. 
. /// Append them 
> use `cohort2', clear 

. forvalues i=3(1)5{
  2.         append using `cohort`i''
  3. }

. 
. /// Save them 
> tempfile munis

. save `munis', replace 
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000c not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000c saved as .dta format

. 
. 
. /// Finally, append them together with the treated untis 
> use `treated', clear 

. append using `munis'

. 
. ********************************************************************************
. /// Create IDs 
> /// First with Treated Units 
> egen id = group(name) if data == "Outcome"
(7,488 missing values generated)

. /// Second Identify Donors from the SP Data 
> egen id_sp = group(name year_exp) if data == "SP Munis"
(3,024 missing values generated)

. replace id = id_sp + 2000  if data == "SP Munis"
(4,608 real changes made)

. /// Third Identify Donors from the Bloomberg data 
> egen id_bloom = group(name) if data == "Donor Prices"
(4,752 missing values generated)

. replace id = id_bloom + 3000 if data == "Donor Prices"
(2,880 real changes made)

. drop id_bloom id_sp

. ********************************************************************************
. /// Homogeneous IDs 
> egen id1 = group(id)

. drop id 

. rename id1 id 

. tsset id month_exp

Panel variable: id (strongly balanced)
 Time variable: month_exp, 1 to 36
         Delta: 1 unit

. rename volatility v 

. save "${cln}/synth_clean.dta", replace 
file 1_Data/Clean//synth_clean.dta saved

. ********************************************************************************
. /// Save State Names 
> preserve 

. keep if treat == 1 
(7,488 observations deleted)

. keep id name 

. duplicates drop id name, force 

Duplicates in terms of id name

(140 observations deleted)

. save "${tem}/treated_names.dta", replace
file 1_Data/Temp//treated_names.dta saved

. restore 

. 
. /// All names 
> preserve  

. keep id name year_exp

. duplicates drop id name, force 

Duplicates in terms of id name

(7,420 observations deleted)

. save "${tem}/all_names.dta", replace
file 1_Data/Temp//all_names.dta saved

. restore 

. ********************************************************************************
. /// Compare the Outcomes between MSRB and SP Municipal Bond Indices 
> preserve 

. use `data', clear 

. keep if year >= 2019 
(2,304 observations deleted)

. drop if year == 2022 
(160 observations deleted)

. drop if data == "Donor Prices"
(2,880 observations deleted)

. gcollapse (mean) volatility, by(mofd treat data)

. drop data

. reshape wide volatility, i(mofd) j(treat)
(j = 0 1)

Data                               Long   ->   Wide
-----------------------------------------------------------------------------
Number of observations               72   ->   36          
Number of variables                   3   ->   3           
j variable (2 values)             treat   ->   (dropped)
xij variables:
                             volatility   ->   volatility0 volatility1
-----------------------------------------------------------------------------

. label variable volatility0 "SP Munis"

. label variable volatility1 "MSRB"

. 
. center volatility0, gen(vol0)
(generated variables: vol0)

. center volatility1, gen(vol1) 
(generated variables: vol1)

. 
. local lineopts lwidth(thin) 

. local gropts legend(off order(1 "MSRB" 2 "SP Muni Index") size(small)) ytitle("Volatility", s
> ize(small)) xlabel(#36, labsize(small) angle(90)) xtitle("") ylabel(#10, labsize(small) angle
> (0)) 

. 
. 
. twoway (line volatility1 mofd, lcolor(black) lpattern(solid) `lineopts') (line volatility0 mo
> fd, lcolor(cranberry) lpattern(dash) `lineopts'), title("Comparison of Volatility Measures", 
> size(small) pos(11)) name(outcomes_normal, replace) `gropts'

. twoway (line vol1 mofd, lcolor(black) lpattern(solid) `lineopts') (line vol0 mofd, lcolor(cra
> nberry) lpattern(dash) `lineopts'), title("Comparison of Volatility Measures - Standardized V
> ariables", size(small) pos(11)) name(outcomes_center, replace) `gropts'

. 
. 
. local note1 "{bf:Note:}Both panels compare the volatility measures obtained from MSRB data, a
> nd the Standard and Poors Municipal Bond Indices. {br}Panel on the left shows the raw volatil
> ity computations (i.e. monthly average of intra-weekly standard deviation of nominal bond yie
> lds). {br}Panel on the right shows the standardized variables. Each variable is standardized 
> using their own mean and standard deviation."

. 
. 
. grc1leg outcomes_normal outcomes_center, name(outcomes_comp, replace) rows(1) xsize(10) ysize
> (5) 

. graph display outcomes_comp, ysize(50) xsize(85) scale(.9)

. graph export "${oup}/OutcomeComparisonMRSB_SPMuni.pdf", replace 
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//OutcomeComparisonMRSB_SPMuni.pdf saved as PDF format

. restore 

. 
. exit 

end of do-file

. /// 4) Prepare the Dataset to Implement the Synthetic Control Method -- Robustnes Check Data 
> with CARES Heterogeneity 
> do "${cod}/code_dataprep/4_SynthFinalPrepRobustnessCheck.do"

. ********************************************************************************
. ********************************************************************************
. *** Project: Volatility in the Municipal Bond Market and the MLF 
. *** Authors: Felipe Lozano & Luis Navarro 
. *** Code by: Luis Navarro 
. *** Script: Prepare Data for Synthetic Control - Robustness Check  
. *** This Update: January 2024
. ********************************************************************************
. ********************************************************************************
. 
. ********************************************************************************
. cap program drop synth_prep

. program define synth_prep, rclass 
  1. /// Append the Donors 
> append using "${tem}/bloombergprices_clean.dta"
  2. replace data = "Donor Prices" if data == ""
  3. append using  "${tem}/spgoindex.dta"
  4. replace data = "SP Munis" if data == ""
  5. ********************************************************************************
. /// Compute the Standard Deviation of Weekly Prices 
> gen wofd= wofd(date + 1)
  6. /// Collapse at the weekly levels - This gets the weekly volatility measure  
> gcollapse (mean) date yield (sd) volatility, by(wofd name varlab data)
  7. //// Collapse by Month: Average of the 4 weeks at each month 
> gen mofd = mofd(date)
  8. gcollapse (mean) volatility yield date, by(mofd varlab name data) 
  9. format mofd %tmMon_CCYY
 10. gen year = year(date)
 11. gen treat = 0 
 12. replace treat = 1 if data == "Outcome"
 13. tempfile data
 14. save `data', replace 
 15. ********************************************************************************
. /// Exclude Data From SP Muni Index on the Treatment Period 
> drop if data == "SP Munis" & year >= 2019 
 16. gsort -treat name mofd 
 17. ********************************************************************************
. /// Manual Replacement of the first unit of volatility for BBB January 2019 
> *sum volatility if name == "BBB" & mofd == tm(2019m2)
. *replace volatility = r(mean) if name == "BBB" & mofd == tm(2019m1) 
. *mdesc volatility
. ********************************************************************************
. /// Now I need to express everything in Experiment Time 
> /// This variable refers to the experiment cohort 
> gen year_exp = . 
 18. /// Variables to determine experiment-months. 36 periods. Treatment Happens in April of t+
> 1, so it is the 16th period 
> gen month = month(dofm(mofd))
 19. gen month_exp = month 
 20. /// Two Steps: First Save the Treated Cohort 
> replace year_exp = 1 if mofd >= tm(2019m1) & mofd <= tm(2021m12)
 21. /// Store only the treated cohort (including donors from it)
> preserve 
 22. drop if data == "SP Munis"
 23. replace month_exp = month + 12 if year == 2020 
 24. replace month_exp = month + 24 if year == 2021 
 25. tempfile treated 
 26. save `treated' , replace 
 27. restore 
 28. 
. /// Second: Now I need to reshape the dataset so each cohort
> keep if data == "SP Munis"
 29. 
. /// List of Cohorts: 
> local cohort5 mofd >= tm(2013m1) & mofd <= tm(2015m12)
 30. local cohort4 mofd >= tm(2014m1) & mofd <= tm(2016m12)
 31. local cohort3 mofd >= tm(2015m1) & mofd <= tm(2017m12)
 32. local cohort2 mofd >= tm(2016m1) & mofd <= tm(2018m12)
 33. 
. 
. /// Keep observations at each cohort 
> forvalues i=2(1)5{
 34. preserve 
 35. keep if `cohort`i''
 36. sum year 
 37. local initial = r(min)
 38. replace month_exp = month + 12 if year == (`initial' + 1)
 39. replace month_exp = month + 24 if year == (`initial' + 2)
 40. replace year_exp = `i'
 41. tempfile cohort`i'
 42. save `cohort`i'', replace 
 43. restore 
 44. }
 45. 
. /// Append them 
> use `cohort2', clear 
 46. forvalues i=3(1)5{
 47.         append using `cohort`i''
 48. }
 49. 
. /// Save them 
> tempfile munis
 50. save `munis', replace 
 51. 
. 
. /// Finally, append them together with the treated untis 
> use `treated', clear 
 52. append using `munis'
 53. 
. ********************************************************************************
. /// Create IDs 
> /// First with Treated Units 
> egen id = group(name) if data == "Outcome"
 54. /// Second Identify Donors from the SP Data 
> egen id_sp = group(name year_exp) if data == "SP Munis"
 55. replace id = id_sp + 2000  if data == "SP Munis"
 56. /// Third Identify Donors from the Bloomberg data 
> egen id_bloom = group(name) if data == "Donor Prices"
 57. replace id = id_bloom + 3000 if data == "Donor Prices"
 58. drop id_bloom id_sp
 59. ********************************************************************************
. /// Homogeneous IDs 
> egen id1 = group(id)
 60. drop id 
 61. rename id1 id 
 62. tsset id month_exp
 63. rename volatility v 
 64. end 

. 
. 
. ********************************************************************************
. /// Robustness Check: Heterogeneity by CRF 
> /// Load Data 
> use "${tem}/secondary_rating_crf.dta", clear  

. keep date yield*

. 
. /// Reshape Long 
> reshape long yield, i(date) j(sec_id)
(j = 1 2 3 4 5 6 7 8)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations              754   ->   6,032       
Number of variables                   9   ->   3           
j variable (8 values)                     ->   sec_id
xij variables:
               yield1 yield2 ... yield8   ->   yield
-----------------------------------------------------------------------------

. rename yield volatility 

. tsset sec_id date

Panel variable: sec_id (strongly balanced)
 Time variable: date, 03jan2019 to 30dec2021, but with gaps
         Delta: 1 day

. sort sec_id date

. ********************************************************************************
. /// Add Yield as an outcome. This is to do the graphs 
> clonevar yield = volatility
(509 missing values generated)

. ********************************************************************************
. /// Names and Varlabs
> gen name = ""
(6,032 missing values generated)

. replace name = "A-p0-p50"               if sec_id == 1
variable name was str1 now str8
(754 real changes made)

. replace name = "A-p51-p100"             if sec_id == 2
variable name was str8 now str10
(754 real changes made)

. replace name = "AA-p0-p50"              if sec_id == 3
(754 real changes made)

. replace name = "AA-p51-p100"    if sec_id == 4
variable name was str10 now str11
(754 real changes made)

. replace name = "AAA-p0-p50"             if sec_id == 5
(754 real changes made)

. replace name = "AAA-p51-p100"   if sec_id == 6
variable name was str11 now str12
(754 real changes made)

. replace name = "BBB-p0-p50"             if sec_id == 7
(754 real changes made)

. replace name = "BBB-p51-p100"   if sec_id == 8
(754 real changes made)

. 
. *replace name = "A-p0-p33"              if sec_id == 1
. *replace name = "A-p34-p66"             if sec_id == 2
. *replace name = "A-p67-p100"            if sec_id == 3
. *replace name = "AA-p0-p33"             if sec_id == 4
. *replace name = "AA-p34-p66"            if sec_id == 5
. *replace name = "AA-p67-p100"   if sec_id == 6  
. *replace name = "AAA-p0-p33"            if sec_id == 7
. *replace name = "AAA-p34-p66"   if sec_id == 8
. *replace name = "AAA-p67-p100"  if sec_id == 9
. *replace name =  "BBB-p0-p33"   if sec_id == 10
. *replace name =  "BBB-p34-p66"  if sec_id == 11 
. *replace name =  "BBB-p67-p100" if sec_id == 12
. 
. *replace name = "A-Fixed Allocation" if sec_id == 1
. *replace name = "A-Variable Allocation" if sec_id == 2
. *replace name = "AA-Fixed Allocation" if sec_id == 3
. *replace name = "AA-Variable Allocation" if sec_id == 4
. *replace name = "AAA-Fixed Allocation" if sec_id == 5
. *replace name = "AAA-Variable Allocation" if sec_id == 6
. *replace name = "BBB-Fixed Allocation" if sec_id == 7
. *replace name = "BBB-Variable Allocation" if sec_id == 8
. 
. gen varlab = "State Bonds - " + name 

. gen data = "Outcome"

. 
. /// Run the program that preps the data 
> synth_prep
(variable sec_id was byte, now float to accommodate using data's values)
(variable name was str12, now str14 to accommodate using data's values)
variable data was str7 now str12
(62,080 real changes made)
(variable name was str14, now str20 to accommodate using data's values)
(78,304 real changes made)
(288 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000001 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000001 saved as .dta format
(1,312 observations deleted)
(5,472 missing values generated)
(3,168 real changes made)
(2,304 observations deleted)
(1,056 real changes made)
(1,056 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000003 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000003 saved as .dta format
(3,168 observations deleted)
(1,152 observations deleted)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        year |      1,152        2017    .8168512       2016       2018
(384 real changes made)
(384 real changes made)
(1,152 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000005 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000005 saved as .dta format
(1,152 observations deleted)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        year |      1,152        2016    .8168512       2015       2017
(384 real changes made)
(384 real changes made)
(1,152 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000007 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000007 saved as .dta format
(1,152 observations deleted)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        year |      1,152        2015    .8168512       2014       2016
(384 real changes made)
(384 real changes made)
(1,152 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000009 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000009 saved as .dta format
(1,152 observations deleted)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        year |      1,152        2014    .8168512       2013       2015
(384 real changes made)
(384 real changes made)
(1,152 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000b not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000b saved as .dta format
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000c not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000c saved as .dta format
(7,488 missing values generated)
(3,168 missing values generated)
(4,608 real changes made)
(4,896 missing values generated)
(2,880 real changes made)

Panel variable: id (strongly balanced)
 Time variable: month_exp, 1 to 36
         Delta: 1 unit

. /// Save the dataset 
> save "${cln}/synth_clean_crf.dta", replace 
file 1_Data/Clean//synth_clean_crf.dta saved

. 
. 
. 
. ********************************************************************************
. /// Robustness Check: Heterogeneity by Credit Rating  
> /// Load Data 
> use "${tem}/secondary_rating_fixedcr.dta", clear  

. keep date yield*

. *label variable yieldnr "Not Rated"
. label variable yield3a "AAA Bonds"

. label variable yield2a "AA Bonds"

. label variable yielda "A Bonds"

. label variable yield3b "BBB Bonds"

. 
. /// Rename variables to do the reshape 
> local varlist yield3a yield2a yielda yield3b

. local i = 1

. foreach var of local varlist {
  2.         global name`i' =  "`var'"
  3.         rename `var' var`i'
  4.         local i = `i' + 1
  5. }

. /// Reshape Long 
> reshape long var, i(date) j(sec_id)
(j = 1 2 3 4)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations              754   ->   3,016       
Number of variables                   5   ->   3           
j variable (4 values)                     ->   sec_id
xij variables:
                     var1 var2 ... var4   ->   var
-----------------------------------------------------------------------------

. rename var volatility 

. tsset sec_id date

Panel variable: sec_id (strongly balanced)
 Time variable: date, 03jan2019 to 30dec2021, but with gaps
         Delta: 1 day

. sort sec_id date

. ********************************************************************************
. /// Add Yield as an outcome. This is to do the graphs 
> clonevar yield = volatility
(133 missing values generated)

. ********************************************************************************
. /// Names and Varlabs
> gen name = ""
(3,016 missing values generated)

. replace name = "AAA" if sec_id == 1
variable name was str1 now str3
(754 real changes made)

. replace name = "AA" if sec_id == 2
(754 real changes made)

. replace name = "A" if sec_id == 3
(754 real changes made)

. replace name = "BBB" if sec_id == 4 
(754 real changes made)

. 
. gen varlab = "State Bonds - " + name 

. gen data = "Outcome"

. 
. /// Run the program that preps the data 
> synth_prep
(variable sec_id was byte, now float to accommodate using data's values)
(variable name was str3, now str14 to accommodate using data's values)
variable data was str7 now str12
(62,080 real changes made)
(variable name was str14, now str20 to accommodate using data's values)
(78,304 real changes made)
(144 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000001 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000001 saved as .dta format
(1,312 observations deleted)
(5,328 missing values generated)
(3,024 real changes made)
(2,304 observations deleted)
(1,008 real changes made)
(1,008 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000003 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000003 saved as .dta format
(3,024 observations deleted)
(1,152 observations deleted)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        year |      1,152        2017    .8168512       2016       2018
(384 real changes made)
(384 real changes made)
(1,152 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000005 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000005 saved as .dta format
(1,152 observations deleted)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        year |      1,152        2016    .8168512       2015       2017
(384 real changes made)
(384 real changes made)
(1,152 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000007 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000007 saved as .dta format
(1,152 observations deleted)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        year |      1,152        2015    .8168512       2014       2016
(384 real changes made)
(384 real changes made)
(1,152 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000009 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000009 saved as .dta format
(1,152 observations deleted)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        year |      1,152        2014    .8168512       2013       2015
(384 real changes made)
(384 real changes made)
(1,152 real changes made)
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000b not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000b saved as .dta format
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000c not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000c saved as .dta format
(7,488 missing values generated)
(3,024 missing values generated)
(4,608 real changes made)
(4,752 missing values generated)
(2,880 real changes made)

Panel variable: id (strongly balanced)
 Time variable: month_exp, 1 to 36
         Delta: 1 unit

. /// Save the dataset 
> save "${cln}/synth_clean_fixedcr.dta", replace 
file 1_Data/Clean//synth_clean_fixedcr.dta saved

. 
. exit 

end of do-file

. 
. ********************************************************************************
. /// Parameters Definition 
> global rmspe_cutoff = 0.15

. global tr_eff_window = 15

. //// Experiment Time Goes for 26 Months. January t-1 to December t + 1. So if intervention ha
> ppened at April 2020, then that is equivalent of having treatment at period 16. 
> global treat_period = 16 

. global predictors v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)

. 
. /// Descriptive Statistics 
> /// 1) Graphs of Bond Yields and Volatility Measures
> do "${cod}/code_analysis/0_GraphsYieldsVolatility.do"

. *************************************************************************
. *************************************************************************
. /// Project: Volatility in the Municipal Bond Market and the MLF
> /// Authors: Felipe Lozano & Luis Navarro
> /// Code: Luis Navarro 
> /// Update: January 2023 
> /// Script: Descriptive Graphs 
> *************************************************************************
. *************************************************************************
. 
. global title title(,pos(11) size(3) color(black))

. global back plotregion(color()) graphregion(color() margin(4 4 4 4)) plotregion(lcolor(black)
> ) 

. global graph_options xtitle("Months since the Intervention", size(medsmall)) ytitle(size(smal
> l)) ylabel(#10, nogrid labsize(small) angle(0)) xlabel(#16, labsize(small) angle(0) nogrid) t
> itle(, size(medsmall) pos(11) color(black)) $back 

. 
. ********************************************************************************
. 
. /// Volatility by Rating Group 
> use "${cln}/synth_clean_fixedcr.dta", clear 

. drop if month_exp <= 3
(636 observations deleted)

. sort id year_exp month_exp

. qui gegen v_pre_mn = mean(v) if month_exp < ${treat_period}, by(id)

. bysort id: carryforward         v_pre_mn, replace   
v_pre_mn:  (4,452 real changes made)

. /// Standard Deviation of each instrument in the Pre-treatment Period
> qui gegen v_pre_sd = sd(v) if month_exp < ${treat_period}, by(id)

. bysort id: carryforward         v_pre_sd, replace
v_pre_sd:  (4,452 real changes made)

. /// Normalized Variables
> qui gen v_norm = (v - v_pre_mn) / v_pre_sd

. /// Organize Dataset
> sort id year_exp month_exp

. order id treat year month year_exp month_exp v v_pre_mn v_pre_sd v_norm 

. /// Change the Labels of the Graphs 
> replace month_exp = month_exp - ${treat_period}
(6,996 real changes made)

. 
. ***********************************************
. /// Outcomes 
> qui keep if data == "Outcome"

. /// Intervention Line 
> qui sum month_exp if month_exp == 0

. local xline = r(mean)

. 
. /// Format Graph Lines 
> local line1 lcolor(black) mcolor(black) msymbol(circle) lpattern(solid) msize(vsmall) lwidth(
> thin)

. local line2 lcolor(cranberry) mcolor(cranberry) msymbol(circle) lpattern(dash) msize(vsmall) 
> lwidth(thin)

. local line3 lcolor(navy) mcolor(navy) msymbol(triangle) lpattern(solid) msize(vsmall) lwidth(
> thin)

. local line4 lcolor(green) mcolor(green) msymbol(triangle) lpattern(dash) msize(vsmall) lwidth
> (thin)

. 
. 
. /// Graph 1. Yields 
> twoway  (connected yield month_exp if name == "AAA", `line1') /// 
>                 (connected yield month_exp if name == "AA" , `line2') /// 
>                 (connected yield month_exp if name == "A"  , `line3') ///
>                 (connected yield month_exp if name == "BBB", `line4'), ///
>                 xline(`xline', lcolor(maroon) lpattern(dash)) ///
>             $graph_options name(gr_yields, replace) legend(off order(1 "AAA" 2 "AA" 3 "A" 4 "
> BBB") rows(1) cols(4) size(small)) title("Bond Yields by Credit Rating (percentage points)") 
> ytitle("Yield (Percentage Points)")

.                 
. /// Graph 2. Yields 
> twoway  (connected v_norm month_exp if name == "AAA", `line1') /// 
>                 (connected v_norm month_exp if name == "AA" , `line2') /// 
>                 (connected v_norm month_exp if name == "A"  , `line3') /// 
>                 (connected v_norm month_exp if name == "BBB", `line4'), ///
>                 xline(`xline', lcolor(maroon) lpattern(dash)) ///
>             $graph_options name(gr_volatility, replace) legend(off order(1 "AAA" 2 "AA" 3 "A"
>  4 "BBB") rows(1) cols(4) size(small)) title("Volatility by Credit Rating (Average SD on Stan
> dardized Units)")  ytitle("Standard Deviation (Percentage Points)")

.                 
. grc1leg gr_yields gr_volatility, legendfrom(gr_yields) rows(2) cols(1) xcommon name(yields_co
> mb, replace) xsize(16) ysize(8)

. graph display yields_comb, xsize(80) ysize(100) scale(.9)

. graph export "${oup}/Figure1_YieldVolatility.pdf", replace 
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//Figure1_YieldVolatility.pdf saved as PDF format

. 
. */// Export the Main Figure 
. *if "${rating_agg}" == "rating_agg_var" {
. *       graph export "${oup}\Figure1_YieldVolatility.pdf", replace xsize(16) ysize(8)
. *}
. *else if  "${rating_agg}" == "rating_agg_stfix" {
. *       graph export "${oup}\Figure1_YieldVolatility_RCStFix.pdf", replace xsize(16) ysize(8)
. *}
. 
. 
. **********************************************************************************
. /// Smokeplots of Volatility 
> use "${cln}/synth_clean_fixedcr.dta", clear 

. drop if month_exp <= 3
(636 observations deleted)

. sort id year_exp month_exp

. qui gegen v_pre_mn = mean(v) if month_exp < ${treat_period}, by(id)

. bysort id: carryforward         v_pre_mn, replace   
v_pre_mn:  (4,452 real changes made)

. /// Standard Deviation of each instrument in the Pre-treatment Period
> qui gegen v_pre_sd = sd(v) if month_exp < ${treat_period}, by(id)

. bysort id: carryforward         v_pre_sd, replace
v_pre_sd:  (4,452 real changes made)

. /// Normalized Variables
> qui gen v_norm = (v - v_pre_mn) / v_pre_sd

. /// Organize Dataset
> sort id year_exp month_exp

. order id treat year month year_exp month_exp v v_pre_mn v_pre_sd v_norm 

. /// Change the Labels of the Graphs 
> replace month_exp = month_exp - ${treat_period}
(6,996 real changes made)

. 
. /// Save dates 
> preserve 

. keep if data == "Outcome"
(6,864 observations deleted)

. gcollapse (mean) mofd, by(month_exp)

. tempfile dates

. save `dates', replace 
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000002 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000002 saved as .dta format

. restore 

. 
. 
. /// First for SP Muni Donors 
> preserve 

. keep if data == "SP Munis"
(2,772 observations deleted)

. /// Create Percentile Variables 
> qui gen p1 = . 

. qui gen p2 = . 

. qui gen p5 = . 

. qui gen p95 = . 

. qui gen p97 = . 

. qui gen p99 = . 

. qui gen avg = . 

. /// Create Percentile Variables For each Experiment Month. So, for any period it will compute
>  the percentiles at such period across all donor units, to then save it with the treated unit
> s. 
> qui tab month_exp

. local months = r(r)

. forvalues t= -15(1)20 {
  2.         qui _pctile v_norm                      if month_exp == `t', percentiles(1 2.5 5 9
> 5 97.5 99)
  3.         qui replace p1 = r(r1)  if month_exp == `t'
  4.         qui replace p2 = r(r2)  if month_exp == `t'
  5.         qui replace p5 = r(r3)  if month_exp == `t'
  6.         qui replace p95 = r(r4) if month_exp == `t'
  7.         qui replace p97 = r(r5) if month_exp == `t' 
  8.         qui replace p99 = r(r6) if month_exp == `t'
  9.         /// Compute the mean 
>         qui sum v_norm                          if month_exp == `t' 
 10.         qui local avg = r(mean)
 11.         qui replace avg = `avg' if month_exp == `t' 
 12. }

. /// Keep treated and do the graph 
> gcollapse (mean) p1 p2 p5 p95 p97 p99 avg, by(month_exp)

. qui sum month_exp if month_exp == 0

. local xline = r(mean)

. twoway  (rarea p1 p99 month_exp, fc(gs13%40) lc(gs15%40) lw(medthick)) ///
>                 (rarea p2 p97 month_exp, fc(gs10%40) lc(gs12%40) lw(medthick)) ///      
>                 (rarea p5 p95 month_exp, fc(gs7%40)  lc(gs9%40) lw(medthick)) ///
>                 (connected avg month_exp, sort lcolor(maroon) lpattern(solid) mcolor(maroon) 
> msize(small) msymbol(plus)), ///
>                 xline(`xline' , lcolor(black) lpattern(dash) lwidth(thin)) $graph_options ///
>                 name(munis_smoke, replace) title("S&P Municipal GO Bond Indices", size(medsma
> ll) pos(11)) legend(off) ytitle("Volatility (Avg Intra Week SD)")

. restore 

. ********************************************************************************
. 
. /// Second Donor Prices
> preserve 

. keep if data == "Donor Prices"
(4,356 observations deleted)

. /// Create Percentile Variables 
> qui gen p1 = . 

. qui gen p2 = . 

. qui gen p5 = . 

. qui gen p95 = . 

. qui gen p97 = . 

. qui gen p99 = . 

. qui gen avg = . 

. /// Create Percentile Variables For each Experiment Month. So, for any period it will compute
>  the percentiles at such period across all donor units, to then save it with the treated unit
> s. 
> qui tab month_exp

. local months = r(r)

. forvalues t= -15(1)20 {
  2.         qui _pctile v_norm                      if month_exp == `t', percentiles(1 2.5 5 9
> 5 97.5 99)
  3.         qui replace p1 = r(r1)  if month_exp == `t'
  4.         qui replace p2 = r(r2)  if month_exp == `t'
  5.         qui replace p5 = r(r3)  if month_exp == `t'
  6.         qui replace p95 = r(r4) if month_exp == `t'
  7.         qui replace p97 = r(r5) if month_exp == `t' 
  8.         qui replace p99 = r(r6) if month_exp == `t'
  9.         /// Compute the mean 
>         qui sum v_norm                          if month_exp == `t' 
 10.         qui local avg = r(mean)
 11.         qui replace avg = `avg' if month_exp == `t' 
 12. }

. /// Keep treated and do the graph 
> gcollapse (mean) p1 p2 p5 p95 p97 p99 avg, by(month_exp)

. merge 1:1 month_exp using `dates', keep(match master) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                33  
    -----------------------------------------

. qui sum month_exp if month_exp == 0

. local xline = r(mean)

. twoway  (rarea p1 p99 month_exp, fc(gs13%40) lc(gs15%40) lw(medthick)) ///
>                 (rarea p2 p97 month_exp, fc(gs10%40) lc(gs12%40) lw(medthick)) ///      
>                 (rarea p5 p95 month_exp, fc(gs7%40)  lc(gs9%40) lw(medthick)) ///
>                 (connected avg month_exp, sort lcolor(maroon) lpattern(solid) mcolor(maroon) 
> msize(vsmall) msymbol(circle)), ///
>                 xline(`xline' , lcolor(black) lpattern(dash) lwidth(thin)) $graph_options ///
>                 name(stocks_smoke, replace) title("Stock Market Indices and Commodities", siz
> e(medsmall) pos(11)) legend(off) ytitle("Volatility (Avg Intra Week SD)") yline(0, lcolor(bla
> ck) lpattern(dash) lwidth(thin))

. restore 

. 
. graph combine munis_smoke stocks_smoke, rows(2) cols(1) name(smoke_comb, replace)

. graph display smoke_comb, xsize(80) ysize(100) scale(.9)

. graph export "${oup}/Figure11_VolatilityDonors.pdf", replace
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//Figure11_VolatilityDonors.pdf saved as PDF format

. 
. 
. 
. 
. 
. exit 

end of do-file

. /// 2) Table with Descriptive Statistics 
> do "${cod}/code_analysis/0_DescriptiveStatistics.do"

. ********************************************************************************
. ********************************************************************************
. *** Project: Volatility in the Municipal Bond Market and the MLF 
. *** Authors: Felipe Lozano & Luis Navarro 
. *** Code by: Luis Navarro 
. *** Script: Descriptive Statistics 
. *** This Update: January 2023
. ********************************************************************************
. ********************************************************************************
. 
. //// Run the Synth
> use "${cln}/synth_clean_fixedcr.dta", clear 

. drop if month_exp <= 3
(636 observations deleted)

. 
. /// Mean of the Volatility in the Pre-treatment Period. That is, in the months from Septmeber
>  to February 
> sort id year_exp month_exp

. qui gegen v_pre_mn = mean(v) if month_exp < ${treat_period}, by(id)

. bysort id: carryforward         v_pre_mn, replace   
v_pre_mn:  (4,452 real changes made)

. /// Standard Deviation of each instrument in the Pre-treatment Period
> qui gegen v_pre_sd = sd(v) if month_exp < ${treat_period}, by(id)

. bysort id: carryforward         v_pre_sd, replace
v_pre_sd:  (4,452 real changes made)

. /// Normalized Variables
> gen v_norm = (v - v_pre_mn) / v_pre_sd

. /// Organize Dataset
> sort id year_exp month_exp

. order id treat year month year_exp month_exp v v_pre_mn v_pre_sd v_norm 

. 
. ********************************************************************************
. /// Post Variable 
> qui gen post = 0 

. qui replace post = 1 if month_exp >= ${treat_period}

. /// Assumption: Drop Observations Outside Treatment Effect Window Estimation 
> drop if month_exp >= ${treat_period} + ${tr_eff_window}
(1,272 observations deleted)

. ///
> gen datatype = 0 

. replace datatype = 1 if data == "SP Munis"
(3,456 real changes made)

. replace datatype = 2 if data == "Donor Prices"
(2,160 real changes made)

. ********************************************************************************
. /// First the Outcomes Only 
> qui tab id if data == "Outcome"

. local rows = 2*r(r)

. dis `rows'
8

. local title1 = "A"

. local title2 = "AA"

. local title3 = "AAA"

. local title4 = "BBB"

. /// Define Matrix To Store Values 
> matrix define R=J(`rows',8,.)

. matrix rownames R = "A" "A_se" "AA" "AA_se" "AAA" "AAA_se" "BBB" "BBB_se"

. matrix colnames R = "Yield_Pre" "Yield_Post" "Yield_Diff" "Yield_Pval" "Vol_Pre" "Vol_Post" "
> Vol_Diff" "Vol_Pval"

. /// Estimate the Mean Difference 
> local j = 1 

. forvalues i=1(1)4{
  2. /// First the Yield 
> qui ttest yield if id == `i' & data == "Outcome", by(post) unequal
  3. /// Store the Results 
> /// Means: Pre, Post and Mean Diff 
> matrix R[`j', 1] = r(mu_1)
  4. matrix R[`j', 2] = r(mu_2)
  5. matrix R[`j', 3] = r(mu_2) - r(mu_1)
  6. matrix R[`j', 4] = r(p)
  7. /// Standard Deviation and Pvalue 
> matrix R[`j'+ 1 , 1] = r(sd_1)
  8. matrix R[`j'+ 1 , 2] = r(sd_2)
  9. matrix R[`j'+ 1 , 3] = r(se)
 10. /// Second the Volatility 
> qui ttest v if id == `i' & data == "Outcome", by(post) unequal
 11. /// Means: Pre, Post and Mean Diff 
> matrix R[`j', 5] = r(mu_1)
 12. matrix R[`j', 6] = r(mu_2)
 13. matrix R[`j', 7] = r(mu_2) - r(mu_1)
 14. matrix R[`j', 8] = r(p)
 15. /// Standard Deviation and Pvalue 
> matrix R[`j'+ 1, 5] = r(sd_1)
 16. matrix R[`j'+ 1, 6] = r(sd_2)
 17. matrix R[`j'+ 1, 7] = r(se)
 18. local j = `j' + 2
 19. }

. 
. esttab mat(R, fmt(4 4 4 4 4))

-----------------------------------------------------------------------------------------------
> ---------------------
                        R                                                                      
>                      
                Yield_Pre   Yield_Post   Yield_Diff   Yield_Pval      Vol_Pre     Vol_Post     
> Vol_Diff     Vol_Pval
-----------------------------------------------------------------------------------------------
> ---------------------
A                  2.2431       1.6429      -0.6002       0.0011       0.2165       0.1741     
>  -0.0424       0.1793
A_se               0.4261       0.4045       0.1614            .       0.0895       0.0619     
>   0.0304            .
AA                 1.9662       1.3260      -0.6402       0.0000       0.1766       0.1133     
>  -0.0632       0.0638
AA_se              0.2696       0.2769       0.1057            .       0.0964       0.0610     
>   0.0320            .
AAA                1.9096       1.1134      -0.7962       0.0000       0.2234       0.1511     
>  -0.0723       0.0535
AAA_se             0.2621       0.3332       0.1146            .       0.0947       0.0877     
>   0.0355            .
BBB                3.5783       3.1920      -0.3863       0.1644       0.5098       0.5768     
>   0.0670       0.4110
BBB_se             0.6192       0.7821       0.2697            .       0.1612       0.2524     
>   0.0801            .
-----------------------------------------------------------------------------------------------
> ---------------------

. ********************************************************************************
. /// Donor Pool 
> ********************************************************************************
. /// First the Outcomes Only 
> 
. 
. local donors1 = "SP Munis"

. local donors2 = "Donor Prices"

. 
. 
. 
. /// Define Matrix To Store Values 
> matrix define   D=J(4,8,.)

. matrix rownames D = "SPMunis" "SPMunis_se" "Stocks" "Stocks_se" 

. matrix colnames D = "Yield_Pre" "Yield_Post" "Yield_Diff" "Yield_Pval" "Vol_Pre" "Vol_Post" "
> Vol_Diff" "Vol_Pval"

. /// Estimate the Mean Difference 
> local j = 1 

. forvalues i = 1(1)2{
  2. /// First the Yield 
> ttest yield if datatype ==  `i' , by(post) unequal
  3. /// Store the Results 
> /// Means: Pre, Post and Mean Diff 
> matrix D[`j', 1] = r(mu_1)
  4. matrix D[`j', 2] = r(mu_2)
  5. matrix D[`j', 3] = r(mu_2) - r(mu_1)
  6. matrix D[`j', 4] = r(p)
  7. /// Standard Deviation and Pvalue 
> matrix D[`j'+ 1 , 1] = r(sd_1)
  8. matrix D[`j'+ 1 , 2] = r(sd_2)
  9. matrix D[`j'+ 1 , 3] = r(se)
 10. /// Second the Volatility 
> ttest v if datatype ==  `i'  , by(post) unequal
 11. /// Means: Pre, Post and Mean Diff 
> matrix D[`j', 5] = r(mu_1)
 12. matrix D[`j', 6] = r(mu_2)
 13. matrix D[`j', 7] = r(mu_2) - r(mu_1)
 14. matrix D[`j', 8] = r(p)
 15. /// Standard Deviation and Pvalue 
> matrix D[`j'+ 1, 5] = r(sd_1)
 16. matrix D[`j'+ 1, 6] = r(sd_2)
 17. matrix D[`j'+ 1, 7] = r(se)
 18. local j = `j' + 2
 19. }

Two-sample t test with unequal variances
------------------------------------------------------------------------------
   Group |     Obs        Mean    Std. err.   Std. dev.   [95% conf. interval]
---------+--------------------------------------------------------------------
       0 |   1,536    1.781664     .016335    .6401993    1.749623    1.813705
       1 |   1,920    1.802724      .01309    .5735751    1.777052    1.828396
---------+--------------------------------------------------------------------
Combined |   3,456    1.793364    .0102759    .6040948    1.773217    1.813512
---------+--------------------------------------------------------------------
    diff |           -.0210601    .0209328               -.0621035    .0199833
------------------------------------------------------------------------------
    diff = mean(0) - mean(1)                                      t =  -1.0061
H0: diff = 0                     Satterthwaite's degrees of freedom =  3112.68

    Ha: diff < 0                 Ha: diff != 0                 Ha: diff > 0
 Pr(T < t) = 0.1572         Pr(|T| > |t|) = 0.3145          Pr(T > t) = 0.8428

Two-sample t test with unequal variances
------------------------------------------------------------------------------
   Group |     Obs        Mean    Std. err.   Std. dev.   [95% conf. interval]
---------+--------------------------------------------------------------------
       0 |   1,536    .0222559    .0003869    .0151615    .0214971    .0230147
       1 |   1,920    .0197997    .0002286    .0100151    .0193514    .0202479
---------+--------------------------------------------------------------------
Combined |   3,456    .0208913    .0002147    .0126225    .0204703    .0213123
---------+--------------------------------------------------------------------
    diff |            .0024562    .0004493                .0015752    .0033373
------------------------------------------------------------------------------
    diff = mean(0) - mean(1)                                      t =   5.4665
H0: diff = 0                     Satterthwaite's degrees of freedom =  2545.57

    Ha: diff < 0                 Ha: diff != 0                 Ha: diff > 0
 Pr(T < t) = 1.0000         Pr(|T| > |t|) = 0.0000          Pr(T > t) = 0.0000

Two-sample t test with unequal variances
------------------------------------------------------------------------------
   Group |     Obs        Mean    Std. err.   Std. dev.   [95% conf. interval]
---------+--------------------------------------------------------------------
       0 |     960    4730.737    324.6479    10058.85    4093.635    5367.839
       1 |   1,200    4848.547    300.2228    10400.02    4259.526    5437.567
---------+--------------------------------------------------------------------
Combined |   2,160    4796.187    220.4933     10247.6    4363.786    5228.588
---------+--------------------------------------------------------------------
    diff |           -117.8097    442.1877               -984.9857    749.3663
------------------------------------------------------------------------------
    diff = mean(0) - mean(1)                                      t =  -0.2664
H0: diff = 0                     Satterthwaite's degrees of freedom =  2082.46

    Ha: diff < 0                 Ha: diff != 0                 Ha: diff > 0
 Pr(T < t) = 0.3950         Pr(|T| > |t|) = 0.7899          Pr(T > t) = 0.6050

Two-sample t test with unequal variances
------------------------------------------------------------------------------
   Group |     Obs        Mean    Std. err.   Std. dev.   [95% conf. interval]
---------+--------------------------------------------------------------------
       0 |     960    49.48194    4.505985    139.6128    40.63921    58.32467
       1 |   1,200    48.16742    3.179964    110.1572    41.92851    54.40633
---------+--------------------------------------------------------------------
Combined |   2,160    48.75165    2.669908    124.0861    43.51579    53.98751
---------+--------------------------------------------------------------------
    diff |            1.314518    5.515077               -9.502124    12.13116
------------------------------------------------------------------------------
    diff = mean(0) - mean(1)                                      t =   0.2383
H0: diff = 0                     Satterthwaite's degrees of freedom =  1795.83

    Ha: diff < 0                 Ha: diff != 0                 Ha: diff > 0
 Pr(T < t) = 0.5942         Pr(|T| > |t|) = 0.8116          Pr(T > t) = 0.4058

. 
. esttab mat(D, fmt(4 4 4 4 4))

-----------------------------------------------------------------------------------------------
> ---------------------
                        D                                                                      
>                      
                Yield_Pre   Yield_Post   Yield_Diff   Yield_Pval      Vol_Pre     Vol_Post     
> Vol_Diff     Vol_Pval
-----------------------------------------------------------------------------------------------
> ---------------------
SPMunis            1.7817       1.8027       0.0211       0.3145       0.0223       0.0198     
>  -0.0025       0.0000
SPMunis_se         0.6402       0.5736       0.0209            .       0.0152       0.0100     
>   0.0004            .
Stocks          4730.7370    4848.5467     117.8097       0.7899      49.4819      48.1674     
>  -1.3145       0.8116
Stocks_se      10058.8470   10400.0216     442.1877            .     139.6128     110.1572     
>   5.5151            .
-----------------------------------------------------------------------------------------------
> ---------------------

. ********************************************************************************
. /// Append the Results 
> matrix define F = R \ D

. matlist F

             | Yield_Pre  Yield_P~t  Yield_D~f  Yield_P~l    Vol_Pre   Vol_Post   Vol_Diff 
-------------+-----------------------------------------------------------------------------
           A |  2.243133   1.642902  -.6002307   .0011166   .2164963   .1741207  -.0423757 
        A_se |  .4260785    .404484   .1613559          .   .0894919   .0619401   .0303837 
          AA |  1.966215   1.325973   -.640242   2.96e-06   .1765609    .113328  -.0632329 
       AA_se |  .2695594   .2769072   .1056742          .   .0964141   .0610457   .0319856 
         AAA |   1.90957    1.11338  -.7961904   2.77e-07   .2234235   .1511229  -.0723006 
      AAA_se |  .2620586   .3332125   .1145641          .   .0947332   .0877282   .0355098 
         BBB |  3.578289   3.192014  -.3862748   .1644482   .5097678   .5767817   .0670139 
      BBB_se |  .6192462   .7820926   .2696913          .   .1612441    .252446   .0800952 
     SPMunis |  1.781664   1.802724   .0210601    .314454   .0222559   .0197997  -.0024562 
  SPMunis_se |  .6401993   .5735751   .0209328          .   .0151615   .0100151   .0004493 
      Stocks |  4730.737   4848.547   117.8097   .7899386   49.48194   48.16742  -1.314518 
   Stocks_se |  10058.85   10400.02   442.1877          .   139.6128   110.1572   5.515077 

             |  Vol_Pval 
-------------+----------
           A |  .1793152 
        A_se |         . 
          AA |  .0637949 
       AA_se |         . 
         AAA |   .053508 
      AAA_se |         . 
         BBB |  .4110335 
      BBB_se |         . 
     SPMunis |  5.04e-08 
  SPMunis_se |         . 
      Stocks |  .8116369 
   Stocks_se |         . 

. 
. /// Export the Results 
> clear 

. svmat F
number of observations will be reset to 12
Press any key to continue, or Break to abort
Number of observations (_N) was 0, now 12.

. 
. tostring F1 F2 F3 F5 F6 F7, replace force 
F1 was float now str11
F1 was forced to string; some loss of information
F2 was float now str11
F2 was forced to string; some loss of information
F3 was float now str12
F3 was forced to string; some loss of information
F5 was float now str11
F5 was forced to string; some loss of information
F6 was float now str11
F6 was forced to string; some loss of information
F7 was float now str12
F7 was forced to string; some loss of information

. 
. local varlist F1 F2 F3 F5 F6 F7

. foreach var of local varlist {
  2. qui gen point_pos = strpos(`var',".")
  3. qui replace `var' = substr(`var',1,point_pos + 4) 
  4. qui gen negdec = strpos(`var',"-.")
  5. qui replace `var' = substr(`var',2,point_pos + 4) if negdec == 1
  6. qui replace `var' = "0" + `var' if strpos(`var',".") == 1 & negdec == 0 
  7. qui replace `var' = "-0" + `var' if strpos(`var',".") == 1 & negdec == 1
  8. qui replace `var' = "0" + `var' if length(`var') == 5 
  9. qui drop point_pos negdec
 10. }

. 
. qui rename (F1 F2 F3 F4 F5 F6 F7 F8) (y_pre y_post y_diff y_pval v_pre v_post v_diff v_pval)

. qui gen id = _n 

. qui gen variable = ""

. qui replace variable = "A"                      if id == 1

. qui replace variable = "A_se"           if id == 2

. qui replace variable = "AA"                     if id == 3

. qui replace variable = "AA_se"          if id == 4

. qui replace variable = "AAA"            if id == 5

. qui replace variable = "AAA_se"         if id == 6

. qui replace variable = "BBB"            if id == 7

. qui replace variable = "BBB_se"         if id == 8

. qui replace variable = "Donors (Munis)" if id == 9

. qui replace variable = "SPMunis_se"     if id == 10

. qui replace variable = "Donors (Others)"                if id == 11

. qui replace variable = "Stocks_se"      if id == 12

. 
. /// Change the Order of the Table 
> qui replace id = 1 if variable == "AAA"         

. qui replace id = 2 if variable == "AAA_se"      

. qui replace id = 3 if variable == "AA"          

. qui replace id = 4 if variable == "AA_se"       

. qui replace id = 5 if variable == "A"                   

. qui replace id = 6 if variable == "A_se"                

. qui replace id = 7 if variable == "BBB"         

. qui replace id = 8 if variable == "BBB_se"      

. qui replace id = 9 if variable == "Donors (Munis)"      

. qui replace id = 10 if variable == "SPMunis_se"

. qui replace id = 11 if variable == "Donors (Others)"    

. qui replace id = 12 if variable == "Stocks_se" 

. sort id 

. order variable 

. 
. /// Add parentheses to Standard Errors 
> local varlist y_pre y_post y_diff v_pre v_post v_diff 

. foreach var of local varlist {
  2. forvalues i = 2(2)12 {
  3.     replace `var' = "(" + `var' + ")" if _n == `i'
  4. }
  5. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable y_pre was str11 now str12
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable y_post was str11 now str12
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. /// Remove Names from Standard Errors 
> qui replace variable = "" if strpos(var,"_se") > 0

. /// Stars Statistical Significance 
> gen ystars = "" 
(12 missing values generated)

. replace ystars = "*" if y_pval < 0.01
(3 real changes made)

. replace ystars = "**" if y_pval < 0.005 
variable ystars was str1 now str2
(3 real changes made)

. replace ystars = "***" if y_pval < 0.001
variable ystars was str2 now str3
(2 real changes made)

. 
. gen vstars = "" 
(12 missing values generated)

. replace vstars = "*" if v_pval < 0.01
(1 real change made)

. replace vstars = "**" if v_pval < 0.005 
variable vstars was str1 now str2
(1 real change made)

. replace vstars = "***" if v_pval < 0.001
variable vstars was str2 now str3
(1 real change made)

. 
. /// Add parentheses to Standard Errors 
> local varlist y v 

. foreach var of local varlist {
  2. forvalues i = 1(2)11 {
  3.     replace `var'_diff = `var'_diff + `var'stars  if _n == `i'
  4. }
  5. }
(1 real change made)
(1 real change made)
(1 real change made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(1 real change made)
(0 real changes made)

. 
. drop id y_pval v_pval ystars vstars

. *******************************************************************************
. save "${tem}/Table1_DescriptiveStats.dta", replace 
file 1_Data/Temp//Table1_DescriptiveStats.dta saved

. ********************************************************************************
. texsave * using "${oup}/Table1_DescriptiveStats.tex", replace  decimalalign nofix 

. 
end of do-file

. /// 3) Credit Rating Map
> do "${cod}/code_analysis/0_RatingsMap.do"

. *************************************************************************
. *************************************************************************
. /// Project: Volatility in the Municipal Bond Market and the MLF
> /// Authors: Felipe Lozano & Luis Navarro
> /// Code: Felipe Lozano  
> /// Update: February 2024 (Luis Navarro) 
> /// Script: Credit Ratings Map
> *************************************************************************
. *************************************************************************
. 
. use "${tem}/state_ratings_data.dta",clear 

. tostring state_fips, gen(STATEFP)
STATEFP generated as str2

. replace STATEFP = "0" + STATEFP if length(STATEFP) == 1
(7 real changes made)

. tempfile ratingsmap

. save `ratingsmap', replace 
(file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000001 not found)
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000001 saved as .dta format

. 
. use  "${raw}/Map/geo2xy_us_data.dta", clear

. drop if NAME=="Puerto Rico"
(1 observation deleted)

. merge 1:1 STATEFP using `ratingsmap', keep(match master) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                51  
    -----------------------------------------

. 
. /// Plot the map 
> spmap rating_agg  using "${raw}/Map/xy_coor.dta", id(_ID)  name(map_ratings, replace) clm(uni
> que) ///
>         ocolor(black black black black black) fcolor(ebblue ebblue%30 orange%50 cranberry whi
> te) ///
>         label(data("${raw}/Map/St_lab_NoPR.dta") xcoord(x_lab) ycoord(y_lab) label(stlab) ///
>         by(lgroup) size(*.5) pos(0 6)) leg(pos(12) rows(1)) 

.         
. 
. graph export "${oup}/CreditRatingGRoupingRC.pdf", replace
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//CreditRatingGRoupingRC.pdf saved as PDF format

. 
. exit 

end of do-file

. ********************************************************************************
. 
. /// Main Results 
> /// Analysis 
> /// 0) Load Programs that will be used for the estimation 
> do "${cod}/code_analysis/0_Programs.do"

. ********************************************************************************
. ********************************************************************************
. *** Project: Volatility in the Municipal Bond Market and the MLF 
. *** Authors: Felipe Lozano & Luis Navarro 
. *** Code by: Luis Navarro 
. *** Script: Define Programs Used for Estimation 
. *** This Update: February 2024 
. ********************************************************************************
. ********************************************************************************
. program drop _all 

. ********************************************************************************
. /// 1. Synth Estimation 
> /// Define the Program that Runs the Estimation 
> cap program drop synth_estimation

. program define synth_estimation, rclass
  1. /// Mean of the Volatility in the Pre-treatment Period. That is, in the months from Septme
> ber to February 
> sort id year_exp month_exp
  2. qui gegen v_pre_mn = mean(v) if month_exp < ${treat_period}, by(id)
  3. bysort id: carryforward         v_pre_mn, replace   
  4. /// Standard Deviation of each instrument in the Pre-treatment Period
> qui gegen v_pre_sd = sd(v) if month_exp < ${treat_period}, by(id)
  5. bysort id: carryforward         v_pre_sd, replace
  6. /// Normalized Variables
> gen v_norm = (v - v_pre_mn) / v_pre_sd
  7. /// Organize Dataset
> sort id year_exp month_exp
  8. order id treat year month year_exp month_exp v v_pre_mn v_pre_sd v_norm 
  9. /// Table of Treated States 
> tab id if treat==1, matrow(T)
 10. global tr_units = r(r)
 11. 
. /// Define Predictors - statistical model for matching 
> /// Match on 3 variables: observed volatility jump at 15, average January - February of t, an
> d Average of the Complete Previous Year. 
> 
. display "$predictors"
 12. 
. /// For Loop to Estimate the Synthetic Controls For Each Treated State 
> timer on 1 
 13. forvalues t=1/$tr_units {
 14.                 preserve 
 15.                 timer on 2
 16.                 *********************************************************************
.                 global t_id = T[`t',1]
 17.                 /// Keep only treated + donors 
>                 qui keep if id == ${t_id} | year_exp >= 1
 18.                 /// Save mean and variance in the pretreatment period 
>                 qui sum v_pre_mn  if id == ${t_id}
 19.                 qui global tr_pr_mn=r(mean)
 20.                 qui sum v_pre_sd  if id == ${t_id}
 21.                 qui global tr_pr_sd=r(mean)
 22.                 ************************************************************************
.                 /// run the synth 
>                 qui tsset id month_exp
 23.                 qui tempfile SCM_id_`t'
 24.                 synth v_norm ${predictors}, trunit(${t_id}) trperiod(${treat_period}) keep
> (`SCM_id_`t'') 
 25.                 ************************************************************************
.                 /// Goodness of Fit MSE and Cohen D
>                 /// RMSE  
>                 matrix define RMSPE`t' = e(RMSPE)
 26.                 mat Y=e(X_balance)
 27.                 mat Yt=Y[1...,1]
 28.                 mat Yc=Y[1...,2]
 29.                 mat rmse1=(Yt-Yc)'*(Yt-Yc)
 30.                 mat rmse1=rmse1/`=rowsof(Yt)'
 31.                 /// Cohen's D statistic  
>                 qui svmat Y 
 32.                 qui sum Y1 
 33.                 global sdpre = r(sd)
 34.                 qui gen absdf = abs((Y1 - Y2)/$sdpre ) 
 35.                 qui sum absdf 
 36.                 global cohend = r(mean)
 37.                 qui drop Y1 Y2 absdf 
 38.                 restore 
 39.                 ********************************************************************
.                 preserve 
 40.                 qui use `SCM_id_`t'', clear
 41.                 qui rename (_Y_treated _Y_synthetic _time) (treated synth month_exp)
 42.                 qui gen pre_mn = $tr_pr_mn
 43.                 qui gen pre_sd = $tr_pr_sd
 44.                 *svmat Real--> Check I retrieve the same info
.                 qui gen treat_lev = pre_sd*treated + pre_mn 
 45.                 qui gen synth_lev = pre_sd*synth + pre_mn       
 46.                 qui gen tr_eff = treat_lev - synth_lev
 47.                 /// Save RMSE 
>                 qui gen rmse = rmse1[1,1]
 48.                 qui gen cohend = $cohend 
 49.                 /// Average Treatment Effect Estimation 
>                 qui gen post = month_exp > ${treat_period}
 50.                 qui egen ate = mean(tr_eff) if post == 1
 51.                 qui egen ate1 = mean(ate)
 52.                 qui drop ate 
 53.                 qui rename ate1 ate 
 54.                 qui gen id = ${t_id}
 55.                 qui gen fileid = `t'
 56.                 /// Store the Synth Data for Graphs
>                 qui keep ate id fileid rmse cohend month_exp treat_lev synth_lev tr_eff treat
> ed synth 
 57.                 qui drop if month_exp == .  
 58.                 tempfile scm_`t'
 59.                 save `scm_`t''
 60.                 restore 
 61.                 **********************************************************************
.                 /// Store Weights Separately 
>                 /*
>                 preserve
>                 use `SCM_id_`t'', clear
>                 capture drop id 
>                 rename (_Co_Number _W_Weight) (id weight)
>                 duplicates report id 
>                 merge 1:1 id using  "${tem}\varnames.dta", keep(match master) nogen
>                 qui keep id weight
>                 qui gen trunit = `t'
>                 save "${tem}\scm_weight_`t'.dta", replace 
>                 restore 
>                 */
.                 **********************************************************************
.                 timer off 2
 62.                 timer list 2
 63.                 display "Treatment Unit `t' out of $tr_units"
 64.                 timer clear 2
 65. }
 66. timer off 1 
 67. timer list 1
 68. timer clear 1
 69. 
. /// Append the Results and Save Them 
> use `scm_1' , clear
 70. drop if _n >= 1
 71. forvalues i=1(1)$tr_units { 
 72.         append using `scm_`i''
 73. }
 74. /// Expresses Months relative to intervention time. 
> replace month_exp = month_exp - ${treat_period} 
 75. /// Month 0 == Period of the Intervention
> /// Pre-Treatment Period: All Negative Months 
> tab month_exp
 76. label variable treated "Observed Volatility - Standardized Units"
 77. label variable synth "Synthetic Volatility - Standardized Units"
 78. label variable month_exp "Months Since the Intervention"
 79. label variable treat_lev "Observed Volatility - Series Units"
 80. label variable synth_lev  "Synthetic Volatility - Series Units"
 81. label variable tr_eff "Treatment Effect - Series Units"
 82. 
. end 

. 
. ********************************************************************************
. //// Placebo per Outcome: Baseline Model
> cap program drop placebo_outcome_main

. program define placebo_outcome_main, rclass 
  1. /// Store the pre-treatment mean and variance of the treated units 
> sort id year_exp month_exp
  2. qui gegen v_pre_mn = mean(v) if month_exp < ${treat_period}, by(id)
  3. bysort id: carryforward         v_pre_mn, replace   
  4. /// Standard Deviation of each instrument in the Pre-treatment Period
> qui gegen v_pre_sd = sd(v) if month_exp < ${treat_period}, by(id)
  5. bysort id: carryforward         v_pre_sd, replace
  6. /// Normalized Variables
> qui gen v_norm = (v - v_pre_mn) / v_pre_sd
  7. qui tsset id month_exp
  8. ********************************************************************************
. /// Compute Placebos adjusted by mean and variance of each outcome 
> qui tab id if treat==1, matrow(T)
  9. global rows = r(r)
 10.  
. forvalues i = 1(1)$rows{
 11. preserve 
 12. ******************************************
. global t_id = T[`i',1]
 13. /// Mean Used for Normalization 
> qui sum v_pre_mn  if id == ${t_id}
 14. qui global tr_pr_mn=r(mean)
 15. /// Standard Deviation Used For Normalization 
> qui sum v_pre_sd  if id == ${t_id}
 16. qui global tr_pr_sd=r(mean)
 17. /// Drop normalized treated unit  
> qui drop v_norm v_pre_mn v_pre_sd
 18. ********************************************
. /// Load Appended Placebo Data. Here there is the empirical placebo distribution, unit free 
> qui use "${tem}/placeboap_main.dta", clear 
 19. qui gen pre_mn = $tr_pr_mn
 20. qui gen pre_sd = $tr_pr_sd
 21. /// At each lap of the loop, create the treated and synthetic placebos, using the mean and
>  variance of the treated unit. This allows to depict better the smokeplots. 
> qui gen treat_lev = pre_sd*treated + pre_mn 
 22. qui gen synth_lev = pre_sd*synth + pre_mn       
 23. qui gen tr_eff = treat_lev - synth_lev
 24. /// Average Treatment Effect Estimation 
> qui gen post = month_exp > ${treat_period}
 25. qui bysort id: egen ate = mean(tr_eff) if post == 1
 26. qui bysort id: egen ate1 = mean(ate)
 27. qui drop ate 
 28. qui rename ate1 ate 
 29. qui gen fileid = `i'
 30. qui keep ate id fileid rmse cohend month_exp treat_lev synth_lev tr_eff
 31. qui drop if month_exp == . 
 32. qui tempfile placebo_out`i'
 33. qui save `placebo_out`i''
 34. restore 
 35. }
 36. 
. *************************************************
. /// Append the results 
> qui use `placebo_out1', clear 
 37. qui drop if _n >= 1 
 38. forvalues i = 1(1)$rows{
 39. qui append using `placebo_out`i''
 40. }
 41. sort fileid id month_exp
 42. replace month_exp = month_exp - ${treat_period} 
 43. tab month_exp
 44. end 

. 
. ********************************************************************************
. //// Placebo per Outcome 
> cap program drop placebo_outcome_rc

. program define placebo_outcome, rclass 
  1. /// Store the pre-treatment mean and variance of the treated units 
> sort id year_exp month_exp
  2. qui gegen v_pre_mn = mean(v) if month_exp < ${treat_period}, by(id)
  3. bysort id: carryforward         v_pre_mn, replace   
  4. /// Standard Deviation of each instrument in the Pre-treatment Period
> qui gegen v_pre_sd = sd(v) if month_exp < ${treat_period}, by(id)
  5. bysort id: carryforward         v_pre_sd, replace
  6. /// Normalized Variables
> qui gen v_norm = (v - v_pre_mn) / v_pre_sd
  7. qui tsset id month_exp
  8. ********************************************************************************
. /// Compute Placebos adjusted by mean and variance of each outcome 
> qui tab id if treat==1, matrow(T)
  9. global rows = r(r)
 10.  
. forvalues i = 1(1)$rows{
 11. preserve 
 12. ******************************************
. global t_id = T[`i',1]
 13. /// Mean Used for Normalization 
> qui sum v_pre_mn  if id == ${t_id}
 14. qui global tr_pr_mn=r(mean)
 15. /// Standard Deviation Used For Normalization 
> qui sum v_pre_sd  if id == ${t_id}
 16. qui global tr_pr_sd=r(mean)
 17. /// Drop normalized treated unit  
> qui drop v_norm v_pre_mn v_pre_sd
 18. ********************************************
. /// Load Appended Placebo Data. Here there is the empirical placebo distribution, unit free 
> qui use "${tem}/placeboap_rc.dta", clear 
 19. qui gen pre_mn = $tr_pr_mn
 20. qui gen pre_sd = $tr_pr_sd
 21. /// At each lap of the loop, create the treated and synthetic placebos, using the mean and
>  variance of the treated unit. This allows to depict better the smokeplots. 
> qui gen treat_lev = pre_sd*treated + pre_mn 
 22. qui gen synth_lev = pre_sd*synth + pre_mn       
 23. qui gen tr_eff = treat_lev - synth_lev
 24. /// Average Treatment Effect Estimation 
> qui gen post = month_exp > ${treat_period}
 25. qui bysort id: egen ate = mean(tr_eff) if post == 1
 26. qui bysort id: egen ate1 = mean(ate)
 27. qui drop ate 
 28. qui rename ate1 ate 
 29. qui gen fileid = `i'
 30. qui keep ate id fileid rmse cohend month_exp treat_lev synth_lev tr_eff
 31. qui drop if month_exp == . 
 32. qui tempfile placebo_out`i'
 33. qui save `placebo_out`i''
 34. restore 
 35. }
 36. 
. *************************************************
. /// Append the results 
> qui use `placebo_out1', clear 
 37. qui drop if _n >= 1 
 38. forvalues i = 1(1)$rows{
 39. qui append using `placebo_out`i''
 40. }
 41. sort fileid id month_exp
 42. replace month_exp = month_exp - ${treat_period} 
 43. tab month_exp
 44. end 

. 
. 
. ********************************************************************************
. /// Program: Create Table for Main Results 
> program define ate_table, rclass
  1. /// Results as a transpose 
> matrix define M = R'
  2. /// Clear the environment 
> clear 
  3. svmat M
  4. format M* %12.4fc
  5. replace M5 = 0 if M5 == . 
  6. replace M6 = 0 if M6 == . 
  7. /// Drop ate excess volatility if the effect is not interpretab;e 
> replace M10 = . if M10 < -1000 | M10 > 1000
  8. /// Statistical Significance: Left-sided test  
> qui gen stars = "" 
  9. qui replace stars = "*" if M5 < 0.01
 10. qui replace stars = "**" if M5 < 0.005 
 11. qui replace stars = "***" if M5 < 0.001
 12. /// Format Variables 
> qui tostring M1, gen(ate) force format(%12.4fc)
 13. qui tostring M2, gen(se) force format(%12.4fc)
 14. qui tostring M3, gen(ci_min) force format(%12.4fc)
 15. qui tostring M4, gen(ci_max) force format(%12.4fc)
 16. qui tostring M5, gen(pval1) force format(%12.4fc)
 17. qui tostring M6, gen(pval2) force format(%12.4fc)
 18. qui tostring M7, gen(vol_pre) force format(%12.4fc)
 19. qui tostring M8, gen(vol_treat) force format(%12.4fc)
 20. qui tostring M9, gen(excess_vol) force format(%12.4fc)
 21. qui tostring M10, gen(ate_excess_vol) force format(%12.4fc)
 22. qui tostring M11, gen(rmspe) force format(%12.4fc)
 23. qui replace ate_excess_vol = ate_excess_vol + "\%"
 24. qui replace ate_excess_vol = "NA" if ate_excess_vol == ".\%"
 25. qui replace se = "(" + se + ")"
 26. qui replace ate = ate + stars
 27. qui gen cint = "(" + ci_min + "," + ci_max + ")"
 28. 
. qui gen id = _n
 29. qui rename (ate se cint vol_pre vol_treat excess_vol ate_excess_vol pval1 pval2 rmspe) (b1
>  b2 b3 b4 b5 b6 b7 b8 b9 b10)
 30. qui keep id b*
 31. qui reshape long b, i(id) j(vars) string
 32. qui destring vars, gen(id1)
 33. qui drop vars 
 34. qui reshape wide b, i(id1) j(id)  
 35. qui gen names = ""
 36. qui replace names = "Average Treatment Effect (a)" if _n == 1
 37. qui replace names = "SE" if _n == 2
 38. qui replace names = "Conf Interval" if _n == 3
 39. qui replace names = "Historic Volatility (b)" if _n == 4
 40. qui replace names = "Volatility March 2020 (c)" if _n == 5
 41. qui replace names = "Excess Volatility (d = c - b)" if _n == 6
 42. qui replace names = "ATE, % Excess Volatility (e = d/a)" if _n == 7
 43. qui replace names = "P-Value (Left Tail)" if _n == 8
 44. qui replace names = "P-Value (Two Tails)" if _n == 9
 45. qui replace names = "RMSPE" if _n == 10
 46. qui drop id1
 47. qui rename (names b1 b2 b3 b4) (Results A AA AAA BBB)
 48. qui order Results AAA AA A BB
 49. end 

. 
. ********************************************************************************
. 
. 
. 
. 
. 
end of do-file

. /// 1) Estimate the placebo distribution: this is done once for the baseline and robustness c
> heck for cares heterogeneity 
> do "${cod}/code_analysis/1_PlacebosForBaseline.do"

. *************************************************************************
. *************************************************************************
. /// Project: Volatility in the Municipal Bond Market and the MLF
> /// Authors: Felipe Lozano & Luis Navarro
> /// Code: Luis Navarro (lunavarr@iu.edu) 
> /// Update: February 2024
> /// Script: Estimate the Placebo Treatment Effects (Unit-Free) Baseline Model
> *************************************************************************
. *************************************************************************
. //// Estimation of the Placebos 
> timer on 1

. cap log using "${tem}/LogPlacebos.log"

. qui use "${cln}/synth_clean_fixedcr.dta", clear 

. sort id year_exp month_exp

. qui gegen v_pre_mn = mean(v) if month_exp < ${treat_period}, by(id)

. bysort id: carryforward         v_pre_mn, replace   
v_pre_mn:  (4,452 real changes made)

. /// Standard Deviation of each instrument in the Pre-treatment Period
> qui gegen v_pre_sd = sd(v) if month_exp < ${treat_period}, by(id)

. bysort id: carryforward         v_pre_sd, replace
v_pre_sd:  (4,452 real changes made)

. /// Normalized Variables
> gen v_norm = (v - v_pre_mn) / v_pre_sd
(4 missing values generated)

. qui tsset id month_exp

. 
. //// For Loop To estimate the Placebos 
> qui tab id if treat==0

. global don = r(r)

. /// For loop 
> forvalues i = 1(1)$don  {
  2. preserve
  3. timer on 2 
  4. // Drop Treated Units: Placebos are Estimated Only in the Donor Pool            
. qui drop if treat == 1
  5. qui tab id if treat==0, matrow(C)
  6. qui global t_id = C[`i',1]
  7. qui tempfile scm_placebo`i'
  8. *** To ensure compatibility, the global levels (i.e. the lags used as predictors) is defin
> ed in the synth do file. 
. qui synth v_norm ${predictors}, trunit(${t_id}) trperiod(${treat_period}) keep(`scm_placebo`i
> '')
  9. /// Store the Results: Goodness of Fit 
> matrix define RMSPE`i' = e(RMSPE)
 10. mat Y=e(X_balance)
 11. mat Yt=Y[1...,1]
 12. mat Yc=Y[1...,2]
 13. mat rmse1=(Yt-Yc)'*(Yt-Yc)
 14. mat rmse1=rmse1/`=rowsof(Yt)'
 15. /// Cohen's D statistic  
> qui svmat Y 
 16. qui sum Y1 
 17. qui global sdpre = r(sd)
 18. qui gen absdf = abs((Y1 - Y2)/$sdpre ) 
 19. qui sum absdf 
 20. qui global cohend = r(mean)
 21. qui drop Y1 Y2 absdf 
 22. qui use `scm_placebo`i'', clear
 23. qui rename (_Y_treated _Y_synthetic _time) (treated synth month_exp)
 24. qui drop if month_exp == . 
 25. qui keep treat synth month_exp 
 26. /// Save RMSE 
> qui gen rmse = rmse1[1,1]
 27. qui gen cohend = $cohend 
 28. qui gen id = ${t_id} 
 29. capture drop Y1 Y2 absdf 
 30. tempfile placebo`i'
 31. qui save  `placebo`i'', replace 
 32. timer off 2
 33. timer list 2
 34. display "Placebo `i' out of $don"
 35. timer clear 2 
 36. restore 
 37. }
   2:      4.58 /        1 =       4.5780
Placebo 1 out of 208
   2:      4.49 /        1 =       4.4860
Placebo 2 out of 208
   2:      4.38 /        1 =       4.3820
Placebo 3 out of 208
   2:      4.37 /        1 =       4.3650
Placebo 4 out of 208
   2:      4.36 /        1 =       4.3550
Placebo 5 out of 208
   2:      4.41 /        1 =       4.4130
Placebo 6 out of 208
   2:      4.38 /        1 =       4.3800
Placebo 7 out of 208
   2:      4.38 /        1 =       4.3750
Placebo 8 out of 208
   2:      4.40 /        1 =       4.4010
Placebo 9 out of 208
   2:      4.35 /        1 =       4.3510
Placebo 10 out of 208
   2:      4.40 /        1 =       4.3980
Placebo 11 out of 208
   2:      4.50 /        1 =       4.4950
Placebo 12 out of 208
   2:      4.38 /        1 =       4.3760
Placebo 13 out of 208
   2:      4.34 /        1 =       4.3420
Placebo 14 out of 208
   2:      4.36 /        1 =       4.3640
Placebo 15 out of 208
   2:      4.36 /        1 =       4.3600
Placebo 16 out of 208
   2:      4.38 /        1 =       4.3800
Placebo 17 out of 208
   2:      4.39 /        1 =       4.3880
Placebo 18 out of 208
   2:      4.35 /        1 =       4.3480
Placebo 19 out of 208
   2:      4.51 /        1 =       4.5080
Placebo 20 out of 208
   2:      4.40 /        1 =       4.4040
Placebo 21 out of 208
   2:      4.53 /        1 =       4.5320
Placebo 22 out of 208
   2:    168.21 /        1 =     168.2050
Placebo 23 out of 208
   2:      4.41 /        1 =       4.4060
Placebo 24 out of 208
   2:      4.41 /        1 =       4.4060
Placebo 25 out of 208
   2:      4.40 /        1 =       4.3960
Placebo 26 out of 208
   2:      4.40 /        1 =       4.3990
Placebo 27 out of 208
   2:      4.38 /        1 =       4.3780
Placebo 28 out of 208
   2:      4.38 /        1 =       4.3810
Placebo 29 out of 208
   2:      4.36 /        1 =       4.3600
Placebo 30 out of 208
   2:      4.39 /        1 =       4.3910
Placebo 31 out of 208
   2:      4.38 /        1 =       4.3750
Placebo 32 out of 208
   2:      4.40 /        1 =       4.3970
Placebo 33 out of 208
   2:      4.51 /        1 =       4.5090
Placebo 34 out of 208
   2:      4.37 /        1 =       4.3740
Placebo 35 out of 208
   2:      4.37 /        1 =       4.3730
Placebo 36 out of 208
   2:      4.40 /        1 =       4.4020
Placebo 37 out of 208
   2:      4.41 /        1 =       4.4100
Placebo 38 out of 208
   2:      4.41 /        1 =       4.4100
Placebo 39 out of 208
   2:      4.39 /        1 =       4.3900
Placebo 40 out of 208
   2:      4.39 /        1 =       4.3950
Placebo 41 out of 208
   2:      4.54 /        1 =       4.5370
Placebo 42 out of 208
   2:      4.49 /        1 =       4.4920
Placebo 43 out of 208
   2:      4.38 /        1 =       4.3850
Placebo 44 out of 208
   2:      4.40 /        1 =       4.3980
Placebo 45 out of 208
   2:      4.43 /        1 =       4.4300
Placebo 46 out of 208
   2:      4.37 /        1 =       4.3680
Placebo 47 out of 208
   2:      4.38 /        1 =       4.3810
Placebo 48 out of 208
   2:      4.40 /        1 =       4.4030
Placebo 49 out of 208
   2:      4.45 /        1 =       4.4520
Placebo 50 out of 208
   2:      4.56 /        1 =       4.5560
Placebo 51 out of 208
   2:      4.39 /        1 =       4.3860
Placebo 52 out of 208
   2:      4.58 /        1 =       4.5820
Placebo 53 out of 208
   2:      7.29 /        1 =       7.2850
Placebo 54 out of 208
   2:      4.42 /        1 =       4.4170
Placebo 55 out of 208
   2:     11.76 /        1 =      11.7610
Placebo 56 out of 208
   2:      4.46 /        1 =       4.4650
Placebo 57 out of 208
   2:    374.17 /        1 =     374.1660
Placebo 58 out of 208
   2:      4.65 /        1 =       4.6510
Placebo 59 out of 208
   2:      4.49 /        1 =       4.4850
Placebo 60 out of 208
   2:      4.49 /        1 =       4.4900
Placebo 61 out of 208
   2:      4.56 /        1 =       4.5580
Placebo 62 out of 208
   2:      4.48 /        1 =       4.4760
Placebo 63 out of 208
   2:      4.49 /        1 =       4.4860
Placebo 64 out of 208
   2:      4.56 /        1 =       4.5560
Placebo 65 out of 208
   2:      4.51 /        1 =       4.5060
Placebo 66 out of 208
   2:      4.57 /        1 =       4.5740
Placebo 67 out of 208
   2:      4.55 /        1 =       4.5530
Placebo 68 out of 208
   2:      4.44 /        1 =       4.4400
Placebo 69 out of 208
   2:      4.38 /        1 =       4.3810
Placebo 70 out of 208
   2:      4.38 /        1 =       4.3760
Placebo 71 out of 208
   2:      4.39 /        1 =       4.3920
Placebo 72 out of 208
   2:      4.40 /        1 =       4.4030
Placebo 73 out of 208
   2:      4.39 /        1 =       4.3870
Placebo 74 out of 208
   2:      4.40 /        1 =       4.4030
Placebo 75 out of 208
   2:      4.54 /        1 =       4.5450
Placebo 76 out of 208
   2:      4.42 /        1 =       4.4220
Placebo 77 out of 208
   2:      4.39 /        1 =       4.3870
Placebo 78 out of 208
   2:      4.66 /        1 =       4.6640
Placebo 79 out of 208
   2:      4.40 /        1 =       4.4020
Placebo 80 out of 208
   2:      4.40 /        1 =       4.3970
Placebo 81 out of 208
   2:      4.43 /        1 =       4.4270
Placebo 82 out of 208
   2:      4.38 /        1 =       4.3830
Placebo 83 out of 208
   2:      4.51 /        1 =       4.5150
Placebo 84 out of 208
   2:      4.45 /        1 =       4.4520
Placebo 85 out of 208
   2:      4.36 /        1 =       4.3570
Placebo 86 out of 208
   2:      4.34 /        1 =       4.3430
Placebo 87 out of 208
   2:      4.31 /        1 =       4.3130
Placebo 88 out of 208
   2:      4.41 /        1 =       4.4110
Placebo 89 out of 208
   2:      4.42 /        1 =       4.4230
Placebo 90 out of 208
   2:      4.39 /        1 =       4.3890
Placebo 91 out of 208
   2:      4.48 /        1 =       4.4790
Placebo 92 out of 208
   2:      4.58 /        1 =       4.5760
Placebo 93 out of 208
   2:      4.40 /        1 =       4.3960
Placebo 94 out of 208
   2:      4.41 /        1 =       4.4110
Placebo 95 out of 208
   2:      4.39 /        1 =       4.3950
Placebo 96 out of 208
   2:      4.38 /        1 =       4.3840
Placebo 97 out of 208
   2:      4.45 /        1 =       4.4470
Placebo 98 out of 208
   2:      4.47 /        1 =       4.4700
Placebo 99 out of 208
   2:      4.47 /        1 =       4.4700
Placebo 100 out of 208
   2:      4.56 /        1 =       4.5560
Placebo 101 out of 208
   2:      4.44 /        1 =       4.4400
Placebo 102 out of 208
   2:      4.43 /        1 =       4.4320
Placebo 103 out of 208
   2:      4.42 /        1 =       4.4240
Placebo 104 out of 208
   2:      4.47 /        1 =       4.4690
Placebo 105 out of 208
   2:      4.53 /        1 =       4.5290
Placebo 106 out of 208
   2:      4.46 /        1 =       4.4620
Placebo 107 out of 208
   2:      4.65 /        1 =       4.6540
Placebo 108 out of 208
   2:      4.54 /        1 =       4.5440
Placebo 109 out of 208
   2:      4.42 /        1 =       4.4250
Placebo 110 out of 208
   2:      4.42 /        1 =       4.4240
Placebo 111 out of 208
   2:      4.41 /        1 =       4.4110
Placebo 112 out of 208
   2:      4.54 /        1 =       4.5390
Placebo 113 out of 208
   2:      4.62 /        1 =       4.6190
Placebo 114 out of 208
   2:      4.42 /        1 =       4.4200
Placebo 115 out of 208
   2:      4.46 /        1 =       4.4620
Placebo 116 out of 208
   2:      4.60 /        1 =       4.5970
Placebo 117 out of 208
   2:      4.50 /        1 =       4.5040
Placebo 118 out of 208
   2:      4.46 /        1 =       4.4590
Placebo 119 out of 208
   2:      4.48 /        1 =       4.4790
Placebo 120 out of 208
   2:      4.44 /        1 =       4.4430
Placebo 121 out of 208
   2:      4.46 /        1 =       4.4590
Placebo 122 out of 208
   2:      4.41 /        1 =       4.4100
Placebo 123 out of 208
   2:      4.42 /        1 =       4.4220
Placebo 124 out of 208
   2:      4.56 /        1 =       4.5610
Placebo 125 out of 208
   2:      4.48 /        1 =       4.4770
Placebo 126 out of 208
   2:      4.44 /        1 =       4.4410
Placebo 127 out of 208
   2:      4.42 /        1 =       4.4150
Placebo 128 out of 208
   2:      4.34 /        1 =       4.3420
Placebo 129 out of 208
   2:      4.36 /        1 =       4.3560
Placebo 130 out of 208
   2:      4.32 /        1 =       4.3230
Placebo 131 out of 208
   2:      4.37 /        1 =       4.3660
Placebo 132 out of 208
   2:      4.41 /        1 =       4.4130
Placebo 133 out of 208
   2:      4.48 /        1 =       4.4810
Placebo 134 out of 208
   2:      4.33 /        1 =       4.3300
Placebo 135 out of 208
   2:      4.31 /        1 =       4.3070
Placebo 136 out of 208
   2:      4.37 /        1 =       4.3650
Placebo 137 out of 208
   2:      4.33 /        1 =       4.3260
Placebo 138 out of 208
   2:      4.42 /        1 =       4.4250
Placebo 139 out of 208
   2:      4.44 /        1 =       4.4360
Placebo 140 out of 208
   2:      4.39 /        1 =       4.3930
Placebo 141 out of 208
   2:      4.47 /        1 =       4.4720
Placebo 142 out of 208
   2:      4.47 /        1 =       4.4710
Placebo 143 out of 208
   2:      4.42 /        1 =       4.4200
Placebo 144 out of 208
   2:      4.42 /        1 =       4.4160
Placebo 145 out of 208
   2:      4.45 /        1 =       4.4500
Placebo 146 out of 208
   2:      4.49 /        1 =       4.4930
Placebo 147 out of 208
   2:      4.46 /        1 =       4.4630
Placebo 148 out of 208
   2:      4.51 /        1 =       4.5110
Placebo 149 out of 208
   2:      4.57 /        1 =       4.5730
Placebo 150 out of 208
   2:      4.56 /        1 =       4.5630
Placebo 151 out of 208
   2:      4.45 /        1 =       4.4480
Placebo 152 out of 208
   2:      4.43 /        1 =       4.4260
Placebo 153 out of 208
   2:      4.38 /        1 =       4.3760
Placebo 154 out of 208
   2:      4.47 /        1 =       4.4750
Placebo 155 out of 208
   2:      4.38 /        1 =       4.3800
Placebo 156 out of 208
   2:      4.34 /        1 =       4.3450
Placebo 157 out of 208
   2:      4.39 /        1 =       4.3950
Placebo 158 out of 208
   2:      4.58 /        1 =       4.5760
Placebo 159 out of 208
   2:      4.39 /        1 =       4.3890
Placebo 160 out of 208
   2:      4.46 /        1 =       4.4550
Placebo 161 out of 208
   2:      4.40 /        1 =       4.4020
Placebo 162 out of 208
   2:      4.39 /        1 =       4.3860
Placebo 163 out of 208
   2:      4.42 /        1 =       4.4230
Placebo 164 out of 208
   2:      4.45 /        1 =       4.4470
Placebo 165 out of 208
   2:      4.37 /        1 =       4.3660
Placebo 166 out of 208
   2:      4.32 /        1 =       4.3180
Placebo 167 out of 208
   2:      4.38 /        1 =       4.3760
Placebo 168 out of 208
   2:      4.33 /        1 =       4.3350
Placebo 169 out of 208
   2:      4.37 /        1 =       4.3700
Placebo 170 out of 208
   2:      4.36 /        1 =       4.3640
Placebo 171 out of 208
   2:      4.34 /        1 =       4.3380
Placebo 172 out of 208
   2:      4.34 /        1 =       4.3420
Placebo 173 out of 208
   2:      4.44 /        1 =       4.4420
Placebo 174 out of 208
   2:      4.39 /        1 =       4.3940
Placebo 175 out of 208
   2:      4.32 /        1 =       4.3180
Placebo 176 out of 208
   2:      4.37 /        1 =       4.3710
Placebo 177 out of 208
   2:      4.37 /        1 =       4.3660
Placebo 178 out of 208
   2:      4.34 /        1 =       4.3450
Placebo 179 out of 208
   2:      4.32 /        1 =       4.3200
Placebo 180 out of 208
   2:      4.33 /        1 =       4.3330
Placebo 181 out of 208
   2:      4.40 /        1 =       4.3990
Placebo 182 out of 208
   2:      4.49 /        1 =       4.4880
Placebo 183 out of 208
   2:      4.35 /        1 =       4.3490
Placebo 184 out of 208
   2:      4.31 /        1 =       4.3070
Placebo 185 out of 208
   2:      4.36 /        1 =       4.3630
Placebo 186 out of 208
   2:      4.38 /        1 =       4.3750
Placebo 187 out of 208
   2:      4.37 /        1 =       4.3670
Placebo 188 out of 208
   2:      4.38 /        1 =       4.3760
Placebo 189 out of 208
   2:      4.48 /        1 =       4.4790
Placebo 190 out of 208
   2:      4.48 /        1 =       4.4820
Placebo 191 out of 208
   2:      4.47 /        1 =       4.4690
Placebo 192 out of 208
   2:      4.39 /        1 =       4.3920
Placebo 193 out of 208
   2:      4.37 /        1 =       4.3710
Placebo 194 out of 208
   2:      4.37 /        1 =       4.3730
Placebo 195 out of 208
   2:      4.37 /        1 =       4.3650
Placebo 196 out of 208
   2:      4.44 /        1 =       4.4430
Placebo 197 out of 208
   2:      4.35 /        1 =       4.3520
Placebo 198 out of 208
   2:      4.45 /        1 =       4.4510
Placebo 199 out of 208
   2:      4.44 /        1 =       4.4400
Placebo 200 out of 208
   2:      4.31 /        1 =       4.3090
Placebo 201 out of 208
   2:      4.38 /        1 =       4.3840
Placebo 202 out of 208
   2:      4.32 /        1 =       4.3200
Placebo 203 out of 208
   2:      4.35 /        1 =       4.3480
Placebo 204 out of 208
   2:      4.31 /        1 =       4.3110
Placebo 205 out of 208
   2:      4.38 /        1 =       4.3810
Placebo 206 out of 208
   2:      4.47 /        1 =       4.4670
Placebo 207 out of 208
   2:      4.44 /        1 =       4.4370
Placebo 208 out of 208

. timer off 1 

. timer list 1 
   1:   1464.59 /        1 =    1464.5920

. timer clear 1 

. cap log close, replace 

. ************************************************************************
. ************************************************************************
. /// Append the placebos in one dataset 
> use `placebo1' , clear 

. drop if _n > = 1
(36 observations deleted)

. forvalues i = 1(1)$don  {
  2. append using `placebo`i''
  3. }

. save "${tem}/placeboap_main.dta", replace 
file 1_Data/Temp//placeboap_main.dta saved

. 
. ********************************************************************************
. ********************************************************************************
. /// Identify the placebos that pass the Cohen D criterion 
> /// 4. Placebo Empirical Distribution: This is not Estimated Again.
> use "${tem}/placeboap_main.dta", clear 

. /// Goodness of Fit 
> preserve 

. // Survival Test 
. gcollapse (mean) rmse , by(id) 

. qui cumul rmse, gen(ecdf)

. gsort -ecdf

. qui gen survival = rmse < (1-$rmspe_cutoff)

. qui egen survrate = mean(survival)

. sum survrate

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    survrate |        208    .8413461           0   .8413461   .8413461

. gsort survival id 

. sum survrate

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    survrate |        208    .8413461           0   .8413461   .8413461

. local survrate = round(r(mean),0.001)

. local donors = round(r(sum),1)

. local tot = round(r(N),1)

. twoway line ecdf rmse, sort xline($rmspe_cutoff, lcolor(black)) name(survival,replace) title(
> "Placebo Distribution - Survival Rate `survrate' - `donors' out of `tot donors'",size(small))

. save "${tem}/placebosforinferencerce_main.dta", replace 
file 1_Data/Temp//placebosforinferencerce_main.dta saved

. restore 

. exit 

end of do-file

. /// 2) Estimate the Baseline Model 
> do "${cod}/code_analysis/2_BaselineModel.do"

. ********************************************************************************
. ********************************************************************************
. /// Project: Volatility in the Municipal Bond Market and the MLF
> /// Authors: Felipe Lozano & Luis Navarro
> /// Code: Luis Navarro (lunavarr@iu.edu) 
> /// Update: February 2024
> /// Script: Run Baseline Model: Fixed Credit Rating Cohorts 
> ********************************************************************************
. ********************************************************************************
. graph drop _all 

. set trace off

. /// Load dates 
> 
. ********************************************************************************
. preserve 

. use "${cln}/synth_clean_fixedcr.dta", clear 

. replace month_exp = month_exp - ${treat_period}
(7,632 real changes made)

. drop if treat == 0 
(7,488 observations deleted)

. keep month_exp mofd

. duplicates drop mofd, force 

Duplicates in terms of mofd

(108 observations deleted)

. save "${tem}/dates.dta", replace 
file 1_Data/Temp//dates.dta saved

. restore 

. 
. ********************************************************************************
. /// Step1. Run the synthetic control for the treated units. 
> /// Load the Data for the Robustness Check 
> use "${cln}/synth_clean_fixedcr.dta", clear 

. drop if month_exp <= 3
(636 observations deleted)

. /// 1. Synth Estimation 
> synth_estimation
v_pre_mn:  (4,452 real changes made)
v_pre_sd:  (4,452 real changes made)

  group(id) |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         33       25.00       25.00
          2 |         33       25.00       50.00
          3 |         33       25.00       75.00
          4 |         33       25.00      100.00
------------+-----------------------------------
      Total |        132      100.00
v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 1
               Control Units:  2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27
                              28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  .9433181 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        2 |           0
        3 |           0
        4 |           0
        5 |           0
        6 |           0
        7 |           0
        8 |           0
        9 |           0
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |           0
       17 |           0
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |        .511
       35 |           0
       36 |           0
       37 |        .012
       38 |           0
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |           0
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |           0
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |           0
      117 |           0
      118 |           0
      119 |           0
      120 |           0
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |           0
      134 |           0
      135 |           0
      136 |           0
      137 |           0
      138 |           0
      139 |           0
      140 |           0
      141 |           0
      142 |           0
      143 |           0
      144 |        .106
      145 |           0
      146 |           0
      147 |           0
      148 |           0
      149 |           0
      150 |           0
      151 |           0
      152 |        .048
      153 |           0
      154 |           0
      155 |           0
      156 |           0
      157 |           0
      158 |           0
      159 |           0
      160 |           0
      161 |           0
      162 |        .003
      163 |           0
      164 |        .292
      165 |           0
      166 |           0
      167 |           0
      168 |           0
      169 |           0
      170 |           0
      171 |           0
      172 |           0
      173 |           0
      174 |           0
      175 |           0
      176 |           0
      177 |           0
      178 |           0
      179 |           0
      180 |           0
      181 |           0
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |        .018
      187 |           0
      188 |           0
      189 |           0
      190 |        .008
      191 |           0
      192 |           0
      193 |           0
      194 |           0
      195 |           0
      196 |           0
      197 |           0
      198 |           0
      199 |           0
      200 |           0
      201 |           0
      202 |           0
      203 |           0
      204 |           0
      205 |           0
      206 |           0
      207 |           0
      208 |           0
      209 |           0
      210 |           0
      211 |        .002
      212 |           0
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |  .4591041   .4880519 
                         v(14) |  .2019733   .2320326 
                         v(13) |  .1448178   .1510541 
                         v(12) |  .1541204    .154204 
                         v(11) |  .2380454   .2295357 
                         v(10) |  .1253453   .1527988 
                          v(9) |  .1683819   .2054892 
                          v(8) |  .2108582   .1974715 
                          v(7) |  .2397263   .2334729 
                          v(6) |  .2462788    .251712 
                          v(5) |  .2645356   .2428678 
                          v(4) |  .1447693   .1469135 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000005 saved as .dta format
   2:      4.00 /        1 =       4.0000
Treatment Unit 1 out of 4
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 2
               Control Units: 1 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27
                              28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  1.058758 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        1 |           0
        3 |           0
        4 |           0
        5 |           0
        6 |           0
        7 |           0
        8 |           0
        9 |           0
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |           0
       17 |           0
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |           0
       35 |           0
       36 |           0
       37 |           0
       38 |           0
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |           0
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |           0
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |           0
      117 |           0
      118 |           0
      119 |           0
      120 |           0
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |           0
      134 |           0
      135 |           0
      136 |           0
      137 |           0
      138 |           0
      139 |        .001
      140 |           0
      141 |           0
      142 |           0
      143 |           0
      144 |           0
      145 |           0
      146 |           0
      147 |           0
      148 |           0
      149 |           0
      150 |           0
      151 |           0
      152 |           0
      153 |           0
      154 |           0
      155 |           0
      156 |           0
      157 |           0
      158 |           0
      159 |           0
      160 |           0
      161 |           0
      162 |           0
      163 |           0
      164 |        .827
      165 |           0
      166 |           0
      167 |           0
      168 |        .125
      169 |           0
      170 |        .015
      171 |           0
      172 |           0
      173 |           0
      174 |           0
      175 |           0
      176 |           0
      177 |           0
      178 |           0
      179 |           0
      180 |           0
      181 |           0
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |        .031
      187 |           0
      188 |           0
      189 |           0
      190 |           0
      191 |           0
      192 |           0
      193 |           0
      194 |           0
      195 |           0
      196 |           0
      197 |           0
      198 |           0
      199 |           0
      200 |           0
      201 |           0
      202 |           0
      203 |           0
      204 |           0
      205 |           0
      206 |           0
      207 |           0
      208 |           0
      209 |           0
      210 |           0
      211 |           0
      212 |           0
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |  .4262888   .2835704 
                         v(14) |  .0655433   .2298658 
                         v(13) |  .0953144   .0965394 
                         v(12) |  .1009645   .0972252 
                         v(11) |  .2546003   .1927463 
                         v(10) |  .1920579   .1582129 
                          v(9) |  .1324195   .1565136 
                          v(8) |  .2315191   .1839131 
                          v(7) |  .1360013   .1496214 
                          v(6) |  .1366643   .1426157 
                          v(5) |  .1550362   .1496341 
                          v(4) |  .1923215   .1544156 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000009 saved as .dta format
   2:      3.99 /        1 =       3.9920
Treatment Unit 2 out of 4
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 3
               Control Units: 1 2 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27
                              28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  .7386116 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        1 |           0
        2 |        .188
        4 |           0
        5 |           0
        6 |           0
        7 |           0
        8 |           0
        9 |           0
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |           0
       17 |           0
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |           0
       35 |           0
       36 |           0
       37 |           0
       38 |           0
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |           0
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |           0
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |         .08
      117 |           0
      118 |           0
      119 |           0
      120 |           0
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |           0
      134 |           0
      135 |           0
      136 |           0
      137 |           0
      138 |           0
      139 |           0
      140 |           0
      141 |           0
      142 |           0
      143 |           0
      144 |         .02
      145 |           0
      146 |           0
      147 |           0
      148 |           0
      149 |           0
      150 |           0
      151 |           0
      152 |        .065
      153 |           0
      154 |           0
      155 |           0
      156 |           0
      157 |           0
      158 |           0
      159 |           0
      160 |           0
      161 |           0
      162 |           0
      163 |           0
      164 |        .628
      165 |           0
      166 |           0
      167 |           0
      168 |           0
      169 |           0
      170 |           0
      171 |           0
      172 |           0
      173 |           0
      174 |           0
      175 |           0
      176 |           0
      177 |           0
      178 |           0
      179 |           0
      180 |           0
      181 |           0
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |           0
      187 |           0
      188 |           0
      189 |           0
      190 |        .008
      191 |           0
      192 |           0
      193 |           0
      194 |           0
      195 |           0
      196 |           0
      197 |           0
      198 |           0
      199 |           0
      200 |           0
      201 |           0
      202 |           0
      203 |           0
      204 |           0
      205 |           0
      206 |           0
      207 |        .011
      208 |           0
      209 |           0
      210 |           0
      211 |           0
      212 |           0
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |  .4661015   .4556615 
                         v(14) |  .1655047   .2319689 
                         v(13) |  .1297227   .1259687 
                         v(12) |  .1641958   .1648064 
                         v(11) |  .3311599   .2936276 
                         v(10) |  .1784493   .1711858 
                          v(9) |  .2578021   .1784761 
                          v(8) |  .1737149   .1913497 
                          v(7) |  .2175397   .2198567 
                          v(6) |  .2465736   .2303994 
                          v(5) |  .2040652   .1910202 
                          v(4) |  .1462529   .1424778 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000d saved as .dta format
   2:      3.92 /        1 =       3.9220
Treatment Unit 3 out of 4
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 4
               Control Units: 1 2 3 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27
                              28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  .8812081 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        1 |           0
        2 |           0
        3 |           0
        5 |           0
        6 |           0
        7 |           0
        8 |           0
        9 |           0
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |           0
       17 |           0
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |           0
       35 |           0
       36 |           0
       37 |           0
       38 |           0
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |           0
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |           0
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |           0
      117 |           0
      118 |           0
      119 |           0
      120 |           0
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |           0
      134 |           0
      135 |           0
      136 |           0
      137 |           0
      138 |           0
      139 |        .004
      140 |           0
      141 |           0
      142 |           0
      143 |           0
      144 |           0
      145 |           0
      146 |           0
      147 |           0
      148 |           0
      149 |           0
      150 |           0
      151 |         .25
      152 |         .08
      153 |           0
      154 |           0
      155 |           0
      156 |           0
      157 |           0
      158 |           0
      159 |           0
      160 |           0
      161 |        .355
      162 |           0
      163 |           0
      164 |        .305
      165 |           0
      166 |           0
      167 |           0
      168 |           0
      169 |        .005
      170 |           0
      171 |           0
      172 |           0
      173 |           0
      174 |           0
      175 |           0
      176 |           0
      177 |           0
      178 |           0
      179 |           0
      180 |           0
      181 |           0
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |           0
      187 |           0
      188 |           0
      189 |           0
      190 |           0
      191 |           0
      192 |           0
      193 |           0
      194 |           0
      195 |           0
      196 |           0
      197 |           0
      198 |           0
      199 |           0
      200 |           0
      201 |           0
      202 |           0
      203 |           0
      204 |           0
      205 |           0
      206 |           0
      207 |           0
      208 |           0
      209 |           0
      210 |           0
      211 |           0
      212 |           0
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |  .5243943   .9550864 
                         v(14) |  .3392681   .3298913 
                         v(13) |  .3388458   .3400365 
                         v(12) |  .5253746   .4328924 
                         v(11) |  .5217271   .3953892 
                         v(10) |  .7343846   .5496791 
                          v(9) |  .6027642   .5025887 
                          v(8) |  .8458973   .5655132 
                          v(7) |  .4914578   .4707698 
                          v(6) |  .4407191    .418317 
                          v(5) |  .4605658   .3976879 
                          v(4) |  .2918154   .3623791 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000h saved as .dta format
   2:      3.86 /        1 =       3.8640
Treatment Unit 4 out of 4
   1:     15.78 /        1 =      15.7800
(33 observations deleted)
(132 real changes made)

  month_exp |      Freq.     Percent        Cum.
------------+-----------------------------------
        -12 |          4        3.03        3.03
        -11 |          4        3.03        6.06
        -10 |          4        3.03        9.09
         -9 |          4        3.03       12.12
         -8 |          4        3.03       15.15
         -7 |          4        3.03       18.18
         -6 |          4        3.03       21.21
         -5 |          4        3.03       24.24
         -4 |          4        3.03       27.27
         -3 |          4        3.03       30.30
         -2 |          4        3.03       33.33
         -1 |          4        3.03       36.36
          0 |          4        3.03       39.39
          1 |          4        3.03       42.42
          2 |          4        3.03       45.45
          3 |          4        3.03       48.48
          4 |          4        3.03       51.52
          5 |          4        3.03       54.55
          6 |          4        3.03       57.58
          7 |          4        3.03       60.61
          8 |          4        3.03       63.64
          9 |          4        3.03       66.67
         10 |          4        3.03       69.70
         11 |          4        3.03       72.73
         12 |          4        3.03       75.76
         13 |          4        3.03       78.79
         14 |          4        3.03       81.82
         15 |          4        3.03       84.85
         16 |          4        3.03       87.88
         17 |          4        3.03       90.91
         18 |          4        3.03       93.94
         19 |          4        3.03       96.97
         20 |          4        3.03      100.00
------------+-----------------------------------
      Total |        132      100.00

. save "${tem}/synth_treated.dta", replace 
file 1_Data/Temp//synth_treated.dta saved

. ********************************************************************************
. 
. 
. ********************************************************************************
. /// 2. Do the Synth Graph 
> use "${tem}/synth_treated.dta", clear 

. global graphopts ytitle("Avg Intra-Week Std.Dev",size(small)) ylabel(#10, nogrid labsize(smal
> l) angle(0)) title(, size(small) pos(11) color(black)) plotregion(lcolor(black)) graphregion(
> margin(4 4 4 4)) plotregion(lcolor(black)) xtitle("", size(small)) xlabel(#27, nogrid labsize
> (small) angle(90)) legend(on order(1 "Observed Volatility" 2 "Synthetic Volatility") size(sma
> ll) rows(1)) yscale(titlegap(0))

. ********************************************************************************
. /// Show only the ATE window 
> keep if month_exp < ${tr_eff_window}
(24 observations deleted)

. merge m:1 month_exp using "${tem}/dates.dta", keep(match master) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                               108  
    -----------------------------------------

. qui sum mofd if month_exp == 0 

. local xline = r(mean)

. ********************************************************************************
. qui tab fileid 

. global rows = r(r)

. 
. local title1 = "A"

. local title2 = "AA"

. local title3 = "AAA"

. local title4 = "BBB"

. local lineopts lcolor(gray) lpattern(dash) lwidth(vthin)

. local lineopts1 lwidth(medthin) msize(vsmall)

. 
. forvalues i=1(1)$rows {
  2.     preserve 
  3.         qui keep if fileid == `i'
  4.         twoway (line treated mofd, lcolor(black) lpattern(solid) mcolor(black) msymbol(cir
> cle) `lineopts1') ///
>                 (line synth mofd, lcolor(cranberry) lpattern(dash) mcolor(cranberry) msymbol(
> square) `lineopts1'),  ///
>                 $graphopts title("`title`i''") name(gr`i',replace) xline(`xline' , `lineopts'
> ) yline(0 , `lineopts')
  5.         restore 
  6. }

. 
. global combopts xcommon ycommon rows(2) cols(2)

. grc1leg gr3 gr2 gr1 gr4, legendfrom(gr2) name(grcomb_main,replace) $combopts 

. graph display grcomb_main, ysize(80) xsize(100) scale(.9)

. graph export "${oup}/Synth_Graph_main.pdf", $export
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//Synth_Graph_main.pdf saved as PDF format

. ********************************************************************************
. 
. 
. 
. ********************************************************************************
. /// 3. Express placebos in units of the treated series 
> use "${cln}/synth_clean_fixedcr.dta", clear 

. drop if month_exp <= 3
(636 observations deleted)

. //// 
> placebo_outcome_main
v_pre_mn:  (4,452 real changes made)
v_pre_sd:  (4,452 real changes made)
(29,952 real changes made)

  month_exp |      Freq.     Percent        Cum.
------------+-----------------------------------
        -15 |        832        2.78        2.78
        -14 |        832        2.78        5.56
        -13 |        832        2.78        8.33
        -12 |        832        2.78       11.11
        -11 |        832        2.78       13.89
        -10 |        832        2.78       16.67
         -9 |        832        2.78       19.44
         -8 |        832        2.78       22.22
         -7 |        832        2.78       25.00
         -6 |        832        2.78       27.78
         -5 |        832        2.78       30.56
         -4 |        832        2.78       33.33
         -3 |        832        2.78       36.11
         -2 |        832        2.78       38.89
         -1 |        832        2.78       41.67
          0 |        832        2.78       44.44
          1 |        832        2.78       47.22
          2 |        832        2.78       50.00
          3 |        832        2.78       52.78
          4 |        832        2.78       55.56
          5 |        832        2.78       58.33
          6 |        832        2.78       61.11
          7 |        832        2.78       63.89
          8 |        832        2.78       66.67
          9 |        832        2.78       69.44
         10 |        832        2.78       72.22
         11 |        832        2.78       75.00
         12 |        832        2.78       77.78
         13 |        832        2.78       80.56
         14 |        832        2.78       83.33
         15 |        832        2.78       86.11
         16 |        832        2.78       88.89
         17 |        832        2.78       91.67
         18 |        832        2.78       94.44
         19 |        832        2.78       97.22
         20 |        832        2.78      100.00
------------+-----------------------------------
      Total |     29,952      100.00

. save "${tem}/synth_placebos.dta", replace 
file 1_Data/Temp//synth_placebos.dta saved

. ********************************************************************************
. 
. ********************************************************************************
. /// 4. Identify the placebos that pass the cohen-d criterion 
> use "${tem}/synth_placebos.dta", clear 

. merge m:1 id using "${tem}/placebosforinferencerce_main.dta", keep(match master) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                            29,952  
    -----------------------------------------

. keep if survival == 1
(4,752 observations deleted)

. /// Save data 
> tempfile placeboempiricaldistribution

. save "${tem}/placeboempiricaldistribution_main.dta", replace
file 1_Data/Temp//placeboempiricaldistribution_main.dta saved

. ********************************************************************************
.  
.  
. /// 5. ATE and Pvalues 
> use "${tem}/synth_treated.dta", clear 

. tab fileid

     fileid |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         33       25.00       25.00
          2 |         33       25.00       50.00
          3 |         33       25.00       75.00
          4 |         33       25.00      100.00
------------+-----------------------------------
      Total |        132      100.00

. global cols = r(r)

. display $cols
4

. 
. local title1 = "A"

. local title2 = "AA"

. local title3 = "AAA"

. local title4 = "BBB"

. /// Matrix to store results 
> matrix define R=J(12,$cols,.)

. matrix colnames R = "A" "AA" "AAA" "BBB"

. matrix rownames R = "ate" "se" "ci_min" "ci_max"  "pval2" "pval1" "vol_pre" "vol_treat" "exce
> ss_vol" "ate_excess_vol" "rmspe" "id"

. matlist R 

             |         A         AA        AAA        BBB 
-------------+-------------------------------------------
         ate |         .          .          .          . 
          se |         .          .          .          . 
      ci_min |         .          .          .          . 
      ci_max |         .          .          .          . 
       pval2 |         .          .          .          . 
       pval1 |         .          .          .          . 
     vol_pre |         .          .          .          . 
   vol_treat |         .          .          .          . 
  excess_vol |         .          .          .          . 
ate_excess~l |         .          .          .          . 
       rmspe |         .          .          .          . 
          id |         .          .          .          . 

. 
. /// Loop to compute the ATE for each treated unit 
> forvalues j = 1(1)$cols { 
  2.         //// 1.- Store All Treated Unit Characteristics 
> 
.         qui use "${tem}/synth_treated.dta", clear
  3.         egen group = group(id fileid)
  4.         qui drop ate tr_eff
  5.         /// Estimate Treatment Effect Using Treated and Synthetic Series (Adjusted for the
> ir own mean and standard deviation) 
>         bysort group: gen tr_eff = treat_lev - synth_lev
  6.         bysort group: egen ate = mean(tr_eff) if month_exp >=0 & month_exp <= ${tr_eff_win
> dow}
  7.         /// Pre-Measures in Volatility 
>         /// Keep only instrument `j' and donors 
>         qui keep if fileid == `j'
  8.         /// Average Treatment Effect 
>         qui sum ate 
  9.         global ate = r(mean)
 10.         mat R[1,`j'] = $ate
 11.         /// ATE in absolute value (to compute ATE in percent of Excess Volatility)
>         local absate = abs($ate)
 12.         /// Volatility Pre-Treatment Period: Average Volatility Observed in the Pre-Treatm
> ent Period 
>         qui sum treat_lev if month_exp < -1
 13.         local vol_pre = r(mean)
 14.         mat R[7,`j'] = `vol_pre'
 15.         /// Volatility Observed in March 2020: Spike due to COVID 
>         qui sum treat_lev if month_exp == -1
 16.         local vol_treat = r(mean)
 17.         mat R[8,`j'] = `vol_treat'
 18.         /// Compute Excess Volatility: Difference in Average Volatility and Volatility Dur
> ing the Pandemic 
>         local excess_vol = `vol_treat' - `vol_pre'
 19.         mat R[9,`j'] = `excess_vol'
 20.         /// ATE in Terms of Excess Volatility 
>         local ate_excess_vol = 100*(`absate'/`excess_vol')
 21.         mat R[10,`j'] = `ate_excess_vol'
 22.         /// RMSE 
>         qui sum rmse 
 23.         mat R[11,`j'] = r(mean)
 24.         /// Id
>         qui sum id 
 25.         mat R[12,`j'] = r(mean)
 26. 
.         
.         /// 2.- Count How Many times the ATE for the treated unit exceeds the ATE at the plac
> ebo empirical distribution 
>         *preserve 
.         qui use "${tem}/placeboempiricaldistribution_main.dta" , clear 
 27.         /// Estimate the Average Treatment Effect for the specific window 
>                 qui egen group = group(id fileid)
 28.         qui drop ate
 29.         bysort group: egen ate = mean(tr_eff) if month_exp >=0 & month_exp <= ${tr_eff_win
> dow}
 30.         qui gcollapse (mean) ate, by(id fileid group)
 31.         /// keep only the empirical distribution of state j
>         qui keep if fileid == `j'
 32.         /// Standard Error 
>         qui sum ate 
 33.         local se = r(sd)
 34.         mat R[2,`j'] = `se'
 35.         /// Hypothesis Testing and P Values 
>         qui cumul ate, gen(cdf)
 36.         qui gsort cdf
 37.         /// Hypothesis Testing and P Values 
>         _pctile ate, percentiles(2.5 97.5)
 38.         mat R[3,`j'] = r(r1)
 39.         mat R[4,`j'] = r(r2)
 40.         /// Cavallo Permutation Test Approach: Left-sided one-tail test. 
>         /// Hypothesis: negative coefficient, hence the left-test. 
>         /// Left-sided test: count how many times the placebos are more negative than the tre
> atment effect. 
>         /// (Inutition: p-val = 0 implies the ATE is more negative than all the placebos, ie:
>  is smaller in all cases). 
>         /// The p-value is the number of time the ATE is larger than the placebo estimates. 
>         qui gen pcount = ate < $ate 
 41.         /// p-value 
>         sum pcount 
 42.     local pval1 = round(r(mean),0.001)
 43.         mat R[5,`j'] = `pval1'
 44.         
.         /// Two Tail Test 
>         qui drop pcount 
 45.         qui gen atetreat = abs($ate)
 46.         qui gen absate = abs(ate)
 47.         /// count how many times the 
>         qui gen pcount = absate < atetreat
 48.         qui sum pcount
 49.         local pval2= round(r(mean),0.001)
 50.         mat R[6,`j'] = `pval2'
 51.         
.         /// Percentiles for lines in density plot
>         cap drop ate_cdf
 52.         qui cumul ate, gen(ate_cdf)
 53.         /// Percentile 2.5% 
>         sum ate if ate_cdf <= 0.025
 54.         local p025 = r(max)
 55.         /// Percentile 5.0% 
>         sum ate if ate_cdf <= 0.05
 56.         local p050 = r(max)     
 57.         /// Percentile 95.0% 
>         sum ate if ate_cdf <= 0.95
 58.         local p950 = r(max)
 59.         /// Percentile 97.5% 
>         sum ate if ate_cdf <= 0.975
 60.         local p975 = r(max)
 61.         
.         /// ATE's Empirical Distribution - 
>         local density_opts recast(line) lcolor(black) lwidth(medthin) lpattern(solid) xline($
> ate, lcolor(maroon) lpattern(longdash)) xtitle("ATE Estimate") ytitle("Density") xlabel(#10, 
> angle(0) labsize(small)) ylabel(#10, angle(0) labsize(small)) xscale(range(0 $ate)) legend(of
> f) yscale(titlegap(0))
 62.         /// Percentiles plot
>         local line1 lcolor(ebblue) lpattern(shortdash) lwidth(medthin)
 63.         local line2 lcolor(eltblue) lpattern(longdash) lwidth(medthin)
 64.         local percentile_lines xline(`p050', `line1') 
 65.         *xline(`p050', `line2') xline(`p950', `line2')
. 
.         qui kdensity ate, `density_opts' title("`title`j'': Left Tail Test p-value = `pval1'"
> , pos(11) size(small))  name(ate_dens`j',replace) `percentile_lines'
 66.         
. }
(68 missing values generated)
(14,000 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        175    .0171429    .1301761          0          1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.1134064    .0187072  -.1277247  -.0861053

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8    -.094363    .0240479  -.1277247     -.0708

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        166    -.007318    .0271363  -.1277247   .0515383

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        170   -.0055417    .0291791  -.1277247   .0739622
(68 missing values generated)
(14,000 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        175           0           0          0          0

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.1221783    .0201542  -.1376042  -.0927655

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8    -.101662     .025908  -.1376042  -.0762764

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        166   -.0078841    .0292352  -.1376042   .0555248

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        170   -.0059703     .031436  -.1376042   .0796832
(68 missing values generated)
(14,000 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        175           0           0          0          0

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.1200483    .0198028  -.1352052  -.0911482

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8   -.0998896    .0254563  -.1352052  -.0749466

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        166   -.0077466    .0287256  -.1352052   .0545568

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        170   -.0058662     .030888  -.1352052    .078294
(68 missing values generated)
(14,000 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        175    .9257143    .2629878          0          1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.2043325    .0337061  -.2301309  -.1551421

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8   -.1700207    .0433289  -.2301309  -.1275655

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        166   -.0131855    .0488934  -.2301309   .0928604

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        170   -.0099848     .052574  -.2301309   .1332631

. 
. graph combine ate_dens3 ate_dens2 ate_dens1 ate_dens4, rows(2) cols(2) ycommon name(dens_comb
> ined, replace)

. graph display dens_combined, ysize(80) xsize(100) scale(.9)

. graph export "${oup}/ate_dens_main.pdf", $export 
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//ate_dens_main.pdf saved as PDF format

. ********************************************************************************
. 
. 
. ********************************************************************************
. //// 5.1. Create Main Results Table 
> ate_table 
number of observations will be reset to 4
Press any key to continue, or Break to abort
Number of observations (_N) was 0, now 4.
(0 real changes made)
(0 real changes made)
(0 real changes made)

. list  

     +--------------------------------------------------------------------------+
  1. |                            Results |              AAA |               AA |
     |       Average Treatment Effect (a) |       -0.1652*** |       -0.1912*** |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                   -0.1153          |                    0.0692           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  2. |                            Results |              AAA |               AA |
     |                                 SE |         (0.0484) |         (0.0493) |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                  (0.0458)          |                  (0.0825)           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  3. |                            Results |              AAA |               AA |
     |                      Conf Interval | (-0.0878,0.1222) | (-0.0894,0.1243) |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |          (-0.0830,0.1154)          |          (-0.1495,0.2079)           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  4. |                            Results |              AAA |               AA |
     |            Historic Volatility (b) |           0.2014 |           0.1539 |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                    0.1944          |                    0.5084           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  5. |                            Results |              AAA |               AA |
     |          Volatility March 2020 (c) |           0.4661 |           0.4263 |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                    0.4591          |                    0.5244           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  6. |                            Results |              AAA |               AA |
     |      Excess Volatility (d = c - b) |           0.2647 |           0.2724 |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                    0.2647          |                    0.0160           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  7. |                            Results |              AAA |               AA |
     | ATE, % Excess Volatility (e = d/a) |        62.4089\% |        70.1650\% |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                 43.5787\%          |                433.7090\%           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  8. |                            Results |              AAA |               AA |
     |                P-Value (Left Tail) |           0.0000 |           0.0000 |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                    0.0170          |                    0.9260           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  9. |                            Results |              AAA |               AA |
     |                P-Value (Two Tails) |           0.9890 |           0.9940 |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                    0.9540          |                    0.8460           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
 10. |                            Results |              AAA |               AA |
     |                              RMSPE |           0.0011 |           0.0047 |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                    0.0004          |                    0.0286           |
     +--------------------------------------------------------------------------+

. save "${tem}/ATE_Results_Full_main.dta", replace 
file 1_Data/Temp//ATE_Results_Full_main.dta saved

. 
. /// Export Tables 
> drop if Results == "Conf Interval" | Results == "P-Value (One Tail)" | Results == "P-Value (T
> wo Tails)" 
(2 observations deleted)

. replace Results = "" if Results == "SE"
(1 real change made)

. list 

     +---------------------------------------------------------------------------------------+
     |                            Results          AAA           AA           A          BBB |
     |---------------------------------------------------------------------------------------|
  1. |       Average Treatment Effect (a)   -0.1652***   -0.1912***     -0.1153       0.0692 |
  2. |                                        (0.0484)     (0.0493)    (0.0458)     (0.0825) |
  3. |            Historic Volatility (b)       0.2014       0.1539      0.1944       0.5084 |
  4. |          Volatility March 2020 (c)       0.4661       0.4263      0.4591       0.5244 |
  5. |      Excess Volatility (d = c - b)       0.2647       0.2724      0.2647       0.0160 |
     |---------------------------------------------------------------------------------------|
  6. | ATE, % Excess Volatility (e = d/a)    62.4089\%    70.1650\%   43.5787\%   433.7090\% |
  7. |                P-Value (Left Tail)       0.0000       0.0000      0.0170       0.9260 |
  8. |                              RMSPE       0.0011       0.0047      0.0004       0.0286 |
     +---------------------------------------------------------------------------------------+

. texsave * using "${oup}/ATE_Results_main.tex", replace  decimalalign nofix 

. ********************************************************************************
. 
. 
. 
. ********************************************************************************
. /// 6. Smokeplots 
> use "${tem}/synth_treated.dta", clear 

. qui gen treat = 1 

. append using "${tem}/placeboempiricaldistribution.dta", force  

. qui replace treat = 0 if treat == . 

. drop if fileid >= 6 
(0 observations deleted)

. tab fileid, matrow(F)

     fileid |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      6,333       25.00       25.00
          2 |      6,333       25.00       50.00
          3 |      6,333       25.00       75.00
          4 |      6,333       25.00      100.00
------------+-----------------------------------
      Total |     25,332      100.00

. global rows = r(r)

. 
. ********************************************************************************
. /// Show only the ATE window 
> keep if month_exp < ${tr_eff_window}
(4,224 observations deleted)

. ********************************************************************************
. 
. /// For Each Treated Unit 
> forvalues j=1(1)$rows {
  2. preserve        
  3. use "${tem}/ATE_Results_Full_main.dta", clear
  4. order Results A AA AAA BBB
  5. rename (Results A AA AAA BBB) (names b1 b2 b3 b4) 
  6. 
. local ate = b`j'[1]
  7. local pval = b`j'[8]
  8. local excess_vol = b`j'[7]
  9. local rmspe = b`j'[10]
 10. 
. dis "`ate'"
 11. dis "`pval'"
 12. dis "`excess_vol'"
 13. dis "`rmspe'"
 14. restore 
 15. 
. preserve
 16. qui keep if fileid == `j'
 17. sort id month_exp
 18. 
. /// Create Percentile Variables 
> gen p1 = . 
 19. gen p2 = . 
 20. gen p5 = . 
 21. gen p95 = . 
 22. gen p97 = . 
 23. gen p99 = . 
 24. 
. /// Create Percentile Variables For each Experiment Month. So, for any period it will compute
>  the percentiles at such period across all donor units, to then save it with the treated unit
> s. 
> forvalues t= -15(1)20 {
 25.         _pctile tr_eff if month_exp == `t' & treat == 0, percentiles(1 2.5 5 95 97.5 99)
 26.         qui replace p1 = r(r1) if month_exp == `t' & treat == 1
 27.         qui replace p2 = r(r2) if month_exp == `t' & treat == 1
 28.         qui replace p5 = r(r3) if month_exp == `t' & treat == 1
 29.         qui replace p95 = r(r4) if month_exp == `t' & treat == 1
 30.         qui replace p97 = r(r5) if month_exp == `t' & treat == 1 
 31.         qui replace p99 = r(r6) if month_exp == `t' & treat == 1
 32. }
 33. /// Keep treated and do the graph 
> keep if treat == 1
 34. merge 1:1 month_exp using "${tem}/dates.dta", keep(match master) nogen
 35. qui sum mofd if month_exp == 0 
 36. local xline = r(mean)
 37. local lineopts lcolor(gray) lpattern(dash) lwidth(vthin)
 38. global smoke_options ytitle("Treatment Effect", size(vsmall)) ylabel(#8, nogrid labsize(vs
> mall) angle(0)) xtitle("", size(vsmall)) xlabel(#16, labsize(vsmall) angle(90) nogrid) title(
> , size(small) pos(11) color(black)) xsca(titlegap(*-.5)) ysca(titlegap(*-3)) plotregion(lcolo
> r()) legend(on order(1 "CI (SmokeArea)" 2 "Treatment Effect") rows(1) size(small)) plotregion
> (color()) graphregion(color() margin(4 4 4 4)) plotregion(lcolor(black)) 
 39. 
. twoway (rarea p1 p99 mofd,     fc(gs13%40) lc(gs15%40) lw(medthick)) ///
>                 (rarea p2 p97 mofd, fc(gs10%40) lc(gs12%40) lw(medthick)) ///   
>                 (rarea p5 p95 mofd,      fc(gs7%40)  lc(gs9%40) lw(medthick))   ///
>                 (connected tr_eff mofd, sort lcolor(maroon) lpattern(solid) mcolor(maroon) ms
> ize(vsmall) msymbol(circle)), ///
>                 xline(`xline' , `lineopts') yline(0 , `lineopts') $smoke_options name(gr`j', 
> replace) title("`title`j''", size(small) pos(11)) legend(order(- 1 5) note("ATE = `ate'" "p-v
> alue = `pval'" "RMSPE = `rmspe'" "ATE (% Excess Volatility) = `excess_vol'", pos(11) size(vsm
> all)) label(1 "90/95/99 C.I.") pos(11) ring(0) cols(1) size(tiny) region(lstyle(none) fcolor(
> none)))
 40. restore 
 41. }
-0.1153
0.0170
43.5787\%
0.0004
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,250 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                27  
    -----------------------------------------
-0.1912***
0.0000
70.1650\%
0.0047
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,250 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                27  
    -----------------------------------------
-0.1652***
0.0000
62.4089\%
0.0011
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,250 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                27  
    -----------------------------------------
0.0692
0.9260
433.7090\%
0.0286
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,250 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                27  
    -----------------------------------------

. 
. graph combine gr3 gr2 gr1 gr4, name(grcombrc3,replace) $combopts 

. graph display grcombrc3, ysize(80) xsize(100) scale(.9)

. graph export "${oup}/SmokeCombinedOut_main.pdf", $export 
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//SmokeCombinedOut_main.pdf saved as PDF format

. 
. *******************************************************************************
. /// Dynamic Treatment Effect 
> ********************************************************************************
. ///Crosswalks for months 
>  
. /// Treatment Effect by Period 
> use "${tem}/synth_treated.dta", clear 

. /// Estimate the Average Treatment Effect for the specific window 
> egen group = group(id fileid)

. qui drop ate

. 
. forvalues i=1(1)$treat_period {
  2. bysort group: egen ate`i' = mean(tr_eff) if month_exp >=0 & month_exp <= `i'
  3. }
(124 missing values generated)
(120 missing values generated)
(116 missing values generated)
(112 missing values generated)
(108 missing values generated)
(104 missing values generated)
(100 missing values generated)
(96 missing values generated)
(92 missing values generated)
(88 missing values generated)
(84 missing values generated)
(80 missing values generated)
(76 missing values generated)
(72 missing values generated)
(68 missing values generated)
(64 missing values generated)

. qui gcollapse (mean) ate*, by(id)

. reshape long ate, i(id) j(month_exp)
(j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations                4   ->   64          
Number of variables                  17   ->   3           
j variable (16 values)                    ->   month_exp
xij variables:
                    ate1 ate2 ... ate16   ->   ate
-----------------------------------------------------------------------------

. 
. merge m:1 month_exp using "${tem}/dates.dta", keep(match master) nogen
(variable month_exp was byte, now float to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                64  
    -----------------------------------------

. 
. label define id 1 "A" 2 "AA" 3 "AAA" 4 "BBB"

. label values id id 

. 
. twoway  (connected ate mofd if id == 1, msize(vsmall) msymbol(circle) mcolor(black) lcolor(bl
> ack) lwidth(thin)) ///
>                 (connected ate mofd if id == 2, msize(vsmall) msymbol(triangle) mcolor(blue) 
>  lcolor(blue) lwidth(thin)) ///
>                 (connected ate mofd if id == 3, msize(vsmall) msymbol(square) mcolor(cranberr
> y) lcolor(cranberry) lwidth(thin)) ///
>                 (connected ate mofd if id == 4, msize(vsmall) msymbol(diamond) mcolor(green) 
> lcolor(green) lwidth(thin)), ///
>                 xlabel(#16, labsize(small) angle(90)) ylabel(#10, labsize(small) angle(0)) ti
> tle("Cumulative ATE - Months After the Intervention", size(medsmall) pos(11)) name(cumulative
> ate, replace) yline(0, lpattern(dash) lcolor(gray)) legend(on order(1 "A" 2 "AA" 3 "AAA" 4 "B
> BB") rows(1)) ytitle("Average Treatment Effect") xtitle("") yscale(titlegap(0))

. graph display cumulativeate, ysize(50) xsize(85) scale(.9)

. graph export "${oup}/cumulativeate_main.pdf", replace 
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//cumulativeate_main.pdf saved as PDF format

. 
. 
. 
end of do-file

. /// 3) Estimate the Robustness Check for Cares Act Heterogeneity
> do "${cod}/code_analysis/3_RC_CaresAct.do"

. ********************************************************************************
. ********************************************************************************
. /// Project: Volatility in the Municipal Bond Market and the MLF
> /// Authors: Felipe Lozano & Luis Navarro
> /// Code: Luis Navarro (lunavarr@iu.edu) 
> /// Update: February 2024
> /// Script: Run Robustness Check: Cares Act Heterogeneity 
> ********************************************************************************
. ********************************************************************************
. graph drop _all 

. set trace off

. /// Load dates 
> 
. ********************************************************************************
. preserve 

. use "${cln}/synth_clean_crf.dta", clear 

. replace month_exp = month_exp - ${treat_period}
(7,776 real changes made)

. drop if treat == 0 
(7,488 observations deleted)

. keep month_exp mofd

. duplicates drop mofd, force 

Duplicates in terms of mofd

(252 observations deleted)

. save "${tem}/dates.dta", replace 
file 1_Data/Temp//dates.dta saved

. restore 

. 
. ********************************************************************************
. /// Step1. Run the synthetic control for the treated units. 
> /// Load the Data for the Robustness Check 
> use "${cln}/synth_clean_crf.dta", clear 

. drop if month_exp <= 3
(648 observations deleted)

. qui sum v if name == "A-p0-p50" & mofd == tm(2019m5)

. replace v = r(mean) if name == "A-p0-p50" & mofd == tm(2019m4)
(1 real change made)

. /// 1. Synth Estimation 
> synth_estimation
v_pre_mn:  (4,536 real changes made)
v_pre_sd:  (4,536 real changes made)

  group(id) |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         33       12.50       12.50
          2 |         33       12.50       25.00
          3 |         33       12.50       37.50
          4 |         33       12.50       50.00
          5 |         33       12.50       62.50
          6 |         33       12.50       75.00
          7 |         33       12.50       87.50
          8 |         33       12.50      100.00
------------+-----------------------------------
      Total |        264      100.00
v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 1
               Control Units:  2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212 213 214 215 216
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27
                              28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  .7250919 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        2 |           0
        3 |        .046
        4 |           0
        5 |           0
        6 |           0
        7 |           0
        8 |        .179
        9 |           0
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |           0
       17 |         .01
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |           0
       35 |           0
       36 |           0
       37 |           0
       38 |           0
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |        .548
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |           0
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |           0
      117 |           0
      118 |           0
      119 |           0
      120 |           0
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |           0
      134 |           0
      135 |           0
      136 |           0
      137 |           0
      138 |           0
      139 |           0
      140 |           0
      141 |           0
      142 |           0
      143 |           0
      144 |           0
      145 |           0
      146 |           0
      147 |           0
      148 |           0
      149 |           0
      150 |           0
      151 |           0
      152 |        .007
      153 |           0
      154 |           0
      155 |           0
      156 |           0
      157 |           0
      158 |           0
      159 |           0
      160 |        .043
      161 |           0
      162 |           0
      163 |         .03
      164 |           0
      165 |        .058
      166 |           0
      167 |           0
      168 |           0
      169 |           0
      170 |           0
      171 |           0
      172 |           0
      173 |           0
      174 |           0
      175 |           0
      176 |        .007
      177 |           0
      178 |           0
      179 |           0
      180 |           0
      181 |           0
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |           0
      187 |           0
      188 |           0
      189 |           0
      190 |           0
      191 |           0
      192 |           0
      193 |           0
      194 |           0
      195 |           0
      196 |           0
      197 |           0
      198 |           0
      199 |           0
      200 |           0
      201 |           0
      202 |           0
      203 |           0
      204 |           0
      205 |           0
      206 |           0
      207 |           0
      208 |           0
      209 |           0
      210 |           0
      211 |           0
      212 |           0
      213 |           0
      214 |        .074
      215 |           0
      216 |           0
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |  .6064959   .6116066 
                         v(14) |  .2107494   .2564153 
                         v(13) |  .2882442   .2866968 
                         v(12) |  .2044632   .2094967 
                         v(11) |  .2407371   .2338936 
                         v(10) |  .2930065   .2763118 
                          v(9) |  .1807857   .2321893 
                          v(8) |  .2334895   .2425597 
                          v(7) |  .2316376   .2309537 
                          v(6) |  .2685842   .2659934 
                          v(5) |  .1472401   .1749494 
                          v(4) |  .1472401   .1469535 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000005 saved as .dta format
   2:      4.28 /        1 =       4.2780
Treatment Unit 1 out of 8
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 2
               Control Units: 1 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212 213 214 215 216
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27
                              28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  .8938699 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        1 |           0
        3 |           0
        4 |           0
        5 |           0
        6 |           0
        7 |           0
        8 |           0
        9 |           0
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |           0
       17 |           0
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |           0
       35 |           0
       36 |           0
       37 |           0
       38 |        .187
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |        .047
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |           0
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |           0
      117 |           0
      118 |           0
      119 |           0
      120 |           0
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |           0
      134 |           0
      135 |           0
      136 |           0
      137 |           0
      138 |           0
      139 |           0
      140 |           0
      141 |           0
      142 |           0
      143 |           0
      144 |           0
      145 |           0
      146 |           0
      147 |           0
      148 |        .108
      149 |           0
      150 |           0
      151 |           0
      152 |           0
      153 |           0
      154 |           0
      155 |           0
      156 |         .04
      157 |           0
      158 |           0
      159 |           0
      160 |           0
      161 |           0
      162 |           0
      163 |           0
      164 |           0
      165 |           0
      166 |           0
      167 |           0
      168 |        .559
      169 |           0
      170 |           0
      171 |           0
      172 |           0
      173 |           0
      174 |           0
      175 |           0
      176 |           0
      177 |           0
      178 |           0
      179 |           0
      180 |           0
      181 |           0
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |           0
      187 |           0
      188 |           0
      189 |           0
      190 |           0
      191 |           0
      192 |           0
      193 |           0
      194 |           0
      195 |           0
      196 |        .026
      197 |           0
      198 |           0
      199 |           0
      200 |           0
      201 |           0
      202 |           0
      203 |           0
      204 |           0
      205 |           0
      206 |           0
      207 |           0
      208 |           0
      209 |           0
      210 |           0
      211 |        .034
      212 |           0
      213 |           0
      214 |           0
      215 |           0
      216 |           0
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |  .4761422   .5863529 
                         v(14) |  .2011583   .2813742 
                         v(13) |  .1580388   .1766741 
                         v(12) |  .1989004   .1900339 
                         v(11) |   .279104   .2860175 
                         v(10) |  .2213673   .2254647 
                          v(9) |  .1699353   .2367305 
                          v(8) |  .2183282   .2166504 
                          v(7) |  .3636296   .3026302 
                          v(6) |  .2683497   .2699126 
                          v(5) |  .4084655    .337995 
                          v(4) |  .1447693   .1661026 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000009 saved as .dta format
   2:      4.06 /        1 =       4.0590
Treatment Unit 2 out of 8
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 3
               Control Units: 1 2 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212 213 214 215 216
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27
                              28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  .7287134 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        1 |           0
        2 |           0
        4 |        .314
        5 |           0
        6 |         .06
        7 |           0
        8 |           0
        9 |           0
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |           0
       17 |           0
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |           0
       35 |           0
       36 |           0
       37 |           0
       38 |           0
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |           0
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |           0
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |           0
      117 |           0
      118 |           0
      119 |           0
      120 |           0
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |           0
      134 |           0
      135 |           0
      136 |           0
      137 |           0
      138 |           0
      139 |           0
      140 |           0
      141 |           0
      142 |           0
      143 |        .001
      144 |           0
      145 |           0
      146 |           0
      147 |           0
      148 |           0
      149 |           0
      150 |           0
      151 |           0
      152 |           0
      153 |           0
      154 |           0
      155 |        .033
      156 |           0
      157 |           0
      158 |           0
      159 |           0
      160 |           0
      161 |           0
      162 |           0
      163 |           0
      164 |           0
      165 |           0
      166 |           0
      167 |           0
      168 |        .552
      169 |           0
      170 |           0
      171 |           0
      172 |           0
      173 |           0
      174 |        .041
      175 |           0
      176 |           0
      177 |           0
      178 |           0
      179 |           0
      180 |           0
      181 |           0
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |           0
      187 |           0
      188 |           0
      189 |           0
      190 |           0
      191 |           0
      192 |           0
      193 |           0
      194 |           0
      195 |           0
      196 |           0
      197 |           0
      198 |           0
      199 |           0
      200 |           0
      201 |           0
      202 |           0
      203 |           0
      204 |           0
      205 |           0
      206 |           0
      207 |           0
      208 |           0
      209 |           0
      210 |           0
      211 |           0
      212 |           0
      213 |           0
      214 |           0
      215 |           0
      216 |           0
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |  .4354619   .3055212 
                         v(14) |  .0808713   .1703934 
                         v(13) |  .1184489   .0887455 
                         v(12) |  .1111126   .0960867 
                         v(11) |  .2803278   .1985013 
                         v(10) |  .1987298   .1558984 
                          v(9) |  .1145063   .1765466 
                          v(8) |  .2850647   .1842268 
                          v(7) |  .1514613   .1633231 
                          v(6) |   .139013   .1394267 
                          v(5) |   .170836   .1489448 
                          v(4) |   .193505   .1541259 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000d saved as .dta format
   2:      4.29 /        1 =       4.2910
Treatment Unit 3 out of 8
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 4
               Control Units: 1 2 3 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212 213 214 215 216
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27
                              28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  .6301343 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        1 |           0
        2 |           0
        3 |        .061
        5 |           0
        6 |        .098
        7 |           0
        8 |           0
        9 |           0
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |           0
       17 |           0
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |           0
       35 |           0
       36 |           0
       37 |           0
       38 |           0
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |           0
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |        .478
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |           0
      117 |           0
      118 |           0
      119 |           0
      120 |           0
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |           0
      134 |           0
      135 |           0
      136 |           0
      137 |           0
      138 |           0
      139 |           0
      140 |           0
      141 |           0
      142 |           0
      143 |        .002
      144 |           0
      145 |           0
      146 |           0
      147 |           0
      148 |           0
      149 |           0
      150 |           0
      151 |           0
      152 |           0
      153 |           0
      154 |           0
      155 |           0
      156 |           0
      157 |           0
      158 |           0
      159 |           0
      160 |           0
      161 |           0
      162 |           0
      163 |           0
      164 |           0
      165 |           0
      166 |           0
      167 |           0
      168 |        .093
      169 |           0
      170 |           0
      171 |           0
      172 |           0
      173 |           0
      174 |           0
      175 |           0
      176 |        .046
      177 |           0
      178 |        .193
      179 |           0
      180 |           0
      181 |           0
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |           0
      187 |           0
      188 |           0
      189 |           0
      190 |        .023
      191 |           0
      192 |           0
      193 |           0
      194 |           0
      195 |        .007
      196 |           0
      197 |           0
      198 |           0
      199 |           0
      200 |           0
      201 |           0
      202 |           0
      203 |           0
      204 |           0
      205 |           0
      206 |           0
      207 |           0
      208 |           0
      209 |           0
      210 |           0
      211 |           0
      212 |           0
      213 |           0
      214 |           0
      215 |           0
      216 |           0
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |  .4047978   .3412554 
                         v(14) |  .0844317   .1699734 
                         v(13) |  .0697788   .1024102 
                         v(12) |  .0982417   .1216881 
                         v(11) |  .1403616   .1286375 
                         v(10) |  .1672311    .157694 
                          v(9) |  .2146131   .1502928 
                          v(8) |  .1532895   .1822095 
                          v(7) |  .1455853   .1478463 
                          v(6) |  .1973893   .2039524 
                          v(5) |  .1919794   .1979007 
                          v(4) |  .2065454   .1867196 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000h saved as .dta format
   2:      4.02 /        1 =       4.0180
Treatment Unit 4 out of 8
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 5
               Control Units: 1 2 3 4 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212 213 214 215 216
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27
                              28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  .7146167 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        1 |           0
        2 |           0
        3 |           0
        4 |        .189
        6 |           0
        7 |           0
        8 |        .031
        9 |           0
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |           0
       17 |           0
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |           0
       35 |           0
       36 |           0
       37 |           0
       38 |           0
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |           0
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |           0
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |           0
      117 |           0
      118 |           0
      119 |           0
      120 |           0
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |           0
      134 |           0
      135 |           0
      136 |           0
      137 |           0
      138 |           0
      139 |           0
      140 |           0
      141 |           0
      142 |           0
      143 |           0
      144 |           0
      145 |           0
      146 |           0
      147 |           0
      148 |           0
      149 |           0
      150 |           0
      151 |           0
      152 |           0
      153 |           0
      154 |           0
      155 |           0
      156 |        .045
      157 |           0
      158 |           0
      159 |           0
      160 |           0
      161 |           0
      162 |           0
      163 |           0
      164 |           0
      165 |           0
      166 |           0
      167 |           0
      168 |        .711
      169 |           0
      170 |           0
      171 |           0
      172 |           0
      173 |           0
      174 |           0
      175 |           0
      176 |           0
      177 |           0
      178 |           0
      179 |           0
      180 |           0
      181 |           0
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |           0
      187 |           0
      188 |           0
      189 |           0
      190 |           0
      191 |           0
      192 |           0
      193 |           0
      194 |        .009
      195 |        .007
      196 |           0
      197 |           0
      198 |           0
      199 |           0
      200 |           0
      201 |           0
      202 |        .009
      203 |           0
      204 |           0
      205 |           0
      206 |           0
      207 |           0
      208 |           0
      209 |           0
      210 |           0
      211 |           0
      212 |           0
      213 |           0
      214 |           0
      215 |           0
      216 |           0
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |  .4783339   .3963989 
                         v(14) |   .211405    .238153 
                         v(13) |   .147454   .1300716 
                         v(12) |  .1672449    .141698 
                         v(11) |  .3325602   .2687688 
                         v(10) |  .1789692   .1572352 
                          v(9) |  .2586436   .1964943 
                          v(8) |  .1885414   .1749205 
                          v(7) |  .2113999   .2085056 
                          v(6) |   .215875   .2067471 
                          v(5) |  .1261256   .1498463 
                          v(4) |  .1564565   .1453262 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000l saved as .dta format
   2:      4.01 /        1 =       4.0130
Treatment Unit 5 out of 8
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 6
               Control Units: 1 2 3 4 5 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212 213 214 215 216
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27
                              28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  1.055398 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        1 |           0
        2 |           0
        3 |           0
        4 |           0
        5 |           0
        7 |           0
        8 |           0
        9 |           0
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |           0
       17 |           0
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |           0
       35 |           0
       36 |           0
       37 |           0
       38 |           0
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |           0
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |           0
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |           0
      117 |           0
      118 |           0
      119 |        .011
      120 |           0
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |           0
      134 |           0
      135 |           0
      136 |           0
      137 |           0
      138 |           0
      139 |           0
      140 |           0
      141 |           0
      142 |           0
      143 |           0
      144 |           0
      145 |           0
      146 |           0
      147 |           0
      148 |           0
      149 |           0
      150 |           0
      151 |           0
      152 |           0
      153 |           0
      154 |           0
      155 |           0
      156 |        .051
      157 |           0
      158 |           0
      159 |           0
      160 |           0
      161 |           0
      162 |           0
      163 |           0
      164 |           0
      165 |           0
      166 |           0
      167 |           0
      168 |        .805
      169 |           0
      170 |           0
      171 |           0
      172 |           0
      173 |           0
      174 |           0
      175 |           0
      176 |           0
      177 |           0
      178 |           0
      179 |           0
      180 |           0
      181 |           0
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |           0
      187 |           0
      188 |           0
      189 |           0
      190 |        .126
      191 |           0
      192 |           0
      193 |           0
      194 |           0
      195 |           0
      196 |           0
      197 |           0
      198 |           0
      199 |           0
      200 |           0
      201 |           0
      202 |           0
      203 |           0
      204 |           0
      205 |           0
      206 |           0
      207 |           0
      208 |           0
      209 |           0
      210 |           0
      211 |           0
      212 |           0
      213 |           0
      214 |           0
      215 |           0
      216 |        .007
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |  .5074208   .7101222 
                         v(14) |  .2840171   .3821748 
                         v(13) |  .2069317   .2454913 
                         v(12) |  .3867778   .3074624 
                         v(11) |  .4095827   .3401296 
                         v(10) |  .1909545   .2854557 
                          v(9) |  .3073776   .3148167 
                          v(8) |  .3185285   .3395663 
                          v(7) |  .3398193   .3089378 
                          v(6) |   .207561   .3154861 
                          v(5) |  .3969206   .4139111 
                          v(4) |  .4527955   .3749417 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000p saved as .dta format
   2:      4.02 /        1 =       4.0170
Treatment Unit 6 out of 8
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 7
               Control Units: 1 2 3 4 5 6 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212 213 214 215 216
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27
                              28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  .6127652 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        1 |           0
        2 |           0
        3 |           0
        4 |           0
        5 |           0
        6 |           0
        8 |        .665
        9 |           0
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |           0
       17 |           0
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |           0
       35 |           0
       36 |           0
       37 |           0
       38 |           0
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |           0
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |           0
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |           0
      117 |           0
      118 |           0
      119 |           0
      120 |        .003
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |           0
      134 |           0
      135 |           0
      136 |           0
      137 |           0
      138 |           0
      139 |           0
      140 |           0
      141 |           0
      142 |           0
      143 |        .001
      144 |           0
      145 |           0
      146 |           0
      147 |           0
      148 |           0
      149 |           0
      150 |           0
      151 |           0
      152 |           0
      153 |           0
      154 |           0
      155 |           0
      156 |        .053
      157 |           0
      158 |           0
      159 |           0
      160 |           0
      161 |           0
      162 |           0
      163 |           0
      164 |           0
      165 |        .267
      166 |           0
      167 |           0
      168 |           0
      169 |           0
      170 |           0
      171 |           0
      172 |           0
      173 |        .011
      174 |           0
      175 |           0
      176 |           0
      177 |           0
      178 |           0
      179 |           0
      180 |           0
      181 |           0
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |           0
      187 |           0
      188 |           0
      189 |           0
      190 |           0
      191 |           0
      192 |           0
      193 |           0
      194 |           0
      195 |           0
      196 |           0
      197 |           0
      198 |           0
      199 |           0
      200 |           0
      201 |           0
      202 |           0
      203 |           0
      204 |           0
      205 |           0
      206 |           0
      207 |           0
      208 |           0
      209 |           0
      210 |           0
      211 |           0
      212 |           0
      213 |           0
      214 |           0
      215 |           0
      216 |           0
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |   .539538   .7704784 
                         v(14) |   .456399   .3820382 
                         v(13) |  .4787072   .4884851 
                         v(12) |  .5506516   .4901313 
                         v(11) |  .3776751   .4813626 
                         v(10) |  .6857554   .5587166 
                          v(9) |  .7138318   .5360738 
                          v(8) |  .5558244   .4828636 
                          v(7) |  .3781214   .3696151 
                          v(6) |  .4326169    .336314 
                          v(5) |  .2893786   .2803946 
                          v(4) |  .1072028    .225573 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000t saved as .dta format
   2:      3.99 /        1 =       3.9890
Treatment Unit 7 out of 8
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 8
               Control Units: 1 2 3 4 5 6 7 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212 213 214 215 216
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27
                              28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  .6616164 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        1 |           0
        2 |           0
        3 |           0
        4 |           0
        5 |           0
        6 |           0
        7 |        .338
        9 |           0
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |           0
       17 |           0
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |           0
       35 |           0
       36 |           0
       37 |           0
       38 |           0
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |           0
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |           0
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |           0
      117 |           0
      118 |           0
      119 |           0
      120 |           0
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |        .543
      134 |           0
      135 |           0
      136 |           0
      137 |           0
      138 |           0
      139 |           0
      140 |           0
      141 |           0
      142 |           0
      143 |           0
      144 |           0
      145 |           0
      146 |           0
      147 |           0
      148 |           0
      149 |           0
      150 |           0
      151 |           0
      152 |           0
      153 |           0
      154 |           0
      155 |        .012
      156 |           0
      157 |           0
      158 |           0
      159 |           0
      160 |           0
      161 |           0
      162 |           0
      163 |           0
      164 |           0
      165 |           0
      166 |           0
      167 |           0
      168 |        .096
      169 |           0
      170 |           0
      171 |           0
      172 |           0
      173 |           0
      174 |           0
      175 |           0
      176 |           0
      177 |           0
      178 |           0
      179 |           0
      180 |           0
      181 |           0
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |           0
      187 |           0
      188 |           0
      189 |           0
      190 |           0
      191 |           0
      192 |           0
      193 |           0
      194 |           0
      195 |           0
      196 |           0
      197 |           0
      198 |           0
      199 |           0
      200 |           0
      201 |           0
      202 |           0
      203 |           0
      204 |           0
      205 |           0
      206 |           0
      207 |        .011
      208 |           0
      209 |           0
      210 |           0
      211 |           0
      212 |           0
      213 |           0
      214 |           0
      215 |           0
      216 |           0
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |  .5564821   .7056615 
                         v(14) |  .4144545   .5059828 
                         v(13) |   .546211    .434904 
                         v(12) |  .3901868   .3350881 
                         v(11) |  .5164863   .2808688 
                         v(10) |  .4486512   .4155044 
                          v(9) |   .518269   .3884489 
                          v(8) |   .457593   .3816767 
                          v(7) |  .2835253   .2835169 
                          v(6) |  .2279567   .2658828 
                          v(5) |  .1448525   .2431112 
                          v(4) |  .1026818   .1481021 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000x saved as .dta format
   2:      4.00 /        1 =       4.0040
Treatment Unit 8 out of 8
   1:     32.67 /        1 =      32.6740
(33 observations deleted)
(264 real changes made)

  month_exp |      Freq.     Percent        Cum.
------------+-----------------------------------
        -12 |          8        3.03        3.03
        -11 |          8        3.03        6.06
        -10 |          8        3.03        9.09
         -9 |          8        3.03       12.12
         -8 |          8        3.03       15.15
         -7 |          8        3.03       18.18
         -6 |          8        3.03       21.21
         -5 |          8        3.03       24.24
         -4 |          8        3.03       27.27
         -3 |          8        3.03       30.30
         -2 |          8        3.03       33.33
         -1 |          8        3.03       36.36
          0 |          8        3.03       39.39
          1 |          8        3.03       42.42
          2 |          8        3.03       45.45
          3 |          8        3.03       48.48
          4 |          8        3.03       51.52
          5 |          8        3.03       54.55
          6 |          8        3.03       57.58
          7 |          8        3.03       60.61
          8 |          8        3.03       63.64
          9 |          8        3.03       66.67
         10 |          8        3.03       69.70
         11 |          8        3.03       72.73
         12 |          8        3.03       75.76
         13 |          8        3.03       78.79
         14 |          8        3.03       81.82
         15 |          8        3.03       84.85
         16 |          8        3.03       87.88
         17 |          8        3.03       90.91
         18 |          8        3.03       93.94
         19 |          8        3.03       96.97
         20 |          8        3.03      100.00
------------+-----------------------------------
      Total |        264      100.00

. save "${tem}/synth_treated_crf.dta", replace 
file 1_Data/Temp//synth_treated_crf.dta saved

. ********************************************************************************
. 
. 
. ********************************************************************************
. /// 2. Do the Synth Graph 
> use "${tem}/synth_treated_crf.dta", clear 

. global graphopts ytitle("Avg Intra-Week Std.Dev",size(small)) ylabel(#10, nogrid labsize(smal
> l) angle(0)) title(, size(small) pos(11) color(black)) plotregion(lcolor(black)) graphregion(
> margin(4 4 4 4)) plotregion(lcolor(black)) xtitle("", size(small)) xlabel(#27, nogrid labsize
> (small) angle(90)) legend(on order(1 "Observed Volatility" 2 "Synthetic Volatility") size(sma
> ll) rows(1)) yscale(titlegap(0))

. ********************************************************************************
. /// Show only the ATE window 
> keep if month_exp < ${tr_eff_window}
(48 observations deleted)

. merge m:1 month_exp using "${tem}/dates.dta", keep(match master) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                               216  
    -----------------------------------------

. qui sum mofd if month_exp == 0 

. local xline = r(mean)

. ********************************************************************************
. qui tab fileid 

. global rows = r(r)

. 
. local title1 "A (Below Median)"         

. local title2 "A (Above Median)"         

. local title3 "AA (Below Median)"                

. local title4 "AA (Above Median)"                

. local title5 "AAA (Below Median)"               

. local title6 "AAA (Above Median)"       

. local title7 "BBB (Below Median)"               

. local title8 "BBB (Above Median)"       

. 
. local lineopts lcolor(gray) lpattern(dash) lwidth(vthin)

. local lineopts1 lwidth(medthin) msize(vsmall)

. 
. forvalues i=1(1)$rows {
  2.     preserve 
  3.         qui keep if fileid == `i'
  4.         twoway (line treated mofd, lcolor(black) lpattern(solid) mcolor(black) msymbol(cir
> cle) `lineopts1') ///
>                 (line synth mofd, lcolor(cranberry) lpattern(dash) mcolor(cranberry) msymbol(
> square) `lineopts1'),  ///
>                 $graphopts title("`title`i''") name(gr`i',replace) xline(`xline' , `lineopts'
> ) yline(0 , `lineopts')
  5.         restore 
  6. }

. 
. global combopts xcommon ycommon rows(2) cols(2)

. grc1leg gr5 gr6 gr3 gr4, legendfrom(gr4) name(grcombrc1,replace) $combopts 

. grc1leg gr1 gr2 gr7 gr8, legendfrom(gr2) name(grcombrc2,replace) $combopts 

. 
. graph display grcombrc1, ysize(80) xsize(100) scale(.9)

. graph export "${oup}/Synth_Graph_cares1.pdf", $export 
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//Synth_Graph_cares1.pdf saved as PDF format

. 
. graph display grcombrc2, ysize(80) xsize(100) scale(.9)

. graph export "${oup}/Synth_Graph_cares2.pdf", $export 
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//Synth_Graph_cares2.pdf saved as PDF format

. ********************************************************************************
. 
. 
. 
. ********************************************************************************
. /// 3. Express placebos in units of the treated series 
> use "${cln}/synth_clean_crf.dta", clear 

. drop if month_exp <= 3
(648 observations deleted)

. //// 
> placebo_outcome_main
v_pre_mn:  (4,536 real changes made)
v_pre_sd:  (4,536 real changes made)
(59,904 real changes made)

  month_exp |      Freq.     Percent        Cum.
------------+-----------------------------------
        -15 |      1,664        2.78        2.78
        -14 |      1,664        2.78        5.56
        -13 |      1,664        2.78        8.33
        -12 |      1,664        2.78       11.11
        -11 |      1,664        2.78       13.89
        -10 |      1,664        2.78       16.67
         -9 |      1,664        2.78       19.44
         -8 |      1,664        2.78       22.22
         -7 |      1,664        2.78       25.00
         -6 |      1,664        2.78       27.78
         -5 |      1,664        2.78       30.56
         -4 |      1,664        2.78       33.33
         -3 |      1,664        2.78       36.11
         -2 |      1,664        2.78       38.89
         -1 |      1,664        2.78       41.67
          0 |      1,664        2.78       44.44
          1 |      1,664        2.78       47.22
          2 |      1,664        2.78       50.00
          3 |      1,664        2.78       52.78
          4 |      1,664        2.78       55.56
          5 |      1,664        2.78       58.33
          6 |      1,664        2.78       61.11
          7 |      1,664        2.78       63.89
          8 |      1,664        2.78       66.67
          9 |      1,664        2.78       69.44
         10 |      1,664        2.78       72.22
         11 |      1,664        2.78       75.00
         12 |      1,664        2.78       77.78
         13 |      1,664        2.78       80.56
         14 |      1,664        2.78       83.33
         15 |      1,664        2.78       86.11
         16 |      1,664        2.78       88.89
         17 |      1,664        2.78       91.67
         18 |      1,664        2.78       94.44
         19 |      1,664        2.78       97.22
         20 |      1,664        2.78      100.00
------------+-----------------------------------
      Total |     59,904      100.00

. save "${tem}/synth_placebos_crf.dta", replace 
file 1_Data/Temp//synth_placebos_crf.dta saved

. ********************************************************************************
. 
. ********************************************************************************
. /// 4. Identify the placebos that pass the cohen-d criterion 
> use "${tem}/synth_placebos_crf.dta", clear 

. merge m:1 id using "${tem}/placebosforinferencerce_main.dta", keep(match master) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                            59,904  
    -----------------------------------------

. keep if survival == 1
(9,504 observations deleted)

. /// Save data 
> save "${tem}/placeboempiricaldistribution_crf.dta", replace
file 1_Data/Temp//placeboempiricaldistribution_crf.dta saved

. ********************************************************************************
.  
.  
. /// 5. ATE and Pvalues 
> use "${tem}/synth_treated_crf.dta", clear 

. tab fileid

     fileid |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         33       12.50       12.50
          2 |         33       12.50       25.00
          3 |         33       12.50       37.50
          4 |         33       12.50       50.00
          5 |         33       12.50       62.50
          6 |         33       12.50       75.00
          7 |         33       12.50       87.50
          8 |         33       12.50      100.00
------------+-----------------------------------
      Total |        264      100.00

. global cols = r(r)

. display $cols
8

. 
. local title1 "A (Below Median)"         

. local title2 "A (Above Median)"         

. local title3 "AA (Below Median)"                

. local title4 "AA (Above Median)"                

. local title5 "AAA (Below Median)"               

. local title6 "AAA (Above Median)"       

. local title7 "BBB (Below Median)"               

. local title8 "BBB (Above Median)"       

. 
. matrix define R=J(12,$cols,.)

. matrix colnames R = "A (Below Median)"  "A (Above Median)" "AA (Below Median)" "AA (Above Med
> ian)" "AAA (Below Median)" "AAA (Above Median)" "BBB (Below Median)" "BBB (Above Median)" 

. matrix rownames R = "ate" "se" "ci_min" "ci_max"  "pval2" "pval1" "vol_pre" "vol_treat" "exce
> ss_vol" "ate_excess_vol" "rmspe" "id"

. matlist R 

             | A (Belo~)  A (Abov~)  AA (Bel~)  AA (Abo~)  AAA (Be~)  AAA (Ab~)  BBB (Be~) 
-------------+-----------------------------------------------------------------------------
         ate |         .          .          .          .          .          .          . 
          se |         .          .          .          .          .          .          . 
      ci_min |         .          .          .          .          .          .          . 
      ci_max |         .          .          .          .          .          .          . 
       pval2 |         .          .          .          .          .          .          . 
       pval1 |         .          .          .          .          .          .          . 
     vol_pre |         .          .          .          .          .          .          . 
   vol_treat |         .          .          .          .          .          .          . 
  excess_vol |         .          .          .          .          .          .          . 
ate_excess~l |         .          .          .          .          .          .          . 
       rmspe |         .          .          .          .          .          .          . 
          id |         .          .          .          .          .          .          . 

             | BBB (Ab~) 
-------------+----------
         ate |         . 
          se |         . 
      ci_min |         . 
      ci_max |         . 
       pval2 |         . 
       pval1 |         . 
     vol_pre |         . 
   vol_treat |         . 
  excess_vol |         . 
ate_excess~l |         . 
       rmspe |         . 
          id |         . 

. 
. /// Loop to compute the ATE for each treated unit 
> forvalues j = 1(1)$cols { 
  2.         //// 1.- Store All Treated Unit Characteristics 
> 
.         qui use "${tem}/synth_treated_crf.dta", clear
  3.         egen group = group(id fileid)
  4.         qui drop ate tr_eff
  5.         /// Estimate Treatment Effect Using Treated and Synthetic Series (Adjusted for the
> ir own mean and standard deviation) 
>         bysort group: gen tr_eff = treat_lev - synth_lev
  6.         bysort group: egen ate = mean(tr_eff) if month_exp >=0 & month_exp <= ${tr_eff_win
> dow}
  7.         /// Pre-Measures in Volatility 
>         /// Keep only instrument `j' and donors 
>         qui keep if fileid == `j'
  8.         /// Average Treatment Effect 
>         qui sum ate 
  9.         global ate = r(mean)
 10.         mat R[1,`j'] = $ate
 11.         /// ATE in absolute value (to compute ATE in percent of Excess Volatility)
>         local absate = abs($ate)
 12.         /// Volatility Pre-Treatment Period: Average Volatility Observed in the Pre-Treatm
> ent Period 
>         qui sum treat_lev if month_exp < -1
 13.         local vol_pre = r(mean)
 14.         mat R[7,`j'] = `vol_pre'
 15.         /// Volatility Observed in March 2020: Spike due to COVID 
>         qui sum treat_lev if month_exp == -1
 16.         local vol_treat = r(mean)
 17.         mat R[8,`j'] = `vol_treat'
 18.         /// Compute Excess Volatility: Difference in Average Volatility and Volatility Dur
> ing the Pandemic 
>         local excess_vol = `vol_treat' - `vol_pre'
 19.         mat R[9,`j'] = `excess_vol'
 20.         /// ATE in Terms of Excess Volatility 
>         local ate_excess_vol = 100*(`absate'/`excess_vol')
 21.         mat R[10,`j'] = `ate_excess_vol'
 22.         /// RMSE 
>         qui sum rmse 
 23.         mat R[11,`j'] = r(mean)
 24.         /// Id
>         qui sum id 
 25.         mat R[12,`j'] = r(mean)
 26. 
.         
.         /// 2.- Count How Many times the ATE for the treated unit exceeds the ATE at the plac
> ebo empirical distribution 
>         *preserve 
.         qui use "${tem}/placeboempiricaldistribution_crf.dta" , clear 
 27.         /// Estimate the Average Treatment Effect for the specific window 
>                 qui egen group = group(id fileid)
 28.         qui drop ate
 29.         bysort group: egen ate = mean(tr_eff) if month_exp >=0 & month_exp <= ${tr_eff_win
> dow}
 30.         qui gcollapse (mean) ate, by(id fileid group)
 31.         /// keep only the empirical distribution of state j
>         qui keep if fileid == `j'
 32.         /// Standard Error 
>         qui sum ate 
 33.         local se = r(sd)
 34.         mat R[2,`j'] = `se'
 35.         /// Hypothesis Testing and P Values 
>         qui cumul ate, gen(cdf)
 36.         qui gsort cdf
 37.         /// Hypothesis Testing and P Values 
>         _pctile ate, percentiles(2.5 97.5)
 38.         mat R[3,`j'] = r(r1)
 39.         mat R[4,`j'] = r(r2)
 40.         /// Cavallo Permutation Test Approach: Left-sided one-tail test. 
>         /// Hypothesis: negative coefficient, hence the left-test. 
>         /// Left-sided test: count how many times the placebos are more negative than the tre
> atment effect. 
>         /// (Inutition: p-val = 0 implies the ATE is more negative than all the placebos, ie:
>  is smaller in all cases). 
>         /// The p-value is the number of time the ATE is larger than the placebo estimates. 
>         qui gen pcount = ate < $ate 
 41.         /// p-value 
>         sum pcount 
 42.     local pval1 = round(r(mean),0.001)
 43.         mat R[5,`j'] = `pval1'
 44.         
.         /// Two Tail Test 
>         qui drop pcount 
 45.         qui gen atetreat = abs($ate)
 46.         qui gen absate = abs(ate)
 47.         /// count how many times the 
>         qui gen pcount = absate < atetreat
 48.         qui sum pcount
 49.         local pval2= round(r(mean),0.001)
 50.         mat R[6,`j'] = `pval2'
 51.         
.         /// Percentiles for lines in density plot
>         cap drop ate_cdf
 52.         qui cumul ate, gen(ate_cdf)
 53.         /// Percentile 2.5% 
>         sum ate if ate_cdf <= 0.025
 54.         local p025 = r(max)
 55.         /// Percentile 5.0% 
>         sum ate if ate_cdf <= 0.05
 56.         local p050 = r(max)     
 57.         /// Percentile 95.0% 
>         sum ate if ate_cdf <= 0.95
 58.         local p950 = r(max)
 59.         /// Percentile 97.5% 
>         sum ate if ate_cdf <= 0.975
 60.         local p975 = r(max)
 61.         
.         /// ATE's Empirical Distribution - 
>         local density_opts recast(line) lcolor(black) lwidth(medthin) lpattern(solid) xline($
> ate, lcolor(maroon) lpattern(longdash)) xtitle("ATE Estimate") ytitle("Density") xlabel(#10, 
> angle(0) labsize(small)) ylabel(#10, angle(0) labsize(small)) xscale(range(0 $ate)) legend(of
> f) yscale(titlegap(0))
 62.         /// Percentiles plot
>         local line1 lcolor(ebblue) lpattern(shortdash) lwidth(medthin)
 63.         local line2 lcolor(eltblue) lpattern(longdash) lwidth(medthin)
 64.         local percentile_lines xline(`p050', `line1') 
 65.         *xline(`p050', `line2') xline(`p950', `line2')
. 
.         qui kdensity ate, `density_opts' title("`title`j'': Left Tail Test p-value = `pval1'"
> , pos(11) size(small))  name(ate_dens`j',replace) `percentile_lines'
 66.         
. }
(136 missing values generated)
(28,000 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        175    .9257143    .2629878          0          1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.1542742    .0254486  -.1737524  -.1171347

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8   -.1283683     .032714  -.1737524  -.0963139

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        166   -.0099552    .0369152  -.1737524    .070111

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        170   -.0075387    .0396942  -.1737524   .1006157
(136 missing values generated)
(28,000 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        175           0           0          0          0

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.1335279    .0220264  -.1503868  -.1013828

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8   -.1111057    .0283147  -.1503868   -.083362

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        166   -.0086165     .031951  -.1503868   .0606827

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        170   -.0065249    .0343563  -.1503868   .0870852
(136 missing values generated)
(28,000 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        175           0           0          0          0

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.1272626    .0209929  -.1433305  -.0966258

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8   -.1058925    .0269861  -.1433305  -.0794505

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        166   -.0082122    .0304518  -.1433305   .0578354

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        170   -.0062188    .0327442  -.1433305   .0829991
(136 missing values generated)
(28,000 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        175    .5828571    .4945018          0          1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.1106513    .0182527  -.1246218  -.0840134

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8   -.0920706    .0234637  -.1246218    -.06908

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        166   -.0071403     .026477  -.1246218   .0502863

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        170    -.005407    .0284702  -.1246218   .0721654
(136 missing values generated)
(28,000 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        175           0           0          0          0

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.1235392    .0203787  -.1391369  -.0937988

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8   -.1027943    .0261966  -.1391369   -.077126

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        166   -.0079719    .0295609  -.1391369   .0561433

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        170   -.0060368    .0317862  -.1391369   .0805707
(136 missing values generated)
(28,000 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        175           0           0          0          0

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.1282795    .0211606  -.1444758  -.0973979

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8   -.1067387    .0272018  -.1444758  -.0800854

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        166   -.0082778    .0306952  -.1444758   .0582976

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        170   -.0062685    .0330059  -.1444758   .0836623
(136 missing values generated)
(28,000 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        175    .9942857    .0755929          0          1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.2117441    .0349287  -.2384784  -.1607696

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8   -.1761878    .0449005  -.2384784  -.1321926

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        166   -.0136637    .0506669  -.2384784   .0962287

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        170    -.010347     .054481  -.2384784   .1380969
(136 missing values generated)
(28,000 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        175    .0914286    .2890446          0          1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.1996289    .0329302  -.2248335  -.1515709

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8    -.166107    .0423315  -.2248335   -.124629

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        166   -.0128819    .0477679  -.2248335   .0907228

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        170    -.009755    .0513638  -.2248335   .1301955

. 
. global combopts xcommon ycommon rows(2) cols(2)

. graph combine ate_dens5 ate_dens6 ate_dens3 ate_dens4, name(atedenscomb1,replace) $combopts 

. graph combine ate_dens1 ate_dens2 ate_dens7 ate_dens8, name(atedenscomb2,replace) $combopts 

. 
. graph display atedenscomb1, ysize(80) xsize(100) scale(.9)

. graph export "${oup}/ate_dens_cares1.pdf", $export 
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//ate_dens_cares1.pdf saved as PDF format

. 
. graph display atedenscomb2, ysize(80) xsize(100) scale(.9)

. graph export "${oup}/ate_dens_cares2.pdf", $export 
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//ate_dens_cares2.pdf saved as PDF format

. 
. 
. ********************************************************************************
. 
. 
. ********************************************************************************
. //// 5.1. Create Main Results Table 
> /// Results as a transpose 
> matrix define M = R'

. /// Clear the environment 
> clear 

. svmat M
number of observations will be reset to 8
Press any key to continue, or Break to abort
Number of observations (_N) was 0, now 8.

. format M* %12.4fc

. replace M5 = 0 if M5 == . 
(0 real changes made)

. replace M6 = 0 if M6 == . 
(0 real changes made)

. /// Drop ate excess volatility if the effect is not interpretab;e 
> replace M10 = . if M10 < -1000 | M10 > 1000
(0 real changes made)

. /// Statistical Significance: Left-sided test  
> qui gen stars = "" 

. qui replace stars = "*" if M5 < 0.01

. qui replace stars = "**" if M5 < 0.005 

. qui replace stars = "***" if M5 < 0.001

. /// Format Variables 
> qui tostring M1, gen(ate) force format(%12.4fc)

. qui tostring M2, gen(se) force format(%12.4fc)

. qui tostring M3, gen(ci_min) force format(%12.4fc)

. qui tostring M4, gen(ci_max) force format(%12.4fc)

. qui tostring M5, gen(pval1) force format(%12.4fc)

. qui tostring M6, gen(pval2) force format(%12.4fc)

. qui tostring M7, gen(vol_pre) force format(%12.4fc)

. qui tostring M8, gen(vol_treat) force format(%12.4fc)

. qui tostring M9, gen(excess_vol) force format(%12.4fc)

. qui tostring M10, gen(ate_excess_vol) force format(%12.4fc)

. qui tostring M11, gen(rmspe) force format(%12.4fc)

. qui replace ate_excess_vol = ate_excess_vol + "\%"

. qui replace ate_excess_vol = "NA" if ate_excess_vol == ".\%"

. qui replace se = "(" + se + ")"

. qui replace ate = ate + stars

. qui gen cint = "(" + ci_min + "," + ci_max + ")"

. 
. qui gen id = _n

. qui rename (ate se cint vol_pre vol_treat excess_vol ate_excess_vol pval1 pval2 rmspe) (b1 b2
>  b3 b4 b5 b6 b7 b8 b9 b10)

. qui keep id b*

. qui reshape long b, i(id) j(vars) string

. qui destring vars, gen(id1)

. qui drop vars 

. qui reshape wide b, i(id1) j(id)  

. qui gen names = ""

. qui replace names = "Average Treatment Effect (a)" if _n == 1

. qui replace names = "SE" if _n == 2

. qui replace names = "Conf Interval" if _n == 3

. qui replace names = "Historic Volatility (b)" if _n == 4

. qui replace names = "Volatility March 2020 (c)" if _n == 5

. qui replace names = "Excess Volatility (d = c - b)" if _n == 6

. qui replace names = "ATE, % Excess Volatility (e = d/a)" if _n == 7

. qui replace names = "P-Value (Left Tail)" if _n == 8

. qui replace names = "P-Value (Two Tails)" if _n == 9

. qui replace names = "RMSPE" if _n == 10

. qui drop id1

. label variable b1 "A (Below Median)"            

. label variable b2 "A (Above Median)"            

. label variable b3 "AA (Below Median)"           

. label variable b4 "AA (Above Median)"           

. label variable b5 "AAA (Below Median)"          

. label variable b6 "AAA (Above Median)"  

. label variable b7 "BBB (Below Median)"          

. label variable b8 "BBB (Above Median)"  

. rename names Results 

. order Results b5 b6 b3 b4 b1 b2 b7 b8

. 
. list  

     +---------------------------------------------------------------------------+
  1. |                            Results |               b5 |               b6  |
     |       Average Treatment Effect (a) |       -0.1858*** |       -0.2428***  |
     |---------------------------------------------------------------------------|
     |               b3 |               b4 |               b1 |               b2 |
     |       -0.1697*** |           0.0006 |           0.0462 |       -0.1921*** |
     |-------------------------------------+-------------------------------------|
     |                        b7           |                        b8           |
     |                    0.4337           |                   -0.0578           |
     +---------------------------------------------------------------------------+

     +---------------------------------------------------------------------------+
  2. |                            Results |               b5 |               b6  |
     |                                 SE |         (0.0499) |         (0.0518)  |
     |---------------------------------------------------------------------------|
     |               b3 |               b4 |               b1 |               b2 |
     |         (0.0514) |         (0.0447) |         (0.0623) |         (0.0539) |
     |-------------------------------------+-------------------------------------|
     |                        b7           |                        b8           |
     |                  (0.0855)           |                  (0.0806)           |
     +---------------------------------------------------------------------------+

     +---------------------------------------------------------------------------+
  3. |                            Results |               b5 |               b6  |
     |                      Conf Interval | (-0.0904,0.1257) | (-0.0938,0.1305)  |
     |---------------------------------------------------------------------------|
     |               b3 |               b4 |               b1 |               b2 |
     | (-0.0931,0.1295) | (-0.0809,0.1126) | (-0.1128,0.1570) | (-0.0977,0.1359) |
     |-------------------------------------+-------------------------------------|
     |                        b7           |                        b8           |
     |          (-0.1549,0.2155)           |          (-0.1460,0.2031)           |
     +---------------------------------------------------------------------------+

     +---------------------------------------------------------------------------+
  4. |                            Results |               b5 |               b6  |
     |            Historic Volatility (b) |           0.1995 |           0.3183  |
     |---------------------------------------------------------------------------|
     |               b3 |               b4 |               b1 |               b2 |
     |           0.1676 |           0.1518 |           0.2224 |           0.2393 |
     |-------------------------------------+-------------------------------------|
     |                        b7           |                        b8           |
     |                    0.4569           |                    0.3683           |
     +---------------------------------------------------------------------------+

     +---------------------------------------------------------------------------+
  5. |                            Results |               b5 |               b6  |
     |          Volatility March 2020 (c) |           0.4783 |           0.5074  |
     |---------------------------------------------------------------------------|
     |               b3 |               b4 |               b1 |               b2 |
     |           0.4355 |           0.4048 |           0.6065 |           0.4761 |
     |-------------------------------------+-------------------------------------|
     |                        b7           |                        b8           |
     |                    0.5395           |                    0.5565           |
     +---------------------------------------------------------------------------+

     +---------------------------------------------------------------------------+
  6. |                            Results |               b5 |               b6  |
     |      Excess Volatility (d = c - b) |           0.2788 |           0.1891  |
     |---------------------------------------------------------------------------|
     |               b3 |               b4 |               b1 |               b2 |
     |           0.2678 |           0.2530 |           0.3841 |           0.2369 |
     |-------------------------------------+-------------------------------------|
     |                        b7           |                        b8           |
     |                    0.0826           |                    0.1882           |
     +---------------------------------------------------------------------------+

     +---------------------------------------------------------------------------+
  7. |                            Results |               b5 |               b6  |
     | ATE, % Excess Volatility (e = d/a) |        66.6290\% |       128.3999\%  |
     |---------------------------------------------------------------------------|
     |               b3 |               b4 |               b1 |               b2 |
     |        63.3718\% |         0.2569\% |        12.0388\% |        81.0983\% |
     |-------------------------------------+-------------------------------------|
     |                        b7           |                        b8           |
     |                525.0154\%           |                 30.7029\%           |
     +---------------------------------------------------------------------------+

     +---------------------------------------------------------------------------+
  8. |                            Results |               b5 |               b6  |
     |                P-Value (Left Tail) |           0.0000 |           0.0000  |
     |---------------------------------------------------------------------------|
     |               b3 |               b4 |               b1 |               b2 |
     |           0.0000 |           0.5830 |           0.9260 |           0.0000 |
     |-------------------------------------+-------------------------------------|
     |                        b7           |                        b8           |
     |                    0.9940           |                    0.0910           |
     +---------------------------------------------------------------------------+

     +---------------------------------------------------------------------------+
  9. |                            Results |               b5 |               b6  |
     |                P-Value (Two Tails) |           0.9940 |           0.9940  |
     |---------------------------------------------------------------------------|
     |               b3 |               b4 |               b1 |               b2 |
     |           0.9890 |           0.0400 |           0.8340 |           0.9890 |
     |-------------------------------------+-------------------------------------|
     |                        b7           |                        b8           |
     |                    0.9940           |                    0.8340           |
     +---------------------------------------------------------------------------+

     +---------------------------------------------------------------------------+
 10. |                            Results |               b5 |               b6  |
     |                              RMSPE |           0.0015 |           0.0076  |
     |---------------------------------------------------------------------------|
     |               b3 |               b4 |               b1 |               b2 |
     |           0.0042 |           0.0016 |           0.0005 |           0.0027 |
     |-------------------------------------+-------------------------------------|
     |                        b7           |                        b8           |
     |                    0.0125           |                    0.0115           |
     +---------------------------------------------------------------------------+

. save "${tem}/ATE_Results_Full_cares.dta", replace 
file 1_Data/Temp//ATE_Results_Full_cares.dta saved

. 
. /// Export Tables 
> drop if Results == "Conf Interval" | Results == "P-Value (One Tail)" | Results == "P-Value (T
> wo Tails)" 
(2 observations deleted)

. replace Results = "" if Results == "SE"
(1 real change made)

. list 

     +--------------------------------------------------------------------------------------+
  1. |                            Results |         b5 |         b6 |         b3 |       b4 |
     |       Average Treatment Effect (a) | -0.1858*** | -0.2428*** | -0.1697*** |   0.0006 |
     |--------------------------------------------------------------------------------------|
     |            b1      |             b2      |             b7      |             b8      |
     |        0.0462      |     -0.1921***      |         0.4337      |        -0.0578      |
     +--------------------------------------------------------------------------------------+

     +--------------------------------------------------------------------------------------+
  2. |                            Results |         b5 |         b6 |         b3 |       b4 |
     |                                    |   (0.0499) |   (0.0518) |   (0.0514) | (0.0447) |
     |--------------------------------------------------------------------------------------|
     |            b1      |             b2      |             b7      |             b8      |
     |      (0.0623)      |       (0.0539)      |       (0.0855)      |       (0.0806)      |
     +--------------------------------------------------------------------------------------+

     +--------------------------------------------------------------------------------------+
  3. |                            Results |         b5 |         b6 |         b3 |       b4 |
     |            Historic Volatility (b) |     0.1995 |     0.3183 |     0.1676 |   0.1518 |
     |--------------------------------------------------------------------------------------|
     |            b1      |             b2      |             b7      |             b8      |
     |        0.2224      |         0.2393      |         0.4569      |         0.3683      |
     +--------------------------------------------------------------------------------------+

     +--------------------------------------------------------------------------------------+
  4. |                            Results |         b5 |         b6 |         b3 |       b4 |
     |          Volatility March 2020 (c) |     0.4783 |     0.5074 |     0.4355 |   0.4048 |
     |--------------------------------------------------------------------------------------|
     |            b1      |             b2      |             b7      |             b8      |
     |        0.6065      |         0.4761      |         0.5395      |         0.5565      |
     +--------------------------------------------------------------------------------------+

     +--------------------------------------------------------------------------------------+
  5. |                            Results |         b5 |         b6 |         b3 |       b4 |
     |      Excess Volatility (d = c - b) |     0.2788 |     0.1891 |     0.2678 |   0.2530 |
     |--------------------------------------------------------------------------------------|
     |            b1      |             b2      |             b7      |             b8      |
     |        0.3841      |         0.2369      |         0.0826      |         0.1882      |
     +--------------------------------------------------------------------------------------+

     +--------------------------------------------------------------------------------------+
  6. |                            Results |         b5 |         b6 |         b3 |       b4 |
     | ATE, % Excess Volatility (e = d/a) |  66.6290\% | 128.3999\% |  63.3718\% | 0.2569\% |
     |--------------------------------------------------------------------------------------|
     |            b1      |             b2      |             b7      |             b8      |
     |     12.0388\%      |      81.0983\%      |     525.0154\%      |      30.7029\%      |
     +--------------------------------------------------------------------------------------+

     +--------------------------------------------------------------------------------------+
  7. |                            Results |         b5 |         b6 |         b3 |       b4 |
     |                P-Value (Left Tail) |     0.0000 |     0.0000 |     0.0000 |   0.5830 |
     |--------------------------------------------------------------------------------------|
     |            b1      |             b2      |             b7      |             b8      |
     |        0.9260      |         0.0000      |         0.9940      |         0.0910      |
     +--------------------------------------------------------------------------------------+

     +--------------------------------------------------------------------------------------+
  8. |                            Results |         b5 |         b6 |         b3 |       b4 |
     |                              RMSPE |     0.0015 |     0.0076 |     0.0042 |   0.0016 |
     |--------------------------------------------------------------------------------------|
     |            b1      |             b2      |             b7      |             b8      |
     |        0.0005      |         0.0027      |         0.0125      |         0.0115      |
     +--------------------------------------------------------------------------------------+

. texsave * using "${oup}/ATE_Results_cares.tex", replace  decimalalign nofix 

. ********************************************************************************
. 
. 
. 
. ********************************************************************************
. /// 6. Smokeplots 
> use "${tem}/synth_treated_crf.dta", clear 

. qui gen treat = 1 

. append using "${tem}/placeboempiricaldistribution_crf.dta", force  

. qui replace treat = 0 if treat == . 

. *drop if fileid >= 6 
. tab fileid, matrow(F)

     fileid |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      6,333       12.50       12.50
          2 |      6,333       12.50       25.00
          3 |      6,333       12.50       37.50
          4 |      6,333       12.50       50.00
          5 |      6,333       12.50       62.50
          6 |      6,333       12.50       75.00
          7 |      6,333       12.50       87.50
          8 |      6,333       12.50      100.00
------------+-----------------------------------
      Total |     50,664      100.00

. global rows = r(r)

. 
. ********************************************************************************
. /// Show only the ATE window 
> keep if month_exp < ${tr_eff_window}
(8,448 observations deleted)

. ********************************************************************************
. 
. local title1 "A (Below Median)"         

. local title2 "A (Above Median)"         

. local title3 "AA (Below Median)"                

. local title4 "AA (Above Median)"                

. local title5 "AAA (Below Median)"               

. local title6 "AAA (Above Median)"       

. local title7 "BBB (Below Median)"               

. local title8 "BBB (Above Median)"       

. global smoke_options ytitle("Treatment Effect", size(vsmall)) ylabel(#18, nogrid labsize(vsma
> ll) angle(0)) xtitle("", size(vsmall)) xlabel(#30, labsize(vsmall) angle(90) nogrid) title(, 
> size(small) pos(11) color(black)) xsca(titlegap(*-.5)) ysca(titlegap(-5)) plotregion(lcolor()
> ) legend(on order(1 "CI (SmokeArea)" 2 "Treatment Effect") rows(1) size(small)) plotregion(co
> lor()) graphregion(color() margin(4 4 4 4)) plotregion(lcolor(black)) 

. 
. /// For Each Treated Unit 
> forvalues j=1(1)$rows {
  2. 
. preserve        
  3. use "${tem}/ATE_Results_Full_cares.dta", clear
  4. qui replace b`j' = subinstr(b`j', "\", "", .)
  5. 
. local ate = b`j'[1]
  6. local pval = b`j'[8]
  7. local excess_vol = b`j'[7]
  8. local rmspe = b`j'[10]
  9. restore 
 10. 
. preserve
 11. qui keep if fileid == `j'
 12. sort id month_exp
 13. 
. /// Create Percentile Variables 
> gen p1 = . 
 14. gen p2 = . 
 15. gen p5 = . 
 16. gen p95 = . 
 17. gen p97 = . 
 18. gen p99 = . 
 19. 
. /// Create Percentile Variables For each Experiment Month. So, for any period it will compute
>  the percentiles at such period across all donor units, to then save it with the treated unit
> s. 
> forvalues t= -15(1)20 {
 20.         _pctile tr_eff if month_exp == `t' & treat == 0, percentiles(1 2.5 5 95 97.5 99)
 21.         qui replace p1 = r(r1) if month_exp == `t' & treat == 1
 22.         qui replace p2 = r(r2) if month_exp == `t' & treat == 1
 23.         qui replace p5 = r(r3) if month_exp == `t' & treat == 1
 24.         qui replace p95 = r(r4) if month_exp == `t' & treat == 1
 25.         qui replace p97 = r(r5) if month_exp == `t' & treat == 1 
 26.         qui replace p99 = r(r6) if month_exp == `t' & treat == 1
 27. }
 28. /// Keep treated and do the graph 
> keep if treat == 1
 29. merge 1:1 month_exp using "${tem}/dates.dta", keep(match master) nogen
 30. qui sum mofd if month_exp == 0 
 31. local xline = r(mean)
 32. global smoke_options ytitle("Treatment Effect", size(vsmall)) ylabel(#8, nogrid labsize(vs
> mall) angle(0)) xtitle("", size(vsmall)) xlabel(#16, labsize(vsmall) angle(90) nogrid) title(
> , size(small) pos(11) color(black)) xsca(titlegap(*-.5)) ysca(titlegap(*-3)) plotregion(lcolo
> r()) legend(on order(1 "CI (SmokeArea)" 2 "Treatment Effect") rows(1) size(small)) plotregion
> (color()) graphregion(color() margin(4 4 4 4)) plotregion(lcolor(black)) 
 33. local lineopts lcolor(gray) lpattern(dash) lwidth(vthin)
 34. 
. twoway (rarea p1 p99 mofd,     fc(gs13%40) lc(gs15%40) lw(medthick)) ///
>                 (rarea p2 p97 mofd, fc(gs10%40) lc(gs12%40) lw(medthick)) ///   
>                 (rarea p5 p95 mofd,      fc(gs7%40)  lc(gs9%40) lw(medthick))   ///
>                 (connected tr_eff mofd, sort lcolor(maroon) lpattern(solid) mcolor(maroon) ms
> ize(vsmall) msymbol(circle)), ///
>                 xline(`xline' , `lineopts') yline(0 , `lineopts') $smoke_options name(sm`j', 
> replace) title("`title`j''", size(small) pos(11)) legend(order(- 1 5) note("ATE = `ate'" "p-v
> alue = `pval'" "RMSPE = `rmspe'" "ATE (% Excess Volatility) = `excess_vol'", pos(11) size(vsm
> all)) label(1 "90/95/99 C.I.") pos(11) ring(0) cols(1) size(tiny) region(lstyle(none) fcolor(
> none)))
 35. restore 
 36. }
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,250 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                27  
    -----------------------------------------
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,250 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                27  
    -----------------------------------------
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,250 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                27  
    -----------------------------------------
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,250 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                27  
    -----------------------------------------
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,250 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                27  
    -----------------------------------------
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,250 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                27  
    -----------------------------------------
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,250 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                27  
    -----------------------------------------
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
(5,277 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,250 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                27  
    -----------------------------------------

. 
. 
. graph combine sm5 sm6 sm3 sm4, name(smcomb1,replace) $combopts 

. graph combine sm1 sm2 sm7 sm8, name(smcomb2,replace) $combopts 

. 
. graph display smcomb1, ysize(80) xsize(100) scale(.9)

. graph export "${oup}/smoke_cares1.pdf", $export 
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//smoke_cares1.pdf saved as PDF format

. 
. graph display smcomb2, ysize(80) xsize(100) scale(.9)

. graph export "${oup}/smoke_cares2.pdf", $export 
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//smoke_cares2.pdf saved as PDF format

. 
. 
. 
. 
. 
. 
end of do-file

. /// Robustness Check for the Credit Rating Categorization 
> /// 4) Estimate the placebos for the robustness check 
> /// Change the specification of the model
> global predictors v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4) v(3) v(2)
>  v(1)

. do "${cod}/code_analysis/4_PlacebosForRC.do"

. *************************************************************************
. *************************************************************************
. /// Project: Volatility in the Municipal Bond Market and the MLF
> /// Authors: Felipe Lozano & Luis Navarro
> /// Code: Luis Navarro 
> /// Update: February 2024
> /// Script: Estimate Placebos for RC model (add first 3 months of the pre-treat period)
> *************************************************************************
. *************************************************************************
. //// Estimation of the Placebos 
> timer on 1

. cap log using "${tem}/LogPlacebos_rc.log"

. qui use "${cln}/synth_clean.dta", clear 

. sort id year_exp month_exp

. qui gegen v_pre_mn = mean(v) if month_exp < ${treat_period}, by(id)

. bysort id: carryforward         v_pre_mn, replace   
v_pre_mn:  (4,452 real changes made)

. /// Standard Deviation of each instrument in the Pre-treatment Period
> qui gegen v_pre_sd = sd(v) if month_exp < ${treat_period}, by(id)

. bysort id: carryforward         v_pre_sd, replace
v_pre_sd:  (4,452 real changes made)

. /// Normalized Variables
> gen v_norm = (v - v_pre_mn) / v_pre_sd

. qui tsset id month_exp

. 
. //// For Loop To estimate the Placebos 
> qui tab id if treat==0

. global don = r(r)

. /// For loop 
> forvalues i = 1(1)$don  {
  2. preserve
  3. timer on 2 
  4. // Drop Treated Units: Placebos are Estimated Only in the Donor Pool            
. qui drop if treat == 1
  5. qui tab id if treat==0, matrow(C)
  6. qui global t_id = C[`i',1]
  7. qui tempfile scm_placebo`i'
  8. *** To ensure compatibility, the global levels (i.e. the lags used as predictors) is defin
> ed in the synth do file. 
. qui synth v_norm ${predictors}, trunit(${t_id}) trperiod(${treat_period}) keep(`scm_placebo`i
> '')
  9. /// Store the Results: Goodness of Fit 
> matrix define RMSPE`i' = e(RMSPE)
 10. mat Y=e(X_balance)
 11. mat Yt=Y[1...,1]
 12. mat Yc=Y[1...,2]
 13. mat rmse1=(Yt-Yc)'*(Yt-Yc)
 14. mat rmse1=rmse1/`=rowsof(Yt)'
 15. /// Cohen's D statistic  
> qui svmat Y 
 16. qui sum Y1 
 17. qui global sdpre = r(sd)
 18. qui gen absdf = abs((Y1 - Y2)/$sdpre ) 
 19. qui sum absdf 
 20. qui global cohend = r(mean)
 21. qui drop Y1 Y2 absdf 
 22. qui use `scm_placebo`i'', clear
 23. qui rename (_Y_treated _Y_synthetic _time) (treated synth month_exp)
 24. qui drop if month_exp == . 
 25. qui keep treat synth month_exp 
 26. /// Save RMSE 
> qui gen rmse = rmse1[1,1]
 27. qui gen cohend = $cohend 
 28. qui gen id = ${t_id} 
 29. capture drop Y1 Y2 absdf 
 30. tempfile placebo`i'
 31. qui save  `placebo`i'', replace 
 32. timer off 2
 33. timer list 2
 34. display "Placebo `i' out of $don"
 35. timer clear 2 
 36. restore 
 37. }
   2:      6.24 /        1 =       6.2410
Placebo 1 out of 208
   2:      6.21 /        1 =       6.2130
Placebo 2 out of 208
   2:      6.30 /        1 =       6.2990
Placebo 3 out of 208
   2:      6.27 /        1 =       6.2700
Placebo 4 out of 208
   2:      6.55 /        1 =       6.5540
Placebo 5 out of 208
   2:      6.75 /        1 =       6.7450
Placebo 6 out of 208
   2:      6.39 /        1 =       6.3950
Placebo 7 out of 208
   2:      6.28 /        1 =       6.2760
Placebo 8 out of 208
   2:      6.25 /        1 =       6.2490
Placebo 9 out of 208
   2:      6.23 /        1 =       6.2340
Placebo 10 out of 208
   2:      6.25 /        1 =       6.2480
Placebo 11 out of 208
   2:      6.17 /        1 =       6.1720
Placebo 12 out of 208
   2:      6.17 /        1 =       6.1740
Placebo 13 out of 208
   2:      6.15 /        1 =       6.1460
Placebo 14 out of 208
   2:      6.15 /        1 =       6.1470
Placebo 15 out of 208
   2:      6.15 /        1 =       6.1540
Placebo 16 out of 208
   2:      6.17 /        1 =       6.1660
Placebo 17 out of 208
   2:      6.21 /        1 =       6.2150
Placebo 18 out of 208
   2:      6.32 /        1 =       6.3180
Placebo 19 out of 208
   2:      6.13 /        1 =       6.1290
Placebo 20 out of 208
   2:      6.19 /        1 =       6.1920
Placebo 21 out of 208
   2:      6.16 /        1 =       6.1600
Placebo 22 out of 208
   2:      6.12 /        1 =       6.1250
Placebo 23 out of 208
   2:      6.18 /        1 =       6.1790
Placebo 24 out of 208
   2:      6.32 /        1 =       6.3200
Placebo 25 out of 208
   2:      6.21 /        1 =       6.2050
Placebo 26 out of 208
   2:      6.12 /        1 =       6.1160
Placebo 27 out of 208
   2:      6.13 /        1 =       6.1290
Placebo 28 out of 208
   2:      6.15 /        1 =       6.1540
Placebo 29 out of 208
   2:      6.14 /        1 =       6.1440
Placebo 30 out of 208
   2:      6.29 /        1 =       6.2880
Placebo 31 out of 208
   2:      6.21 /        1 =       6.2140
Placebo 32 out of 208
   2:      6.16 /        1 =       6.1600
Placebo 33 out of 208
   2:      6.19 /        1 =       6.1890
Placebo 34 out of 208
   2:      6.14 /        1 =       6.1390
Placebo 35 out of 208
   2:      6.19 /        1 =       6.1940
Placebo 36 out of 208
   2:      6.26 /        1 =       6.2630
Placebo 37 out of 208
   2:      6.27 /        1 =       6.2740
Placebo 38 out of 208
   2:      6.18 /        1 =       6.1830
Placebo 39 out of 208
   2:      6.20 /        1 =       6.1970
Placebo 40 out of 208
   2:      6.19 /        1 =       6.1940
Placebo 41 out of 208
   2:      6.18 /        1 =       6.1820
Placebo 42 out of 208
   2:      6.23 /        1 =       6.2290
Placebo 43 out of 208
   2:      6.27 /        1 =       6.2670
Placebo 44 out of 208
   2:      6.19 /        1 =       6.1860
Placebo 45 out of 208
   2:      6.19 /        1 =       6.1940
Placebo 46 out of 208
   2:      6.17 /        1 =       6.1730
Placebo 47 out of 208
   2:      6.20 /        1 =       6.1980
Placebo 48 out of 208
   2:      6.22 /        1 =       6.2160
Placebo 49 out of 208
   2:      6.28 /        1 =       6.2800
Placebo 50 out of 208
   2:      6.16 /        1 =       6.1610
Placebo 51 out of 208
   2:      6.15 /        1 =       6.1520
Placebo 52 out of 208
   2:      6.17 /        1 =       6.1730
Placebo 53 out of 208
   2:      6.16 /        1 =       6.1570
Placebo 54 out of 208
   2:      6.22 /        1 =       6.2250
Placebo 55 out of 208
   2:      6.24 /        1 =       6.2440
Placebo 56 out of 208
   2:      6.16 /        1 =       6.1630
Placebo 57 out of 208
   2:      6.16 /        1 =       6.1620
Placebo 58 out of 208
   2:      6.15 /        1 =       6.1520
Placebo 59 out of 208
   2:      6.20 /        1 =       6.2030
Placebo 60 out of 208
   2:      6.21 /        1 =       6.2100
Placebo 61 out of 208
   2:      6.32 /        1 =       6.3190
Placebo 62 out of 208
   2:      6.16 /        1 =       6.1570
Placebo 63 out of 208
   2:      6.21 /        1 =       6.2100
Placebo 64 out of 208
   2:      6.18 /        1 =       6.1760
Placebo 65 out of 208
   2:      6.21 /        1 =       6.2080
Placebo 66 out of 208
   2:      6.19 /        1 =       6.1910
Placebo 67 out of 208
   2:      6.33 /        1 =       6.3350
Placebo 68 out of 208
   2:      6.17 /        1 =       6.1680
Placebo 69 out of 208
   2:      6.15 /        1 =       6.1480
Placebo 70 out of 208
   2:      6.14 /        1 =       6.1370
Placebo 71 out of 208
   2:      6.13 /        1 =       6.1260
Placebo 72 out of 208
   2:      6.17 /        1 =       6.1650
Placebo 73 out of 208
   2:      6.33 /        1 =       6.3270
Placebo 74 out of 208
   2:      6.17 /        1 =       6.1690
Placebo 75 out of 208
   2:      6.17 /        1 =       6.1660
Placebo 76 out of 208
   2:      6.16 /        1 =       6.1550
Placebo 77 out of 208
   2:      6.13 /        1 =       6.1350
Placebo 78 out of 208
   2:      6.14 /        1 =       6.1410
Placebo 79 out of 208
   2:      6.30 /        1 =       6.3010
Placebo 80 out of 208
   2:      6.16 /        1 =       6.1630
Placebo 81 out of 208
   2:      6.14 /        1 =       6.1400
Placebo 82 out of 208
   2:      6.17 /        1 =       6.1650
Placebo 83 out of 208
   2:      6.30 /        1 =       6.3010
Placebo 84 out of 208
   2:      6.44 /        1 =       6.4390
Placebo 85 out of 208
   2:      6.30 /        1 =       6.2980
Placebo 86 out of 208
   2:      6.07 /        1 =       6.0690
Placebo 87 out of 208
   2:      6.09 /        1 =       6.0940
Placebo 88 out of 208
   2:      6.19 /        1 =       6.1900
Placebo 89 out of 208
   2:      6.19 /        1 =       6.1870
Placebo 90 out of 208
   2:      6.28 /        1 =       6.2840
Placebo 91 out of 208
   2:      6.29 /        1 =       6.2890
Placebo 92 out of 208
   2:      6.18 /        1 =       6.1760
Placebo 93 out of 208
   2:      6.16 /        1 =       6.1550
Placebo 94 out of 208
   2:      6.15 /        1 =       6.1510
Placebo 95 out of 208
   2:      6.18 /        1 =       6.1790
Placebo 96 out of 208
   2:      6.22 /        1 =       6.2230
Placebo 97 out of 208
   2:      6.29 /        1 =       6.2920
Placebo 98 out of 208
   2:      6.14 /        1 =       6.1360
Placebo 99 out of 208
   2:      6.16 /        1 =       6.1610
Placebo 100 out of 208
   2:      6.17 /        1 =       6.1710
Placebo 101 out of 208
   2:      6.17 /        1 =       6.1750
Placebo 102 out of 208
   2:      6.25 /        1 =       6.2510
Placebo 103 out of 208
   2:      6.23 /        1 =       6.2340
Placebo 104 out of 208
   2:      6.17 /        1 =       6.1670
Placebo 105 out of 208
   2:      6.22 /        1 =       6.2170
Placebo 106 out of 208
   2:      6.29 /        1 =       6.2850
Placebo 107 out of 208
   2:      6.74 /        1 =       6.7410
Placebo 108 out of 208
   2:      6.44 /        1 =       6.4440
Placebo 109 out of 208
   2:      6.24 /        1 =       6.2430
Placebo 110 out of 208
   2:      7.36 /        1 =       7.3550
Placebo 111 out of 208
   2:      7.30 /        1 =       7.2960
Placebo 112 out of 208
   2:      6.62 /        1 =       6.6160
Placebo 113 out of 208
   2:      6.33 /        1 =       6.3330
Placebo 114 out of 208
   2:      6.23 /        1 =       6.2310
Placebo 115 out of 208
   2:      6.35 /        1 =       6.3480
Placebo 116 out of 208
   2:      6.40 /        1 =       6.3970
Placebo 117 out of 208
   2:      6.28 /        1 =       6.2750
Placebo 118 out of 208
   2:      6.37 /        1 =       6.3660
Placebo 119 out of 208
   2:      6.28 /        1 =       6.2830
Placebo 120 out of 208
   2:      6.25 /        1 =       6.2540
Placebo 121 out of 208
   2:      6.21 /        1 =       6.2050
Placebo 122 out of 208
   2:      6.16 /        1 =       6.1570
Placebo 123 out of 208
   2:      6.18 /        1 =       6.1840
Placebo 124 out of 208
   2:      6.20 /        1 =       6.2040
Placebo 125 out of 208
   2:      6.32 /        1 =       6.3200
Placebo 126 out of 208
   2:      6.27 /        1 =       6.2730
Placebo 127 out of 208
   2:      6.18 /        1 =       6.1810
Placebo 128 out of 208
   2:      6.19 /        1 =       6.1860
Placebo 129 out of 208
   2:      6.13 /        1 =       6.1320
Placebo 130 out of 208
   2:      6.12 /        1 =       6.1180
Placebo 131 out of 208
   2:      6.28 /        1 =       6.2780
Placebo 132 out of 208
   2:      6.14 /        1 =       6.1430
Placebo 133 out of 208
   2:      6.22 /        1 =       6.2240
Placebo 134 out of 208
   2:      6.25 /        1 =       6.2450
Placebo 135 out of 208
   2:      6.11 /        1 =       6.1050
Placebo 136 out of 208
   2:      6.14 /        1 =       6.1450
Placebo 137 out of 208
   2:      6.14 /        1 =       6.1390
Placebo 138 out of 208
   2:      6.36 /        1 =       6.3570
Placebo 139 out of 208
   2:      6.26 /        1 =       6.2600
Placebo 140 out of 208
   2:      6.13 /        1 =       6.1260
Placebo 141 out of 208
   2:      6.12 /        1 =       6.1210
Placebo 142 out of 208
   2:      6.18 /        1 =       6.1830
Placebo 143 out of 208
   2:      6.08 /        1 =       6.0800
Placebo 144 out of 208
   2:      6.08 /        1 =       6.0810
Placebo 145 out of 208
   2:      6.09 /        1 =       6.0910
Placebo 146 out of 208
   2:      6.14 /        1 =       6.1420
Placebo 147 out of 208
   2:      6.11 /        1 =       6.1080
Placebo 148 out of 208
   2:      6.15 /        1 =       6.1490
Placebo 149 out of 208
   2:      6.25 /        1 =       6.2510
Placebo 150 out of 208
   2:      6.21 /        1 =       6.2080
Placebo 151 out of 208
   2:      6.15 /        1 =       6.1480
Placebo 152 out of 208
   2:      6.14 /        1 =       6.1380
Placebo 153 out of 208
   2:      6.12 /        1 =       6.1190
Placebo 154 out of 208
   2:      6.14 /        1 =       6.1380
Placebo 155 out of 208
   2:      6.22 /        1 =       6.2180
Placebo 156 out of 208
   2:      6.24 /        1 =       6.2430
Placebo 157 out of 208
   2:      6.06 /        1 =       6.0600
Placebo 158 out of 208
   2:      6.08 /        1 =       6.0770
Placebo 159 out of 208
   2:      6.12 /        1 =       6.1240
Placebo 160 out of 208
   2:      6.19 /        1 =       6.1860
Placebo 161 out of 208
   2:      6.13 /        1 =       6.1260
Placebo 162 out of 208
   2:      6.36 /        1 =       6.3620
Placebo 163 out of 208
   2:      6.12 /        1 =       6.1190
Placebo 164 out of 208
   2:      6.32 /        1 =       6.3150
Placebo 165 out of 208
   2:    101.51 /        1 =     101.5130
Placebo 166 out of 208
   2:      6.37 /        1 =       6.3730
Placebo 167 out of 208
   2:      6.05 /        1 =       6.0550
Placebo 168 out of 208
   2:      6.07 /        1 =       6.0660
Placebo 169 out of 208
   2:      6.10 /        1 =       6.0960
Placebo 170 out of 208
   2:      6.11 /        1 =       6.1100
Placebo 171 out of 208
   2:      6.16 /        1 =       6.1550
Placebo 172 out of 208
   2:      6.21 /        1 =       6.2060
Placebo 173 out of 208
   2:      6.09 /        1 =       6.0880
Placebo 174 out of 208
   2:      6.11 /        1 =       6.1050
Placebo 175 out of 208
   2:      6.09 /        1 =       6.0880
Placebo 176 out of 208
   2:      6.10 /        1 =       6.1020
Placebo 177 out of 208
   2:      6.12 /        1 =       6.1210
Placebo 178 out of 208
   2:      6.25 /        1 =       6.2500
Placebo 179 out of 208
   2:      6.07 /        1 =       6.0710
Placebo 180 out of 208
   2:      6.10 /        1 =       6.0960
Placebo 181 out of 208
   2:      6.11 /        1 =       6.1140
Placebo 182 out of 208
   2:      6.12 /        1 =       6.1230
Placebo 183 out of 208
   2:      6.14 /        1 =       6.1450
Placebo 184 out of 208
   2:      6.23 /        1 =       6.2320
Placebo 185 out of 208
   2:      6.11 /        1 =       6.1140
Placebo 186 out of 208
   2:      6.12 /        1 =       6.1170
Placebo 187 out of 208
   2:      6.09 /        1 =       6.0890
Placebo 188 out of 208
   2:      6.07 /        1 =       6.0660
Placebo 189 out of 208
   2:      6.15 /        1 =       6.1500
Placebo 190 out of 208
   2:      6.26 /        1 =       6.2620
Placebo 191 out of 208
   2:      6.08 /        1 =       6.0760
Placebo 192 out of 208
   2:      6.10 /        1 =       6.1030
Placebo 193 out of 208
   2:      6.10 /        1 =       6.0990
Placebo 194 out of 208
   2:      6.09 /        1 =       6.0870
Placebo 195 out of 208
   2:      6.10 /        1 =       6.1020
Placebo 196 out of 208
   2:      6.24 /        1 =       6.2400
Placebo 197 out of 208
   2:      6.18 /        1 =       6.1810
Placebo 198 out of 208
   2:      6.10 /        1 =       6.1040
Placebo 199 out of 208
   2:      6.10 /        1 =       6.0960
Placebo 200 out of 208
   2:      6.08 /        1 =       6.0770
Placebo 201 out of 208
   2:      6.13 /        1 =       6.1340
Placebo 202 out of 208
   2:      6.16 /        1 =       6.1610
Placebo 203 out of 208
   2:      6.22 /        1 =       6.2210
Placebo 204 out of 208
   2:      6.10 /        1 =       6.1020
Placebo 205 out of 208
   2:      6.12 /        1 =       6.1190
Placebo 206 out of 208
   2:      6.09 /        1 =       6.0910
Placebo 207 out of 208
   2:      6.09 /        1 =       6.0910
Placebo 208 out of 208

. timer off 1 

. timer list 1 
   1:   1387.11 /        1 =    1387.1100

. timer clear 1 

. cap log close, replace 

. ************************************************************************
. ************************************************************************
. /// Append the placebos in one dataset 
> use `placebo1' , clear 

. drop if _n > = 1
(36 observations deleted)

. forvalues i = 1(1)$don  {
  2. append using `placebo`i''
  3. }

. save "${tem}/placeboap_rc.dta", replace 
file 1_Data/Temp//placeboap_rc.dta saved

. 
. /// Identify the placebos that pass the Cohen D criterion 
> /// 4. Placebo Empirical Distribution: This is not Estimated Again.
> use "${tem}/placeboap_rc.dta", clear 

. /// Goodness of Fit 
> preserve 

. // Survival Test 
. gcollapse (mean) rmse , by(id) 

. qui cumul rmse, gen(ecdf)

. gsort -ecdf

. qui gen survival = rmse < (1-$rmspe_cutoff)

. qui egen survrate = mean(survival)

. sum survrate

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    survrate |        208    .8365384           0   .8365384   .8365384

. gsort survival id 

. sum survrate

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
    survrate |        208    .8365384           0   .8365384   .8365384

. local survrate = round(r(mean),0.001)

. local donors = round(r(sum),1)

. local tot = round(r(N),1)

. twoway line ecdf rmse, sort xline($rmspe_cutoff, lcolor(black)) name(survival,replace) title(
> "Placebo Distribution - Survival Rate `survrate' - `donors' out of `tot donors'",size(small))

. save "${tem}/placebosforinferencerce_rc.dta", replace 
file 1_Data/Temp//placebosforinferencerce_rc.dta saved

. restore 

. exit 

end of do-file

. /// Estimate the Robustness Check 
> do "${cod}/code_analysis/5_RC_CreditRating.do"

. ********************************************************************************
. ********************************************************************************
. /// Project: Volatility in the Municipal Bond Market and the MLF
> /// Authors: Felipe Lozano & Luis Navarro
> /// Code: Luis Navarro (lunavarr@iu.edu) 
> /// Update: February 2024
> /// Script: Run Robustness Check: Variable States Cohorts 
> ********************************************************************************
. ********************************************************************************
. graph drop _all 

. set trace off

. /// Load dates 
> 
. ********************************************************************************
. preserve 

. use "${cln}/synth_clean.dta", clear 

. replace month_exp = month_exp - ${treat_period}
(7,632 real changes made)

. drop if treat == 0 
(7,488 observations deleted)

. keep month_exp mofd

. duplicates drop mofd, force 

Duplicates in terms of mofd

(108 observations deleted)

. save "${tem}/dates.dta", replace 
file 1_Data/Temp//dates.dta saved

. restore 

. 
. ********************************************************************************
. /// Step1. Run the synthetic control for the treated units. 
> /// Load the Data for the Robustness Check 
> use "${cln}/synth_clean.dta", clear 

. /// 1. Synth Estimation 
> synth_estimation
v_pre_mn:  (4,452 real changes made)
v_pre_sd:  (4,452 real changes made)

  group(id) |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         36       25.00       25.00
          2 |         36       25.00       50.00
          3 |         36       25.00       75.00
          4 |         36       25.00      100.00
------------+-----------------------------------
      Total |        144      100.00
v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4) v(3) v(2) v(1)
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 1
               Control Units:  2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
                              v(3) v(2) v(1)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  .8272051 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        2 |           0
        3 |           0
        4 |           0
        5 |           0
        6 |           0
        7 |           0
        8 |           0
        9 |           0
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |           0
       17 |           0
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |           0
       35 |           0
       36 |           0
       37 |           0
       38 |           0
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |           0
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |           0
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |           0
      117 |           0
      118 |           0
      119 |        .082
      120 |           0
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |           0
      134 |           0
      135 |           0
      136 |           0
      137 |           0
      138 |           0
      139 |        .001
      140 |           0
      141 |           0
      142 |           0
      143 |           0
      144 |           0
      145 |           0
      146 |           0
      147 |           0
      148 |        .001
      149 |           0
      150 |           0
      151 |           0
      152 |           0
      153 |           0
      154 |           0
      155 |           0
      156 |           0
      157 |           0
      158 |        .073
      159 |           0
      160 |           0
      161 |        .238
      162 |           0
      163 |           0
      164 |        .586
      165 |           0
      166 |           0
      167 |           0
      168 |           0
      169 |           0
      170 |           0
      171 |           0
      172 |           0
      173 |           0
      174 |           0
      175 |           0
      176 |           0
      177 |           0
      178 |           0
      179 |           0
      180 |           0
      181 |           0
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |        .019
      187 |           0
      188 |           0
      189 |           0
      190 |           0
      191 |           0
      192 |           0
      193 |           0
      194 |           0
      195 |           0
      196 |           0
      197 |           0
      198 |           0
      199 |           0
      200 |           0
      201 |           0
      202 |           0
      203 |           0
      204 |           0
      205 |           0
      206 |           0
      207 |           0
      208 |           0
      209 |           0
      210 |           0
      211 |           0
      212 |           0
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |  .3823351   .4496212 
                         v(14) |  .1504716   .2166042 
                         v(13) |  .1404682   .1436214 
                         v(12) |  .1579276   .1952204 
                         v(11) |  .2292171   .1947852 
                         v(10) |  .2080822   .2769003 
                          v(9) |  .2792784   .2240081 
                          v(8) |  .2080771   .2226406 
                          v(7) |  .1922006   .2217468 
                          v(6) |  .2337682   .2391435 
                          v(5) |  .2289858   .2253008 
                          v(4) |  .1654316   .1973483 
                          v(3) |  .4321223   .3208655 
                          v(2) |   .200756    .211437 
                          v(1) |  .1009332   .1686762 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000005 saved as .dta format
   2:      5.13 /        1 =       5.1300
Treatment Unit 1 out of 4
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 2
               Control Units: 1 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
                              v(3) v(2) v(1)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  1.126608 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        1 |           0
        3 |           0
        4 |           0
        5 |           0
        6 |           0
        7 |           0
        8 |           0
        9 |           0
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |           0
       17 |           0
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |           0
       35 |           0
       36 |           0
       37 |           0
       38 |           0
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |           0
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |           0
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |           0
      117 |           0
      118 |           0
      119 |           0
      120 |           0
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |           0
      134 |           0
      135 |           0
      136 |        .001
      137 |           0
      138 |           0
      139 |           0
      140 |           0
      141 |           0
      142 |           0
      143 |           0
      144 |           0
      145 |           0
      146 |           0
      147 |           0
      148 |           0
      149 |           0
      150 |           0
      151 |           0
      152 |           0
      153 |           0
      154 |           0
      155 |           0
      156 |           0
      157 |           0
      158 |           0
      159 |           0
      160 |           0
      161 |           0
      162 |           0
      163 |           0
      164 |           0
      165 |           0
      166 |           0
      167 |           0
      168 |           0
      169 |           0
      170 |           0
      171 |           0
      172 |           0
      173 |           0
      174 |           0
      175 |           0
      176 |           0
      177 |           0
      178 |           0
      179 |        .014
      180 |           0
      181 |           0
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |           0
      187 |           0
      188 |           0
      189 |           0
      190 |           0
      191 |           0
      192 |           0
      193 |           0
      194 |        .985
      195 |           0
      196 |           0
      197 |           0
      198 |           0
      199 |           0
      200 |           0
      201 |           0
      202 |           0
      203 |           0
      204 |           0
      205 |           0
      206 |           0
      207 |           0
      208 |           0
      209 |           0
      210 |           0
      211 |           0
      212 |           0
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |  .4128598   .2410641 
                         v(14) |  .0939183   .1165721 
                         v(13) |  .0791257   .1046857 
                         v(12) |  .0778856   .0853859 
                         v(11) |  .0642852   .0978545 
                         v(10) |  .1957071   .1060067 
                          v(9) |   .153413   .1177576 
                          v(8) |  .0993258    .082241 
                          v(7) |  .1218954   .1088304 
                          v(6) |  .1274534   .0840229 
                          v(5) |  .1394321   .1092414 
                          v(4) |  .1846859    .095666 
                          v(3) |   .143772   .0984225 
                          v(2) |  .1772762   .0964777 
                          v(1) |  .2944962   .1715477 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.000009 saved as .dta format
   2:      5.00 /        1 =       4.9990
Treatment Unit 2 out of 4
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 3
               Control Units: 1 2 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
                              v(3) v(2) v(1)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  .6469611 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        1 |           0
        2 |        .319
        4 |           0
        5 |           0
        6 |           0
        7 |           0
        8 |           0
        9 |         .47
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |           0
       17 |           0
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |           0
       35 |           0
       36 |           0
       37 |           0
       38 |           0
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |           0
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |           0
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |           0
      117 |           0
      118 |           0
      119 |           0
      120 |           0
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |           0
      134 |           0
      135 |           0
      136 |           0
      137 |           0
      138 |           0
      139 |           0
      140 |           0
      141 |           0
      142 |           0
      143 |           0
      144 |        .063
      145 |           0
      146 |           0
      147 |           0
      148 |           0
      149 |           0
      150 |           0
      151 |           0
      152 |           0
      153 |           0
      154 |           0
      155 |           0
      156 |           0
      157 |           0
      158 |           0
      159 |           0
      160 |           0
      161 |           0
      162 |           0
      163 |           0
      164 |        .125
      165 |           0
      166 |           0
      167 |           0
      168 |           0
      169 |           0
      170 |           0
      171 |           0
      172 |           0
      173 |           0
      174 |           0
      175 |           0
      176 |           0
      177 |           0
      178 |           0
      179 |           0
      180 |           0
      181 |           0
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |           0
      187 |           0
      188 |           0
      189 |           0
      190 |        .003
      191 |           0
      192 |           0
      193 |           0
      194 |           0
      195 |           0
      196 |           0
      197 |           0
      198 |         .02
      199 |           0
      200 |           0
      201 |           0
      202 |           0
      203 |           0
      204 |           0
      205 |           0
      206 |           0
      207 |           0
      208 |           0
      209 |           0
      210 |           0
      211 |           0
      212 |           0
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |  .4067682   .3485641 
                         v(14) |  .0793239   .1420983 
                         v(13) |  .0983383   .1280203 
                         v(12) |   .103423   .1013357 
                         v(11) |  .2626197   .1603138 
                         v(10) |  .1137977   .1391021 
                          v(9) |  .1776496   .1535286 
                          v(8) |  .1370895   .1130839 
                          v(7) |  .1649162   .1579435 
                          v(6) |  .1949383   .1563507 
                          v(5) |  .1823743   .1448423 
                          v(4) |  .1331534   .1360061 
                          v(3) |  .1234642   .1145835 
                          v(2) |  .1943926   .1646091 
                          v(1) |  .2541371   .2112579 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000d saved as .dta format
   2:      4.95 /        1 =       4.9470
Treatment Unit 3 out of 4
-----------------------------------------------------------------------------------------------
Synthetic Control Method for Comparative Case Studies
-----------------------------------------------------------------------------------------------

First Step: Data Setup
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Data Setup successful
-----------------------------------------------------------------------------------------------
                Treated Unit: 4
               Control Units: 1 2 3 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47
                              48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69
                              70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91
                              92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109
                              110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125
                              126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141
                              142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157
                              158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173
                              174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189
                              190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205
                              206 207 208 209 210 211 212
-----------------------------------------------------------------------------------------------
          Dependent Variable: v_norm
  MSPE minimized for periods: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
Results obtained for periods: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
                              26 27 28 29 30 31 32 33 34 35 36
-----------------------------------------------------------------------------------------------
                  Predictors: v(15) v(14) v(13) v(12) v(11) v(10) v(9) v(8) v(7) v(6) v(5) v(4)
                              v(3) v(2) v(1)
-----------------------------------------------------------------------------------------------
Unless period is specified
predictors are averaged over: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
-----------------------------------------------------------------------------------------------

Second Step: Run Optimization
-----------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------
Optimization done
-----------------------------------------------------------------------------------------------

Third Step: Obtain Results
-----------------------------------------------------------------------------------------------
Loss: Root Mean Squared Prediction Error

---------------------
   RMSPE |  .8082449 
---------------------
-----------------------------------------------------------------------------------------------
Unit Weights:

-----------------------
    Co_No | Unit_Weight
----------+------------
        1 |           0
        2 |           0
        3 |           0
        5 |           0
        6 |           0
        7 |           0
        8 |           0
        9 |           0
       10 |           0
       11 |           0
       12 |           0
       13 |           0
       14 |           0
       15 |           0
       16 |        .492
       17 |           0
       18 |           0
       19 |           0
       20 |           0
       21 |           0
       22 |           0
       23 |           0
       24 |           0
       25 |           0
       26 |           0
       27 |           0
       28 |           0
       29 |           0
       30 |           0
       31 |           0
       32 |           0
       33 |           0
       34 |           0
       35 |           0
       36 |           0
       37 |           0
       38 |           0
       39 |           0
       40 |           0
       41 |           0
       42 |           0
       43 |           0
       44 |           0
       45 |           0
       46 |           0
       47 |           0
       48 |           0
       49 |           0
       50 |           0
       51 |           0
       52 |           0
       53 |           0
       54 |           0
       55 |           0
       56 |           0
       57 |           0
       58 |           0
       59 |           0
       60 |           0
       61 |           0
       62 |           0
       63 |           0
       64 |           0
       65 |           0
       66 |           0
       67 |           0
       68 |           0
       69 |           0
       70 |           0
       71 |           0
       72 |           0
       73 |           0
       74 |           0
       75 |           0
       76 |           0
       77 |           0
       78 |           0
       79 |           0
       80 |           0
       81 |           0
       82 |           0
       83 |           0
       84 |           0
       85 |           0
       86 |           0
       87 |           0
       88 |           0
       89 |           0
       90 |           0
       91 |           0
       92 |           0
       93 |           0
       94 |           0
       95 |           0
       96 |           0
       97 |           0
       98 |           0
       99 |           0
      100 |           0
      101 |           0
      102 |           0
      103 |           0
      104 |           0
      105 |           0
      106 |           0
      107 |           0
      108 |           0
      109 |           0
      110 |           0
      111 |           0
      112 |           0
      113 |           0
      114 |           0
      115 |           0
      116 |           0
      117 |           0
      118 |           0
      119 |           0
      120 |           0
      121 |           0
      122 |           0
      123 |           0
      124 |           0
      125 |           0
      126 |           0
      127 |           0
      128 |           0
      129 |           0
      130 |           0
      131 |           0
      132 |           0
      133 |           0
      134 |           0
      135 |           0
      136 |           0
      137 |           0
      138 |        .112
      139 |        .002
      140 |           0
      141 |           0
      142 |        .002
      143 |           0
      144 |        .095
      145 |           0
      146 |           0
      147 |           0
      148 |           0
      149 |           0
      150 |           0
      151 |        .082
      152 |           0
      153 |           0
      154 |           0
      155 |           0
      156 |           0
      157 |           0
      158 |           0
      159 |           0
      160 |           0
      161 |           0
      162 |           0
      163 |           0
      164 |           0
      165 |           0
      166 |           0
      167 |           0
      168 |           0
      169 |           0
      170 |           0
      171 |           0
      172 |           0
      173 |           0
      174 |           0
      175 |           0
      176 |           0
      177 |           0
      178 |           0
      179 |           0
      180 |           0
      181 |        .015
      182 |           0
      183 |           0
      184 |           0
      185 |           0
      186 |           0
      187 |           0
      188 |           0
      189 |           0
      190 |           0
      191 |        .048
      192 |           0
      193 |           0
      194 |        .081
      195 |           0
      196 |           0
      197 |           0
      198 |           0
      199 |           0
      200 |           0
      201 |           0
      202 |           0
      203 |           0
      204 |           0
      205 |           0
      206 |        .072
      207 |           0
      208 |           0
      209 |           0
      210 |           0
      211 |           0
      212 |           0
-----------------------
-----------------------------------------------------------------------------------------------
Predictor Balance:

------------------------------------------------------
                               |   Treated  Synthetic 
-------------------------------+----------------------
                         v(15) |  .4943053   .8630981 
                         v(14) |  .3461914   .4331337 
                         v(13) |  .3436571   .3748564 
                         v(12) |   .350595   .2910828 
                         v(11) |  .3450149   .3215908 
                         v(10) |  .5206764   .3352307 
                          v(9) |  .5032988   .4341256 
                          v(8) |  .5854516   .4349399 
                          v(7) |  .3388588   .3576724 
                          v(6) |  .4574112   .4077612 
                          v(5) |  .3776779   .3583153 
                          v(4) |  .2850323   .2982907 
                          v(3) |  .2137059   .2761623 
                          v(2) |  .3348089   .3370959 
                          v(1) |  .3348089   .3098697 
------------------------------------------------------
-----------------------------------------------------------------------------------------------
file /var/folders/vz/nb4bfqj162nf95qr4tqrffgr0000gn/T//S_22961.00000h saved as .dta format
   2:      4.93 /        1 =       4.9340
Treatment Unit 4 out of 4
   1:     20.01 /        1 =      20.0140
(36 observations deleted)
(144 real changes made)

  month_exp |      Freq.     Percent        Cum.
------------+-----------------------------------
        -15 |          4        2.78        2.78
        -14 |          4        2.78        5.56
        -13 |          4        2.78        8.33
        -12 |          4        2.78       11.11
        -11 |          4        2.78       13.89
        -10 |          4        2.78       16.67
         -9 |          4        2.78       19.44
         -8 |          4        2.78       22.22
         -7 |          4        2.78       25.00
         -6 |          4        2.78       27.78
         -5 |          4        2.78       30.56
         -4 |          4        2.78       33.33
         -3 |          4        2.78       36.11
         -2 |          4        2.78       38.89
         -1 |          4        2.78       41.67
          0 |          4        2.78       44.44
          1 |          4        2.78       47.22
          2 |          4        2.78       50.00
          3 |          4        2.78       52.78
          4 |          4        2.78       55.56
          5 |          4        2.78       58.33
          6 |          4        2.78       61.11
          7 |          4        2.78       63.89
          8 |          4        2.78       66.67
          9 |          4        2.78       69.44
         10 |          4        2.78       72.22
         11 |          4        2.78       75.00
         12 |          4        2.78       77.78
         13 |          4        2.78       80.56
         14 |          4        2.78       83.33
         15 |          4        2.78       86.11
         16 |          4        2.78       88.89
         17 |          4        2.78       91.67
         18 |          4        2.78       94.44
         19 |          4        2.78       97.22
         20 |          4        2.78      100.00
------------+-----------------------------------
      Total |        144      100.00

. save "${tem}/synth_treated_rc.dta", replace 
file 1_Data/Temp//synth_treated_rc.dta saved

. ********************************************************************************
. 
. 
. ********************************************************************************
. /// 2. Do the Synth Graph 
> use "${tem}/synth_treated_rc.dta", clear 

. global graphopts ytitle("Avg Intra-Week Std.Dev",size(small)) ylabel(#10, nogrid labsize(smal
> l) angle(0)) title(, size(small) pos(11) color(black)) plotregion(lcolor(black)) graphregion(
> margin(4 4 4 4)) plotregion(lcolor(black)) xtitle("", size(small)) xlabel(#27, nogrid labsize
> (small) angle(90)) legend(on order(1 "Observed Volatility" 2 "Synthetic Volatility") size(sma
> ll) rows(1)) yscale(titlegap(0))

. ********************************************************************************
. /// Show only the ATE window 
> keep if month_exp < ${tr_eff_window}
(24 observations deleted)

. merge m:1 month_exp using "${tem}/dates.dta", keep(match master) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                               120  
    -----------------------------------------

. qui sum mofd if month_exp == 0 

. local xline = r(mean)

. ********************************************************************************
. qui tab fileid 

. global rows = r(r)

. 
. local title1 = "A"

. local title2 = "AA"

. local title3 = "AAA"

. local title4 = "BBB"

. local lineopts lcolor(gray) lpattern(dash) lwidth(vthin)

. local lineopts1 lwidth(medthin) msize(vsmall)

. 
. forvalues i=1(1)$rows {
  2.     preserve 
  3.         qui keep if fileid == `i'
  4.         twoway (line treated mofd, lcolor(black) lpattern(solid) mcolor(black) msymbol(cir
> cle) `lineopts1') ///
>                 (line synth mofd, lcolor(cranberry) lpattern(dash) mcolor(cranberry) msymbol(
> square) `lineopts1'),  ///
>                 $graphopts title("`title`i''") name(gr`i',replace) xline(`xline' , `lineopts'
> ) yline(0 , `lineopts')
  5.         restore 
  6. }

. 
. global combopts xcommon ycommon rows(2) cols(2)

. grc1leg gr3 gr2 gr1 gr4, legendfrom(gr2) name(grcombrc,replace) $combopts 

. graph display grcombrc, ysize(80) xsize(100) scale(.9)

. graph export "${oup}/Synth_Graph_rc.pdf", $export
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//Synth_Graph_rc.pdf saved as PDF format

. ********************************************************************************
. 
. 
. 
. ********************************************************************************
. /// 3. Express placebos in units of the treated series 
> use "${cln}/synth_clean.dta", clear 

. //// 
> placebo_outcome_main
v_pre_mn:  (4,452 real changes made)
v_pre_sd:  (4,452 real changes made)
(29,952 real changes made)

  month_exp |      Freq.     Percent        Cum.
------------+-----------------------------------
        -15 |        832        2.78        2.78
        -14 |        832        2.78        5.56
        -13 |        832        2.78        8.33
        -12 |        832        2.78       11.11
        -11 |        832        2.78       13.89
        -10 |        832        2.78       16.67
         -9 |        832        2.78       19.44
         -8 |        832        2.78       22.22
         -7 |        832        2.78       25.00
         -6 |        832        2.78       27.78
         -5 |        832        2.78       30.56
         -4 |        832        2.78       33.33
         -3 |        832        2.78       36.11
         -2 |        832        2.78       38.89
         -1 |        832        2.78       41.67
          0 |        832        2.78       44.44
          1 |        832        2.78       47.22
          2 |        832        2.78       50.00
          3 |        832        2.78       52.78
          4 |        832        2.78       55.56
          5 |        832        2.78       58.33
          6 |        832        2.78       61.11
          7 |        832        2.78       63.89
          8 |        832        2.78       66.67
          9 |        832        2.78       69.44
         10 |        832        2.78       72.22
         11 |        832        2.78       75.00
         12 |        832        2.78       77.78
         13 |        832        2.78       80.56
         14 |        832        2.78       83.33
         15 |        832        2.78       86.11
         16 |        832        2.78       88.89
         17 |        832        2.78       91.67
         18 |        832        2.78       94.44
         19 |        832        2.78       97.22
         20 |        832        2.78      100.00
------------+-----------------------------------
      Total |     29,952      100.00

. save "${tem}/synth_placebos_rc.dta", replace 
file 1_Data/Temp//synth_placebos_rc.dta saved

. ********************************************************************************
. 
. ********************************************************************************
. /// 4. Identify the placebos that pass the cohen-d criterion 
> use "${tem}/synth_placebos_rc.dta", clear 

. merge m:1 id using "${tem}/placebosforinferencerce_rc.dta", keep(match master) nogen

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                            29,952  
    -----------------------------------------

. keep if survival == 1
(4,896 observations deleted)

. /// Save data 
> tempfile placeboempiricaldistribution

. save "${tem}/placeboempiricaldistribution_rc.dta", replace
file 1_Data/Temp//placeboempiricaldistribution_rc.dta saved

. ********************************************************************************
.  
.  
. /// 5. ATE and Pvalues 
> use "${tem}/synth_treated_rc.dta", clear 

. tab fileid

     fileid |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |         36       25.00       25.00
          2 |         36       25.00       50.00
          3 |         36       25.00       75.00
          4 |         36       25.00      100.00
------------+-----------------------------------
      Total |        144      100.00

. global cols = r(r)

. display $cols
4

. 
. local title1 = "A"

. local title2 = "AA"

. local title3 = "AAA"

. local title4 = "BBB"

. /// Matrix to store results 
> matrix define R=J(12,$cols,.)

. matrix colnames R = "A" "AA" "AAA" "BBB"

. matrix rownames R = "ate" "se" "ci_min" "ci_max"  "pval2" "pval1" "vol_pre" "vol_treat" "exce
> ss_vol" "ate_excess_vol" "rmspe" "id"

. matlist R 

             |         A         AA        AAA        BBB 
-------------+-------------------------------------------
         ate |         .          .          .          . 
          se |         .          .          .          . 
      ci_min |         .          .          .          . 
      ci_max |         .          .          .          . 
       pval2 |         .          .          .          . 
       pval1 |         .          .          .          . 
     vol_pre |         .          .          .          . 
   vol_treat |         .          .          .          . 
  excess_vol |         .          .          .          . 
ate_excess~l |         .          .          .          . 
       rmspe |         .          .          .          . 
          id |         .          .          .          . 

. 
. /// Loop to compute the ATE for each treated unit 
> forvalues j = 1(1)$cols { 
  2.         //// 1.- Store All Treated Unit Characteristics 
> 
.         qui use "${tem}/synth_treated_rc.dta", clear
  3.         egen group = group(id fileid)
  4.         qui drop ate tr_eff
  5.         /// Estimate Treatment Effect Using Treated and Synthetic Series (Adjusted for the
> ir own mean and standard deviation) 
>         bysort group: gen tr_eff = treat_lev - synth_lev
  6.         bysort group: egen ate = mean(tr_eff) if month_exp >=0 & month_exp <= ${tr_eff_win
> dow}
  7.         /// Pre-Measures in Volatility 
>         /// Keep only instrument `j' and donors 
>         qui keep if fileid == `j'
  8.         /// Average Treatment Effect 
>         qui sum ate 
  9.         global ate = r(mean)
 10.         mat R[1,`j'] = $ate
 11.         /// ATE in absolute value (to compute ATE in percent of Excess Volatility)
>         local absate = abs($ate)
 12.         /// Volatility Pre-Treatment Period: Average Volatility Observed in the Pre-Treatm
> ent Period 
>         qui sum treat_lev if month_exp < -1
 13.         local vol_pre = r(mean)
 14.         mat R[7,`j'] = `vol_pre'
 15.         /// Volatility Observed in March 2020: Spike due to COVID 
>         qui sum treat_lev if month_exp == -1
 16.         local vol_treat = r(mean)
 17.         mat R[8,`j'] = `vol_treat'
 18.         /// Compute Excess Volatility: Difference in Average Volatility and Volatility Dur
> ing the Pandemic 
>         local excess_vol = `vol_treat' - `vol_pre'
 19.         mat R[9,`j'] = `excess_vol'
 20.         /// ATE in Terms of Excess Volatility 
>         local ate_excess_vol = 100*(`absate'/`excess_vol')
 21.         mat R[10,`j'] = `ate_excess_vol'
 22.         /// RMSE 
>         qui sum rmse 
 23.         mat R[11,`j'] = r(mean)
 24.         /// Id
>         qui sum id 
 25.         mat R[12,`j'] = r(mean)
 26. 
.         
.         /// 2.- Count How Many times the ATE for the treated unit exceeds the ATE at the plac
> ebo empirical distribution 
>         *preserve 
.         qui use "${tem}/placeboempiricaldistribution_rc.dta" , clear 
 27.         /// Estimate the Average Treatment Effect for the specific window 
>                 qui egen group = group(id fileid)
 28.         qui drop ate
 29.         bysort group: egen ate = mean(tr_eff) if month_exp >=0 & month_exp <= ${tr_eff_win
> dow}
 30.         qui gcollapse (mean) ate, by(id fileid group)
 31.         /// keep only the empirical distribution of state j
>         qui keep if fileid == `j'
 32.         /// Standard Error 
>         qui sum ate 
 33.         local se = r(sd)
 34.         mat R[2,`j'] = `se'
 35.         /// Hypothesis Testing and P Values 
>         qui cumul ate, gen(cdf)
 36.         qui gsort cdf
 37.         /// Hypothesis Testing and P Values 
>         _pctile ate, percentiles(2.5 97.5)
 38.         mat R[3,`j'] = r(r1)
 39.         mat R[4,`j'] = r(r2)
 40.         /// Cavallo Permutation Test Approach: Left-sided one-tail test. 
>         /// Hypothesis: negative coefficient, hence the left-test. 
>         /// Left-sided test: count how many times the placebos are more negative than the tre
> atment effect. 
>         /// (Inutition: p-val = 0 implies the ATE is more negative than all the placebos, ie:
>  is smaller in all cases). 
>         /// The p-value is the number of time the ATE is larger than the placebo estimates. 
>         qui gen pcount = ate < $ate 
 41.         /// p-value 
>         sum pcount 
 42.     local pval1 = round(r(mean),0.001)
 43.         mat R[5,`j'] = `pval1'
 44.         
.         /// Two Tail Test 
>         qui drop pcount 
 45.         qui gen atetreat = abs($ate)
 46.         qui gen absate = abs(ate)
 47.         /// count how many times the 
>         qui gen pcount = absate < atetreat
 48.         qui sum pcount
 49.         local pval2= round(r(mean),0.001)
 50.         mat R[6,`j'] = `pval2'
 51.         
.         /// Percentiles for lines in density plot
>         cap drop ate_cdf
 52.         qui cumul ate, gen(ate_cdf)
 53.         /// Percentile 2.5% 
>         sum ate if ate_cdf <= 0.025
 54.         local p025 = r(max)
 55.         /// Percentile 5.0% 
>         sum ate if ate_cdf <= 0.05
 56.         local p050 = r(max)     
 57.         /// Percentile 95.0% 
>         sum ate if ate_cdf <= 0.95
 58.         local p950 = r(max)
 59.         /// Percentile 97.5% 
>         sum ate if ate_cdf <= 0.975
 60.         local p975 = r(max)
 61.         
.         /// ATE's Empirical Distribution - 
>         local density_opts recast(line) lcolor(black) lwidth(medthin) lpattern(solid) xline($
> ate, lcolor(maroon) lpattern(longdash)) xtitle("ATE Estimate") ytitle("Density") xlabel(#10, 
> angle(0) labsize(small)) ylabel(#10, angle(0) labsize(small)) xscale(range(0 $ate)) legend(of
> f) yscale(titlegap(0))
 62.         /// Percentiles plot
>         local line1 lcolor(ebblue) lpattern(shortdash) lwidth(medthin)
 63.         local line2 lcolor(eltblue) lpattern(longdash) lwidth(medthin)
 64.         local percentile_lines xline(`p050', `line1') 
 65.         *xline(`p050', `line2') xline(`p950', `line2')
. 
.         qui kdensity ate, `density_opts' title("`title`j'': Left Tail Test p-value = `pval1'"
> , pos(11) size(small))  name(ate_dens`j',replace) `percentile_lines'
 66.         
. }
(80 missing values generated)
(13,920 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        174    .0057471    .0758098          0          1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.1736724    .1060692  -.3326479  -.1153915

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8   -.1258193    .0863562  -.3326479  -.0701015

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        165   -.0092353    .0370076  -.3326479   .0590112

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        169   -.0071036    .0391699  -.3326479    .113682
(80 missing values generated)
(13,920 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        174    .0057471    .0758098          0          1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.1807581    .1103967  -.3462195  -.1200993

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8   -.1309526    .0898795  -.3462195  -.0729616

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        165   -.0096121    .0385175  -.3462195   .0614188

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        169   -.0073934     .040768  -.3462195   .1183201
(80 missing values generated)
(13,920 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        174    .0862069    .2814793          0          1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.1651066    .1008376  -.3162411  -.1097002

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8   -.1196137     .082097  -.3162411   -.066644

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        165   -.0087798    .0351823  -.3162411   .0561007

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        169   -.0067532     .037238  -.3162411    .108075
(80 missing values generated)
(13,920 missing values generated)

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
      pcount |        174    .9137931    .2814793          0          1

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          4   -.1984845     .121223  -.3801724  -.1318772

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |          8   -.1437948    .0986937  -.3801724  -.0801168

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        165   -.0105547    .0422948  -.3801724    .067442

    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
         ate |        169   -.0081184     .044766  -.3801724   .1299235

. 
. graph combine ate_dens3 ate_dens2 ate_dens1 ate_dens4, rows(2) cols(2) ycommon name(dens_comb
> ined, replace)

. graph display dens_combined, ysize(80) xsize(100) scale(.9)

. graph export "${oup}/ate_dens_rc.pdf", $export 
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//ate_dens_rc.pdf saved as PDF format

. ********************************************************************************
. 
. 
. ********************************************************************************
. //// 5.1. Create Main Results Table 
> ate_table 
number of observations will be reset to 4
Press any key to continue, or Break to abort
Number of observations (_N) was 0, now 4.
(0 real changes made)
(0 real changes made)
(0 real changes made)

. list  

     +--------------------------------------------------------------------------+
  1. |                            Results |              AAA |               AA |
     |       Average Treatment Effect (a) |          -0.0386 |         -0.2506* |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                  -0.1548*          |                    0.0311           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  2. |                            Results |              AAA |               AA |
     |                                 SE |         (0.0560) |         (0.0613) |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                  (0.0589)          |                  (0.0673)           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  3. |                            Results |              AAA |               AA |
     |                      Conf Interval | (-0.0806,0.1269) | (-0.0883,0.1389) |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |          (-0.0848,0.1335)          |          (-0.0969,0.1526)           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  4. |                            Results |              AAA |               AA |
     |            Historic Volatility (b) |           0.1585 |           0.1395 |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                    0.2091          |                    0.3812           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  5. |                            Results |              AAA |               AA |
     |          Volatility March 2020 (c) |           0.4068 |           0.4129 |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                    0.3823          |                    0.4943           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  6. |                            Results |              AAA |               AA |
     |      Excess Volatility (d = c - b) |           0.2482 |           0.2734 |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                    0.1732          |                    0.1131           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  7. |                            Results |              AAA |               AA |
     | ATE, % Excess Volatility (e = d/a) |        15.5496\% |        91.6673\% |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                 89.3744\%          |                 27.4608\%           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  8. |                            Results |              AAA |               AA |
     |                P-Value (Left Tail) |           0.0860 |           0.0060 |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                    0.0060          |                    0.9140           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
  9. |                            Results |              AAA |               AA |
     |                P-Value (Two Tails) |           0.8450 |           0.9830 |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                    0.9770          |                    0.7990           |
     +--------------------------------------------------------------------------+

     +--------------------------------------------------------------------------+
 10. |                            Results |              AAA |               AA |
     |                              RMSPE |           0.0017 |           0.0051 |
     |------------------------------------+-------------------------------------|
     |                         A          |                       BBB           |
     |                    0.0026          |                    0.0146           |
     +--------------------------------------------------------------------------+

. save "${tem}/ATE_Results_Full_rc.dta", replace 
file 1_Data/Temp//ATE_Results_Full_rc.dta saved

. 
. /// Export Tables 
> drop if Results == "Conf Interval" | Results == "P-Value (One Tail)" | Results == "P-Value (T
> wo Tails)" 
(2 observations deleted)

. replace Results = "" if Results == "SE"
(1 real change made)

. list 

     +------------------------------------------------------------------------------------+
     |                            Results         AAA          AA           A         BBB |
     |------------------------------------------------------------------------------------|
  1. |       Average Treatment Effect (a)     -0.0386    -0.2506*    -0.1548*      0.0311 |
  2. |                                       (0.0560)    (0.0613)    (0.0589)    (0.0673) |
  3. |            Historic Volatility (b)      0.1585      0.1395      0.2091      0.3812 |
  4. |          Volatility March 2020 (c)      0.4068      0.4129      0.3823      0.4943 |
  5. |      Excess Volatility (d = c - b)      0.2482      0.2734      0.1732      0.1131 |
     |------------------------------------------------------------------------------------|
  6. | ATE, % Excess Volatility (e = d/a)   15.5496\%   91.6673\%   89.3744\%   27.4608\% |
  7. |                P-Value (Left Tail)      0.0860      0.0060      0.0060      0.9140 |
  8. |                              RMSPE      0.0017      0.0051      0.0026      0.0146 |
     +------------------------------------------------------------------------------------+

. texsave * using "${oup}/ATE_Results_rc.tex", replace  decimalalign nofix 

. ********************************************************************************
. 
. 
. 
. ********************************************************************************
. /// 6. Smokeplots 
> use "${tem}/synth_treated_rc.dta", clear 

. qui gen treat = 1 

. append using "${tem}/placeboempiricaldistribution_rc.dta", force  

. qui replace treat = 0 if treat == . 

. drop if fileid >= 6 
(0 observations deleted)

. tab fileid, matrow(F)

     fileid |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |      6,300       25.00       25.00
          2 |      6,300       25.00       50.00
          3 |      6,300       25.00       75.00
          4 |      6,300       25.00      100.00
------------+-----------------------------------
      Total |     25,200      100.00

. global rows = r(r)

. 
. ********************************************************************************
. /// Show only the ATE window 
> keep if month_exp < ${tr_eff_window}
(4,200 observations deleted)

. ********************************************************************************
. 
. /// For Each Treated Unit 
> forvalues j=1(1)$rows {
  2. preserve        
  3. use "${tem}/ATE_Results_Full_rc.dta", clear
  4. order Results A AA AAA BBB
  5. rename (Results A AA AAA BBB) (names b1 b2 b3 b4) 
  6. 
. local ate = b`j'[1]
  7. local pval = b`j'[8]
  8. local excess_vol = b`j'[7]
  9. local rmspe = b`j'[10]
 10. 
. dis "`ate'"
 11. dis "`pval'"
 12. dis "`excess_vol'"
 13. dis "`rmspe'"
 14. restore 
 15. 
. preserve
 16. qui keep if fileid == `j'
 17. sort id month_exp
 18. 
. /// Create Percentile Variables 
> gen p1 = . 
 19. gen p2 = . 
 20. gen p5 = . 
 21. gen p95 = . 
 22. gen p97 = . 
 23. gen p99 = . 
 24. 
. /// Create Percentile Variables For each Experiment Month. So, for any period it will compute
>  the percentiles at such period across all donor units, to then save it with the treated unit
> s. 
> forvalues t= -15(1)20 {
 25.         _pctile tr_eff if month_exp == `t' & treat == 0, percentiles(1 2.5 5 95 97.5 99)
 26.         qui replace p1 = r(r1) if month_exp == `t' & treat == 1
 27.         qui replace p2 = r(r2) if month_exp == `t' & treat == 1
 28.         qui replace p5 = r(r3) if month_exp == `t' & treat == 1
 29.         qui replace p95 = r(r4) if month_exp == `t' & treat == 1
 30.         qui replace p97 = r(r5) if month_exp == `t' & treat == 1 
 31.         qui replace p99 = r(r6) if month_exp == `t' & treat == 1
 32. }
 33. /// Keep treated and do the graph 
> keep if treat == 1
 34. merge 1:1 month_exp using "${tem}/dates.dta", keep(match master) nogen
 35. qui sum mofd if month_exp == 0 
 36. local xline = r(mean)
 37. local lineopts lcolor(gray) lpattern(dash) lwidth(vthin)
 38. global smoke_options ytitle("Treatment Effect", size(vsmall)) ylabel(#8, nogrid labsize(vs
> mall) angle(0)) xtitle("", size(vsmall)) xlabel(#16, labsize(vsmall) angle(90) nogrid) title(
> , size(small) pos(11) color(black)) xsca(titlegap(*-.5)) ysca(titlegap(*-3)) plotregion(lcolo
> r()) legend(on order(1 "CI (SmokeArea)" 2 "Treatment Effect") rows(1) size(small)) plotregion
> (color()) graphregion(color() margin(4 4 4 4)) plotregion(lcolor(black)) 
 39. 
. twoway (rarea p1 p99 mofd,     fc(gs13%40) lc(gs15%40) lw(medthick)) ///
>                 (rarea p2 p97 mofd, fc(gs10%40) lc(gs12%40) lw(medthick)) ///   
>                 (rarea p5 p95 mofd,      fc(gs7%40)  lc(gs9%40) lw(medthick))   ///
>                 (connected tr_eff mofd, sort lcolor(maroon) lpattern(solid) mcolor(maroon) ms
> ize(vsmall) msymbol(circle)), ///
>                 xline(`xline' , `lineopts') yline(0 , `lineopts') $smoke_options name(gr`j', 
> replace) title("`title`j''", size(small) pos(11)) legend(order(- 1 5) note("ATE = `ate'" "p-v
> alue = `pval'" "RMSPE = `rmspe'" "ATE (% Excess Volatility) = `excess_vol'", pos(11) size(vsm
> all)) label(1 "90/95/99 C.I.") pos(11) ring(0) cols(1) size(tiny) region(lstyle(none) fcolor(
> none)))
 40. restore 
 41. }
-0.1548*
0.0060
89.3744\%
0.0026
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,220 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                30  
    -----------------------------------------
-0.2506*
0.0060
91.6673\%
0.0051
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,220 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                30  
    -----------------------------------------
-0.0386
0.0860
15.5496\%
0.0017
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,220 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                30  
    -----------------------------------------
0.0311
0.9140
27.4608\%
0.0146
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
(5,250 missing values generated)
no observations
no observations
no observations
no observations
no observations
no observations
(5,220 observations deleted)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                30  
    -----------------------------------------

. 
. graph combine gr3 gr2 gr1 gr4, name(grcombrc3,replace) $combopts 

. graph display grcombrc3, ysize(80) xsize(100) scale(.9)

. graph export "${oup}/SmokeCombinedOut_rc.pdf", $export 
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//SmokeCombinedOut_rc.pdf saved as PDF format

. 
. *******************************************************************************
. /// Dynamic Treatment Effect 
> ********************************************************************************
. ///Crosswalks for months 
>  
. /// Treatment Effect by Period 
> use "${tem}/synth_treated_rc.dta", clear 

. /// Estimate the Average Treatment Effect for the specific window 
> egen group = group(id fileid)

. qui drop ate

. 
. forvalues i=1(1)$treat_period {
  2. bysort group: egen ate`i' = mean(tr_eff) if month_exp >=0 & month_exp <= `i'
  3. }
(136 missing values generated)
(132 missing values generated)
(128 missing values generated)
(124 missing values generated)
(120 missing values generated)
(116 missing values generated)
(112 missing values generated)
(108 missing values generated)
(104 missing values generated)
(100 missing values generated)
(96 missing values generated)
(92 missing values generated)
(88 missing values generated)
(84 missing values generated)
(80 missing values generated)
(76 missing values generated)

. qui gcollapse (mean) ate*, by(id)

. reshape long ate, i(id) j(month_exp)
(j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16)

Data                               Wide   ->   Long
-----------------------------------------------------------------------------
Number of observations                4   ->   64          
Number of variables                  17   ->   3           
j variable (16 values)                    ->   month_exp
xij variables:
                    ate1 ate2 ... ate16   ->   ate
-----------------------------------------------------------------------------

. 
. merge m:1 month_exp using "${tem}/dates.dta", keep(match master) nogen
(variable month_exp was byte, now float to accommodate using data's values)

    Result                      Number of obs
    -----------------------------------------
    Not matched                             0
    Matched                                64  
    -----------------------------------------

. 
. label define id 1 "A" 2 "AA" 3 "AAA" 4 "BBB"

. label values id id 

. 
. twoway  (connected ate mofd if id == 1, msize(vsmall) msymbol(circle) mcolor(black) lcolor(bl
> ack) lwidth(thin)) ///
>                 (connected ate mofd if id == 2, msize(vsmall) msymbol(triangle) mcolor(blue) 
>  lcolor(blue) lwidth(thin)) ///
>                 (connected ate mofd if id == 3, msize(vsmall) msymbol(square) mcolor(cranberr
> y) lcolor(cranberry) lwidth(thin)) ///
>                 (connected ate mofd if id == 4, msize(vsmall) msymbol(diamond) mcolor(green) 
> lcolor(green) lwidth(thin)), ///
>                 xlabel(#16, labsize(small) angle(90)) ylabel(#10, labsize(small) angle(0)) ti
> tle("Cumulative ATE - Months After the Intervention", size(medsmall) pos(11)) name(cumulative
> ate, replace) yline(0, lpattern(dash) lcolor(gray)) legend(on order(1 "A" 2 "AA" 3 "AAA" 4 "B
> BB") rows(1)) ytitle("Average Treatment Effect") xtitle("") yscale(titlegap(0))

. graph display cumulativeate, ysize(50) xsize(85) scale(.9)

. graph export "${oup}/cumulativeate_rc.pdf", replace 
file
    /Users/luisenriquenavarro/Library/CloudStorage/OneDrive-IndianaUniversity/Research/MLF_Vo
    > latility/2_Output//cumulativeate_rc.pdf saved as PDF format

. 
. 
. 
end of do-file

. 
. ********************************************************************************
. 
. *******************************************************************************
. 
. timer off 5

. timer list 5

. timer clear 5 

. cap log close           
